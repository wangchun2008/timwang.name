<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>使用 acme.sh 工具申请 Let&#39;s Encrypt 证书</title>
    <url>/2017/03/15/acme.sh-manual/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/acme.sh-manual.png" alt="使用 acme.sh 工具申请 Let&#39;s Encrypt 证书"></p>
<p>使用 acme.sh 工具申请 Let’s Encrypt 免费证书，新增申请通配符证书操作。</p>
<blockquote>
<p>操作系统版本：CentOS 6.7_64</p>
</blockquote>
<span id="more"></span>

<h1 id="acme-sh-安装"><a href="#acme-sh-安装" class="headerlink" title="acme.sh 安装"></a>acme.sh 安装</h1><h2 id="下载-acme-sh-代码"><a href="#下载-acme-sh-代码" class="headerlink" title="下载 acme.sh 代码"></a>下载 acme.sh 代码</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@UCT-PRD ~]<span class="comment"># git clone https://github.com/Neilpang/acme.sh.git</span></span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> /root/acme.sh/.git/</span><br><span class="line">remote: Counting objects: 2697, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (8/8), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 2697 (delta 2), reused 0 (delta 0), pack-reused 2689</span><br><span class="line">Receiving objects: 100% (2697/2697), 835.64 KiB | 21 KiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (1252/1252), <span class="keyword">done</span>.</span><br><span class="line">[root@UCT-PRD ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="安装-acme-sh"><a href="#安装-acme-sh" class="headerlink" title="安装 acme.sh"></a>安装 acme.sh</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@UCT-PRD ~]<span class="comment"># cd acme.sh</span></span><br><span class="line">[root@UCT-PRD acme.sh]<span class="comment"># ls</span></span><br><span class="line">acme.sh  deploy  dnsapi  README.md</span><br><span class="line">[root@UCT-PRD acme.sh]<span class="comment"># ./acme.sh --install</span></span><br><span class="line">[Mon Dec 12 14:01:44 CST 2016] It is recommended to install nc first, try to install <span class="string">&#x27;nc&#x27;</span> or <span class="string">&#x27;netcat&#x27;</span>.</span><br><span class="line">[Mon Dec 12 14:01:44 CST 2016] We use nc <span class="keyword">for</span> standalone server <span class="keyword">if</span> you use standalone mode.</span><br><span class="line">[Mon Dec 12 14:01:44 CST 2016] If you don<span class="string">&#x27;t use standalone mode, just ignore this warning.</span></span><br><span class="line"><span class="string">[Mon Dec 12 14:01:44 CST 2016] Installing to /root/.acme.sh</span></span><br><span class="line"><span class="string">[Mon Dec 12 14:01:44 CST 2016] Installed to /root/.acme.sh/acme.sh</span></span><br><span class="line"><span class="string">[Mon Dec 12 14:01:44 CST 2016] Installing alias to &#x27;</span>/root/.bashrc<span class="string">&#x27;</span></span><br><span class="line"><span class="string">[Mon Dec 12 14:01:44 CST 2016] OK, Close and reopen your terminal to start using acme.sh</span></span><br><span class="line"><span class="string">[Mon Dec 12 14:01:44 CST 2016] Installing alias to &#x27;</span>/root/.cshrc<span class="string">&#x27;</span></span><br><span class="line"><span class="string">[Mon Dec 12 14:01:44 CST 2016] Installing alias to &#x27;</span>/root/.tcshrc<span class="string">&#x27;</span></span><br><span class="line"><span class="string">[Mon Dec 12 14:01:44 CST 2016] Installing cron job</span></span><br><span class="line"><span class="string">[Mon Dec 12 14:01:44 CST 2016] Good, bash is found, so change the shebang to use bash as prefered.</span></span><br><span class="line"><span class="string">[Mon Dec 12 14:01:44 CST 2016] OK</span></span><br><span class="line"><span class="string">[root@UCT-PRD acme.sh]#</span></span><br></pre></td></tr></table></figure>

<h1 id="acme-sh-使用"><a href="#acme-sh-使用" class="headerlink" title="acme.sh 使用"></a>acme.sh 使用</h1><h2 id="申请证书"><a href="#申请证书" class="headerlink" title="申请证书"></a>申请证书</h2><blockquote>
<p>注意：&#x2F;var&#x2F;www&#x2F;html 目录要有写入权限</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@UCT-PRD acme.sh]<span class="comment"># ./acme.sh --issue -d iamtim.wang -d www.iamtim.wang -w /var/www/html</span></span><br><span class="line">[Mon Dec 12 14:03:31 CST 2016] Registering account</span><br><span class="line">[Mon Dec 12 14:03:55 CST 2016] Registered</span><br><span class="line">[Mon Dec 12 14:04:07 CST 2016] Update success.</span><br><span class="line">[Mon Dec 12 14:04:07 CST 2016] Creating domain key</span><br><span class="line">[Mon Dec 12 14:04:07 CST 2016] Multi domain=<span class="string">&#x27;DNS:www.iamtim.wang&#x27;</span></span><br><span class="line">[Mon Dec 12 14:04:07 CST 2016] Getting domain auth token <span class="keyword">for</span> each domain</span><br><span class="line">[Mon Dec 12 14:04:07 CST 2016] Getting webroot <span class="keyword">for</span> domain=<span class="string">&#x27;iamtim.wang&#x27;</span></span><br><span class="line">[Mon Dec 12 14:04:07 CST 2016] _w=<span class="string">&#x27;/var/www/html&#x27;</span></span><br><span class="line">[Mon Dec 12 14:04:07 CST 2016] Getting new-authz <span class="keyword">for</span> domain=<span class="string">&#x27;iamtim.wang&#x27;</span></span><br><span class="line">[Mon Dec 12 14:04:19 CST 2016] The new-authz request is ok.</span><br><span class="line">[Mon Dec 12 14:04:19 CST 2016] Getting webroot <span class="keyword">for</span> domain=<span class="string">&#x27;www.iamtim.wang&#x27;</span></span><br><span class="line">[Mon Dec 12 14:04:19 CST 2016] _w=<span class="string">&#x27;/var/www/html&#x27;</span></span><br><span class="line">[Mon Dec 12 14:04:19 CST 2016] Getting new-authz <span class="keyword">for</span> domain=<span class="string">&#x27;www.iamtim.wang&#x27;</span></span><br><span class="line">[Mon Dec 12 14:04:31 CST 2016] The new-authz request is ok.</span><br><span class="line">[Mon Dec 12 14:04:31 CST 2016] Verifying:iamtim.wang</span><br><span class="line">[Mon Dec 12 14:04:57 CST 2016] Success</span><br><span class="line">[Mon Dec 12 14:04:57 CST 2016] Verifying:www.iamtim.wang</span><br><span class="line">[Mon Dec 12 14:05:21 CST 2016] Success</span><br><span class="line">[Mon Dec 12 14:05:21 CST 2016] Verify finished, start to sign.</span><br><span class="line">[Mon Dec 12 14:05:33 CST 2016] Cert success.</span><br><span class="line">-----BEGIN CERTIFICATE-----</span><br><span class="line">...</span><br><span class="line">-----END CERTIFICATE-----</span><br><span class="line">[Mon Dec 12 14:05:33 CST 2016] Your cert is <span class="keyword">in</span>  /root/.acme.sh/iamtim.wang/iamtim.wang.cer</span><br><span class="line">[Mon Dec 12 14:05:33 CST 2016] Your cert key is <span class="keyword">in</span>  /root/.acme.sh/iamtim.wang/iamtim.wang.key</span><br><span class="line">[Mon Dec 12 14:05:45 CST 2016] The intermediate CA cert is <span class="keyword">in</span>  /root/.acme.sh/iamtim.wang/ca.cer</span><br><span class="line">[Mon Dec 12 14:05:45 CST 2016] And the full chain certs is there:  /root/.acme.sh/iamtim.wang/fullchain.cer</span><br><span class="line">[root@UCT-PRD acme.sh]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="拷贝证书到相应目录"><a href="#拷贝证书到相应目录" class="headerlink" title="拷贝证书到相应目录"></a>拷贝证书到相应目录</h2><p>证书申请成功后，拷贝证书到相应目录中(ssl.conf定义位置)：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@UCT-PRD acme.sh]<span class="comment"># ./acme.sh --installcert -d iamtim.wang --certpath /etc/httpd/conf/iamtim.wang/cert.pem --keypath /etc/httpd/conf/iamtim.wang/key.pem --fullchainpath /etc/httpd/conf/iamtim.wang/fullchain.pem --reloadcmd &quot;service httpd restart&quot;</span></span><br><span class="line">[Mon Dec 12 14:13:40 CST 2016] Installing cert to:/etc/httpd/conf/iamtim.wang/cert.pem</span><br><span class="line">[Mon Dec 12 14:13:40 CST 2016] Installing key to:/etc/httpd/conf/iamtim.wang/key.pem</span><br><span class="line">[Mon Dec 12 14:13:40 CST 2016] Installing full chain to:/etc/httpd/conf/iamtim.wang/fullchain.pem</span><br><span class="line">[Mon Dec 12 14:13:40 CST 2016] Run Le_ReloadCmd: service httpd restart</span><br><span class="line">Stopping httpd:                                            [  OK  ]</span><br><span class="line">Starting httpd:                                            [  OK  ]</span><br><span class="line">[Mon Dec 12 14:13:40 CST 2016] Reload success</span><br><span class="line">[root@UCT-PRD acme.sh]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h1 id="申请通配符证书"><a href="#申请通配符证书" class="headerlink" title="申请通配符证书"></a>申请通配符证书</h1><p>从阿里云后台获取密钥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@UCT-PRD acme.sh]<span class="comment"># export Ali_Key=&quot;ghjkghjkghjkghjkghjkghjkghjk&quot;</span></span><br><span class="line">[root@UCT-PRD acme.sh]<span class="comment"># export Ali_Secret=&quot;asdfasdfasdfasdfasdfasdfasdf&quot;</span></span><br></pre></td></tr></table></figure>

<p>申请证书</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@UCT-PRD acme.sh]<span class="comment"># ./acme.sh --issue --dns dns_ali -d iamtim.wang -d *.iamtim.wang</span></span><br></pre></td></tr></table></figure>

<p>最后拷贝证书到相应路径，步骤参考上文。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="https://github.com/Neilpang/acme.sh/wiki/%E8%AF%B4%E6%98%8E">https://github.com/Neilpang/acme.sh/wiki/%E8%AF%B4%E6%98%8E</a></li>
</ul>
]]></content>
      <categories>
        <category>https</category>
      </categories>
      <tags>
        <tag>https</tag>
        <tag>letsencrypt</tag>
        <tag>acme.sh</tag>
      </tags>
  </entry>
  <entry>
    <title>我的图书目录</title>
    <url>/2017/03/17/books/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/books.png" alt="我的图书目录"></p>
<p>整理手头上的图书，包括纸质图书、Amazon购买的电子书、图灵社区购买的电子书。</p>
<span id="more"></span>

<p>| 序号 	|                                                            名称                                                           	|      ISBN      	|      介质      	|<br>|:—-:	|:————————————————————————————————————————-:	|:————–:	|:————–:	|<br>|   1  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115422699.jpg">Python编程快速上手   让繁琐工作自动化</a>                        	| 9787115422699  	|    纸质书籍    	|<br>|   2  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121277139.jpg">Python绝技：运用Python成为顶级黑客</a>                           	| 9787121277139  	|    纸质书籍    	|<br>|   3  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9781785289583.jpg">Python Parallel   Programming   Cookbook</a>                     	| 9781785289583  	|    纸质书籍    	|<br>|   4  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121280344.jpg">跟老齐学Python：从入门到精通</a>                                 	| 9787121280344  	|    纸质书籍    	|<br>|   5  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787512322233.jpg">Head First   Python</a>                                          	| 9787512322233  	|    纸质书籍    	|<br>|   6  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115353528.jpg">Python基础教程（第2版   修订版）</a>                             	| 9787115353528  	|    纸质书籍    	|<br>|   7  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115379597.jpg">Python   Cookbook（第3版）中文版</a>                             	| 9787115379597  	|    纸质书籍    	|<br>|   8  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111483069.jpg">Python自动化运维：技术与最佳实践</a>                             	| 9787111483069  	|    纸质书籍    	|<br>|   9  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111436737.jpg">利用Python进行数据分析</a>                                       	| 9787111436737  	|    纸质书籍    	|<br>|  10  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787549562664.jpg">李宗仁回忆录（套装上下册）</a>                                   	| 9787549562664  	|    纸质书籍    	|<br>|  11  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115349316.jpg">谷歌和亚马逊如何做产品</a>                                       	| 9787115349316  	|    纸质书籍    	|<br>|  12  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121296208.jpg">分布式实时计算框架原理及实践案例</a>                             	| 9787121296208  	|    纸质书籍    	|<br>|  13  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121102479.jpg">实战Nginx：取代Apache的高性能Web服务器</a>                       	| 9787121102479  	|    纸质书籍    	|<br>|  14  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121297335.jpg">Python   Web开发实战</a>                                         	| 9787121297335  	|    纸质书籍    	|<br>|  15  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121300004.jpg">大数据架构详解：从数据获取到深度学习</a>                         	| 9787121300004  	|    纸质书籍    	|<br>|  16  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115432728.jpg">HTTPS权威指南   在服务器和Web应用上部署SSL   TLS和PKI</a>        	| 9787115432728  	|    纸质书籍    	|<br>|  17  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121290169.jpg">Ceph Cookbook   中文版</a>                                       	| 9787121290169  	|    纸质书籍    	|<br>|  18  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121297267.jpg">SRE：Google运维解密</a>                                          	| 9787121297267  	|    纸质书籍    	|<br>|  19  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111532644.jpg">架构即未来：现代企业可扩展的Web架构、流程和组织（原书第2版）</a> 	| 9787111532644  	|    纸质书籍    	|<br>|  20  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115295941.jpg">高效团队开发   工具与方法</a>                                    	| 9787115295941  	|    纸质书籍    	|<br>|  21  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115191120.jpg">MySQL必知必会</a>                                                	| 9787115191120  	|    纸质书籍    	|<br>|  22  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787539990484.jpg">精进：如何成为一个很厉害的人</a>                                 	| 9787539990484  	|    纸质书籍    	|<br>|  23  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121275913.jpg">微服务架构与实践</a>                                             	| 9787121275913  	|    纸质书籍    	|<br>|  24  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121215186.jpg">Nginx高性能Web服务器详解</a>                                     	| 9787121215186  	|    纸质书籍    	|<br>|  25  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115381415.jpg">精通Nginx</a>                                                    	| 9787115381415  	|    纸质书籍    	|<br>|  26  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787229057671.jpg">阁楼上的狐狸</a>                                                 	| 9787229057671  	|    纸质书籍    	|<br>|  27  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115436856.jpg">你不可不知的50个化学知识</a>                                     	| 9787115436856  	|    纸质书籍    	|<br>|  28  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115434180.jpg">进化   从孤胆极客到高效团队</a>                                  	| 9787115434180  	|    纸质书籍    	|<br>|  29  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540453503.jpg">雅舍谈吃</a>                                                     	| 9787540453503  	|    纸质书籍    	|<br>|  30  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787539992761.jpg">孤独深处</a>                                                     	| 9787539992761  	|    纸质书籍    	|<br>|  31  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787101095357.jpg">建筑的意境</a>                                                   	| 9787101095357  	|    纸质书籍    	|<br>|  32  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787508669069.jpg">海错图笔记</a>                                                   	| 9787508669069  	|    纸质书籍    	|<br>|  33  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115373557.jpg">数学之美（第二版）</a>                                           	| 9787115373557  	|    纸质书籍    	|<br>|  34  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787514206630.jpg">不懂带人，你就自己干到死：把身边的庸才变干将</a>                 	| 9787514206630  	|    纸质书籍    	|<br>|  35  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787510077463.jpg">沟通的艺术：看入人里，看出人外（插图修订第14版）</a>             	| 9787510077463  	|    纸质书籍    	|<br>|  36  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121302442.jpg">Docker容器实战：原理、架构与应用</a>                             	| 9787121302442  	|    纸质书籍    	|<br>|  37  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787515403502.jpg">小书馆·书法指南</a>                                              	| 9787515403502  	|    纸质书籍    	|<br>|  38  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787508655109.jpg">火车上的女孩</a>                                                 	| 9787508655109  	|    纸质书籍    	|<br>|  39  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787508653167.jpg">所有我们看不见的光</a>                                           	| 9787508653167  	|    纸质书籍    	|<br>|  40  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787535488473.jpg">自在独行：贾平凹的独行世界</a>                                   	| 9787535488473  	|    纸质书籍    	|<br>|  41  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121275494.jpg">空间信息技术考古学应用方法</a>                                   	| 9787121275494  	|    纸质书籍    	|<br>|  42  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121302909.jpg">金融百年：从袁大头到互联网金融</a>                               	| 9787121302909  	|    纸质书籍    	|<br>|  43  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121216824.jpg">颠覆医疗：大数据时代的个人健康革命</a>                           	| 9787121216824  	|    纸质书籍    	|<br>|  44  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121282751.jpg">从运维菜鸟到大咖，你还有多远：数据中心设施运维指南</a>           	| 9787121282751  	|    纸质书籍    	|<br>|  45  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121302527.jpg">陶然静界   的手工软陶</a>                                        	| 9787121302527  	|    纸质书籍    	|<br>|  46  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121233838.jpg">设计师的自我修养(全彩)</a>                                       	| 9787121233838  	|    纸质书籍    	|<br>|  47  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121022982.jpg">代码大全（第2版）</a>                                            	| 9787121022982  	|    纸质书籍    	|<br>|  48  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121292385.jpg">运营制胜   从零系统学运营构建用户增长引擎</a>                    	| 9787121292385  	|    纸质书籍    	|<br>|  49  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121306136.jpg">产品为王：移动游戏产品设计规则</a>                               	| 9787121306136  	|    纸质书籍    	|<br>|  50  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121291401.jpg">淘宝、天猫电商运营百科全书</a>                                   	| 9787121291401  	|    纸质书籍    	|<br>|  51  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115411020.jpg">数据整理实践指南</a>                                             	| 9787115411020  	|    纸质书籍    	|<br>|  52  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115341082.jpg">MongoDB权威指南   第2版</a>                                      	| 9787115341082  	|    纸质书籍    	|<br>|  53  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111447467.jpg">数据库查询优化器的艺术：原理解析与SQL性能优化</a>                	| 9787111447467  	|    纸质书籍    	|<br>|  54  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111498728.jpg">PostgreSQL修炼之道：从小工到专家</a>                             	| 9787111498728  	|    纸质书籍    	|<br>|  55  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121014963.jpg">SQL查询凡人入门</a>                                              	| 9787121014963  	|    纸质书籍    	|<br>|  56  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115402844.jpg">Redis实战</a>                                                    	| 9787115402844  	|    纸质书籍    	|<br>|  57  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121265327.jpg">自己动手设计数据库</a>                                           	| 9787121265327  	|    纸质书籍    	|<br>|  58  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115427878.jpg">NoSQL权威指南</a>                                                	| 9787115427878  	|    纸质书籍    	|<br>|  59  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121215506.jpg">DK人类的思想百科丛书：经济学百科</a>                             	| 9787121215506  	|    纸质书籍    	|<br>|  60  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121250385.jpg">DK人类的思想百科丛书：科学百科</a>                               	| 9787121250385  	|    纸质书籍    	|<br>|  61  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121250361.jpg">DK人类的思想百科丛书：政治学百科</a>                             	| 9787121250361  	|    纸质书籍    	|<br>|  62  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121215490.jpg">DK人类的思想百科丛书：哲学百科</a>                               	| 9787121215490  	|    纸质书籍    	|<br>|  63  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121215452.jpg">DK人类的思想百科丛书：心理学百科</a>                             	| 9787121215452  	|    纸质书籍    	|<br>|  64  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121250378.jpg">DK人类的思想百科丛书：商业百科</a>                               	| 9787121250378  	|    纸质书籍    	|<br>|  65  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115255952.jpg">MySQL技术内幕:第4版</a>                                          	| 9787115255952  	|    纸质书籍    	|<br>|  66  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787302380399.jpg">NoSQL数据库技术实战</a>                                          	| 9787302380399  	|    纸质书籍    	|<br>|  67  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121266881.jpg">高可用MySQL（第2版）</a>                                         	| 9787121266881  	|    纸质书籍    	|<br>|  68  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111449065.jpg">MySQL管理之道：性能调优、高可用与监控</a>                        	| 9787111449065  	|    纸质书籍    	|<br>|  69  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121260544.jpg">数据库索引设计与优化</a>                                         	| 9787121260544  	|    纸质书籍    	|<br>|  70  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115409089.jpg">深入理解MariaDB与MySQL</a>                                       	| 9787115409089  	|    纸质书籍    	|<br>|  71  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121102455.jpg">高性能MySQL（第2版）</a>                                         	| 9787121102455  	|    纸质书籍    	|<br>|  72  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787517018674.jpg">涂抹MySQL：跟着三思一步一步学MySQL</a>                           	| 9787517018674  	|    纸质书籍    	|<br>|  73  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111422068.jpg">MySQL技术内幕：InnoDB存储引擎（第2版）</a>                       	| 9787111422068  	|    纸质书籍    	|<br>|  74  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115376046.jpg">图数据库</a>                                                     	| 9787115376046  	|    纸质书籍    	|<br>|  75  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111531173.jpg">NoSQL实践指南：基本原则、设计准则及实用技巧</a>                  	| 9787111531173  	|    纸质书籍    	|<br>|  76  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115397287.jpg">MySQL排错指南</a>                                                	| 9787115397287  	|    纸质书籍    	|<br>|  77  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121144073.jpg">高可用MySQL</a>                                                  	| 9787121144073  	|    纸质书籍    	|<br>|  78  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111433033.jpg">NoSQL精粹</a>                                                    	| 9787111433033  	|    纸质书籍    	|<br>|  79  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111391401.jpg">数据挖掘   概念与技术（原书第3版）</a>                           	| 9787111391401  	|    纸质书籍    	|<br>|  80  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787302346005.jpg">分布式数据库系统原理（第3版）</a>                                	| 9787302346005  	|    纸质书籍    	|<br>|  81  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111375296.jpg">数据库系统概念（原书第6版）</a>                                  	| 9787111375296  	|    纸质书籍    	|<br>|  82  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121301964.jpg">PPT设计思维：教你又好又快搞定幻灯片</a>                          	| 9787121301964  	|    纸质书籍    	|<br>|  83  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787302447528.jpg">数据存储技术与实践</a>                                           	| 9787302447528  	|    纸质书籍    	|<br>|  84  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121291425.jpg">大型网站性能监测、分析与优化</a>                                 	| 9787121291425  	|    纸质书籍    	|<br>|  85  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121270451.jpg">Informatica   PowerCenter权威指南</a>                            	| 9787121270451  	|    纸质书籍    	|<br>|  86  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121294075.jpg">大数据思维   从掷骰子到纸牌屋</a>                                	| 9787121294075  	|    纸质书籍    	|<br>|  87  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121212000.jpg">大型网站技术架构   核心原理与案例分析</a>                        	| 9787121212000  	|    纸质书籍    	|<br>|  88  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111430520.jpg">大规模分布式存储系统：原理解析与架构实战</a>                     	| 9787111430520  	|    纸质书籍    	|<br>|  89  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111455035.jpg">大规模分布式系统架构与设计实战</a>                               	| 9787111455035  	|    纸质书籍    	|<br>|  90  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121238857.jpg">大型分布式网站架构设计与实践</a>                                 	| 9787121238857  	|    纸质书籍    	|<br>|  91  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787302378204.jpg">云计算架构技术与实践</a>                                         	| 9787302378204  	|    纸质书籍    	|<br>|  92  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111484448.jpg">云数据中心构建实战：核心技术、运维管理、安全与高可用</a>         	| 9787111484448  	|    纸质书籍    	|<br>|  93  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9781491949023.jpg">Developing Web   Components</a>                                  	| 9781491949023  	|    纸质书籍    	|<br>|  94  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9780133390094.jpg">Systems   Performance</a>                                        	| 9780133390094  	|    纸质书籍    	|<br>|  95  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121254444.jpg">Web   界面设计</a>                                               	| 9787121254444  	|    纸质书籍    	|<br>|  96  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121204067.jpg">界面设计模式（第2版）</a>                                        	| 9787121204067  	|    纸质书籍    	|<br>|  97  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115288899.jpg">Linux命令行与shell脚本编程大全（第2版）</a>                      	| 9787115288899  	|    纸质书籍    	|<br>|  98  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121103285.jpg">Linux   Shell编程与服务器管理</a>                                	| 9787121103285  	|    纸质书籍    	|<br>|  99  	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787302230526.jpg">Linux命令、编辑器与shell编程(第2版)</a>                          	| 9787302230526  	|    纸质书籍    	|<br>|  100 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115380241.jpg">24小时365天不间断服务：服务器&#x2F;基础设施核心技术</a>               	| 9787115380241  	|    纸质书籍    	|<br>|  101 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115394095.jpg">GitHub入门与实践</a>                                             	| 9787115394095  	|    纸质书籍    	|<br>|  102 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121207662.jpg">软件集成策略   如何有效率地提升质量</a>                          	| 9787121207662  	|    纸质书籍    	|<br>|  103 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121252242.jpg">颠覆大数据分析</a>                                               	| 9787121252242  	|    纸质书籍    	|<br>|  104 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111488521.jpg">Docker技术入门与实战</a>                                         	| 9787111488521  	|    纸质书籍    	|<br>|  105 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111366959.jpg">高性能Linux服务器构建实战：运维监控、性能调优与集群应用</a>      	| 9787111366959  	|    纸质书籍    	|<br>|  106 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111360551.jpg">构建高可用Linux服务器</a>                                        	| 9787111360551  	|    纸质书籍    	|<br>|  107 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111359517.jpg">AIX   Unix系统管理、维护与高可用集群建设</a>                     	| 9787111359517  	|    纸质书籍    	|<br>|  108 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115363152.jpg">Web渗透测试 使用Kali   Linux</a>                                 	| 9787115363152  	|    纸质书籍    	|<br>|  109 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9781491911686.jpg">Information   Architecture 4th   Edition</a>                     	| 9781491911686  	|    纸质书籍    	|<br>|  110 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121246913.jpg">京东技术解密</a>                                                 	| 9787121246913  	|    纸质书籍    	|<br>|  111 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121226052.jpg">大数据时代的IT架构设计</a>                                       	| 9787121226052  	|    纸质书籍    	|<br>|  112 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121218774.jpg">Linux运维之道</a>                                                	| 9787121218774  	|    纸质书籍    	|<br>|  113 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121215339.jpg">Web信息架构   设计大型网站（第3版）</a>                          	| 9787121215339  	|    纸质书籍    	|<br>|  114 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111485988.jpg">Puppet权威指南</a>                                               	| 9787111485988  	|    纸质书籍    	|<br>|  115 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121170935.jpg">构建高性能Web站点（修订版）</a>                                  	| 9787121170935  	|    纸质书籍    	|<br>|  116 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115264596.jpg">持续交付：发布可靠软件的系统方法</a>                             	| 9787115264596  	|    纸质书籍    	|<br>|  117 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115388179.jpg">图解服务器端网络架构</a>                                         	| 9787115388179  	|    纸质书籍    	|<br>|  118 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115422255.jpg">Docker生产环境实践指南</a>                                       	| 9787115422255  	|    纸质书籍    	|<br>|  119 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9781617291975.jpg">Git in   Practice</a>                                            	| 9781617291975  	|    纸质书籍    	|<br>|  120 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121264689.jpg">自动化运维软件设计实战</a>                                       	| 9787121264689  	|    纸质书籍    	|<br>|  121 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121276392.jpg">Kubernetes权威指南：从Docker到Kubernetes实践全接触</a>           	| 9787121276392  	|    纸质书籍    	|<br>|  122 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121201868.jpg">项目管理知识体系指南（PMBOK指南）（第5版）</a>                   	| 9787121201868  	|    纸质书籍    	|<br>|  123 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121256820.jpg">Zabbix监控系统</a>                                               	| 9787121256820  	|    纸质书籍    	|<br>|  124 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121240133.jpg">Zabbix监控系统深度实践</a>                                       	| 9787121240133  	|    纸质书籍    	|<br>|  125 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121238772.jpg">Zabbix企业级分布式监控系统</a>                                   	| 9787121238772  	|    纸质书籍    	|<br>|  126 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121144752.jpg">实战Hadoop：开启通向云计算的捷径</a>                             	| 9787121144752  	|    纸质书籍    	|<br>|  127 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787302370857.jpg">Hadoop权威指南（第3版   修订版）</a>                             	| 9787302370857  	|    纸质书籍    	|<br>|  128 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121249679.jpg">从Paxos到Zookeeper分布式一致性原理与实践</a>                     	| 9787121249679  	|    纸质书籍    	|<br>|  129 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9781430250449.jpg">Expert Oracle RAC   12c</a>                                      	| 9781430250449  	|    纸质书籍    	|<br>|  130 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115227867.jpg">Oracle Database   11g数据库管理艺术</a>                          	| 9787115227867  	|    纸质书籍    	|<br>|  131 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121200700.jpg">收获，不止Oracle</a>                                             	| 9787121200700  	|    纸质书籍    	|<br>|  132 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787508469614.jpg">涂抹Oracle：三思笔记之一步一步学Oracle</a>                       	| 9787508469614  	|    纸质书籍    	|<br>|  133 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787302242505.jpg">OCP&#x2F;OCA认证考试指南全册：Oracle   Database 11g</a>               	| 9787302242505  	|    纸质书籍    	|<br>|  134 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121177439.jpg">运筹帷幄DB2从Oracle运维转型</a>                                  	| 9787121177439  	|    纸质书籍    	|<br>|  135 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121144851.jpg">DB2数据库管理最佳实践</a>                                        	| 9787121144851  	|    纸质书籍    	|<br>|  136 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111552062.jpg">学习之道</a>                                                     	| 9787111552062  	|    纸质书籍    	|<br>|  137 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121268854.jpg">痛点</a>                                                         	| 9787121268854  	|    纸质书籍    	|<br>|  138 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121258602.jpg">成为技术领导者：掌握全面解决问题的方法</a>                       	| 9787121258602  	|    纸质书籍    	|<br>|  139 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121275074.jpg">奔跑吧Ansible</a>                                                	| 9787121275074  	|    纸质书籍    	|<br>|  140 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111531159.jpg">Ansible自动化运维：技术与最佳实践</a>                            	| 9787111531159  	|    纸质书籍    	|<br>|  141 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121300479.jpg">Learning   TypeScript（中文版）</a>                              	| 9787121300479  	|    纸质书籍    	|<br>|  142 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121271649.jpg">RabbitMQ实战：高效部署分布式消息队列</a>                         	| 9787121271649  	|    纸质书籍    	|<br>|  143 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121267253.jpg">深度解析淘宝运营</a>                                             	| 9787121267253  	|    纸质书籍    	|<br>|  144 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121298097.jpg">运营之光：我的互联网运营方法论与自白</a>                         	| 9787121298097  	|    纸质书籍    	|<br>|  145 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121175015.jpg">精通正则表达式（第3版）</a>                                      	| 9787121175015  	|    纸质书籍    	|<br>|  146 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121262388.jpg">持续集成实践</a>                                                 	| 9787121262388  	|    纸质书籍    	|<br>|  147 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121141638.jpg">网站运维   保持数据实时的秘技</a>                                	| 9787121141638  	|    纸质书籍    	|<br>|  148 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121271403.jpg">系统运维全面解析：技术、管理与实践</a>                           	| 9787121271403  	|    纸质书籍    	|<br>|  149 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121231520.jpg">商业摄影实拍案例：淘宝、广告摄影、专业摄影进阶通用</a>           	| 9787121231520  	|    纸质书籍    	|<br>|  150 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121305245.jpg">Node.js微服务</a>                                                	| 9787121305245  	|    纸质书籍    	|<br>|  151 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115425256.jpg">大型网站服务器容量规划</a>                                       	| 9787115425256  	|    纸质书籍    	|<br>|  152 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121270727.jpg">Learning   HBase（中文版）</a>                                   	| 9787121270727  	|    纸质书籍    	|<br>|  153 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111477877.jpg">构建高可用Linux服务器（第3版）</a>                               	| 9787111477877  	|    纸质书籍    	|<br>|  154 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115377333.jpg">第一本Docker书</a>                                               	| 9787115377333  	|    纸质书籍    	|<br>|  155 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115368072.jpg">精通Puppet配置管理工具(第2版)</a>                                	| 9787115368072  	|    纸质书籍    	|<br>|  156 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121304026.jpg">Node.js硬实战：115个核心技巧</a>                                 	| 9787121304026  	|    纸质书籍    	|<br>|  157 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111321330.jpg">深入理解计算机系统-原书第2版</a>                                 	| 9787111321330  	|    纸质书籍    	|<br>|  158 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115382436.jpg">Git版本控制管理（第2版）</a>                                     	| 9787115382436  	|    纸质书籍    	|<br>|  159 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115313089.jpg">设计师要懂心理学</a>                                             	| 9787115313089  	|    纸质书籍    	|<br>|  160 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787553749266.jpg">郝鹏飞极简派健身</a>                                             	| 9787553749266  	|    纸质书籍    	|<br>|  161 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787534148484.jpg">四周练出一身肌肉：619种绝对有效的练肌肉方法</a>                  	| 9787534148484  	|    纸质书籍    	|<br>|  162 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787531724872.jpg">我的第一本葡萄酒书</a>                                           	| 9787531724872  	|    纸质书籍    	|<br>|  163 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787538156522.jpg">葡萄酒品鉴大全</a>                                               	| 9787538156522  	|    纸质书籍    	|<br>|  164 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9789862760277.jpg">首席設計師是這樣用Photoshop+Illustrator玩創意</a>                	| 9789862760277  	|    纸质书籍    	|<br>|  165 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9789865912192.jpg">設計就該這麼好玩！配色1000圖解書</a>                             	| 9789865912192  	|    纸质书籍    	|<br>|  166 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115235527.jpg">超越平凡的平面设计   版式设计原理与应用</a>                      	| 9787115235527  	|    纸质书籍    	|<br>|  167 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787539975276.jpg">你不懂咖啡：有料、有趣、还有范儿的咖啡知识百科</a>               	| 9787539975276  	|    纸质书籍    	|<br>|  168 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115290205.jpg">中文版Dreamweaver   CS6基础培训教程</a>                          	| 9787115290205  	|    纸质书籍    	|<br>|  169 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787302303060.jpg">完全掌握Dreamweaver   CS6白金手册</a>                            	| 9787302303060  	|    纸质书籍    	|<br>|  170 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787515325446.jpg">玩转Excel就这3件事</a>                                           	| 9787515325446  	|    纸质书籍    	|<br>|  171 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121259456.jpg">PPT，要你好看（第2版   全彩）</a>                                	| 9787121259456  	|    纸质书籍    	|<br>|  172 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9780316201643.jpg">S.   忒修斯之船（英文）</a>                                      	| 9780316201643  	|    纸质书籍    	|<br>|  173 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9789869014946.jpg">S.   忒修斯之船（繁体中文版）</a>                                	| 9789869014946  	|    纸质书籍    	|<br>|  174 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121269202.jpg">Office妖精是怎样炼成的：Office办公软件职场应用速成</a>           	| 9787121269202  	|    纸质书籍    	|<br>|  175 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121259982.jpg">Photoshop   CC移动UI界面设计与实战</a>                           	| 9787121259982  	|    纸质书籍    	|<br>|  176 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121245008.jpg">移动终端决胜之道：   APP视觉设计艺术</a>                         	| 9787121245008  	|    纸质书籍    	|<br>|  177 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121225116.jpg">大嘴巴漫谈数据挖掘</a>                                           	| 9787121225116  	|    纸质书籍    	|<br>|  178 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787208125117.jpg">精灵宝钻（精装插图本）</a>                                       	| 9787208125117  	|    纸质书籍    	|<br>|  179 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787515337760.jpg">托梅教授的植物图谱</a>                                           	| 9787515337760  	|    纸质书籍    	|<br>|  180 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787229040369.jpg">禅与摩托车维修艺术</a>                                           	| 9787229040369  	|    纸质书籍    	|<br>|  181 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121266386.jpg">从入门到精通：Prezi完全解读</a>                                  	| 9787121266386  	|    纸质书籍    	|<br>|  182 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121220999.jpg">设计之下：搜狐新闻客户端的用户体验设计</a>                       	| 9787121220999  	|    纸质书籍    	|<br>|  183 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787515511856.jpg">我爱咖啡，更爱咖啡馆</a>                                         	| 9787515511856  	|    纸质书籍    	|<br>|  184 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787101111460.jpg">诗经（套装上下册   精装）</a>                                    	| 9787101111460  	|    纸质书籍    	|<br>|  185 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121257070.jpg">腾讯网UED体验设计之旅（全彩）</a>                                	| 9787121257070  	|    纸质书籍    	|<br>|  186 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787302197737.jpg">北京颐和园</a>                                                   	| 9787302197737  	|    纸质书籍    	|<br>|  187 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787302197775.jpg">北京紫禁城</a>                                                   	| 9787302197775  	|    纸质书籍    	|<br>|  188 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787302197744.jpg">北京四合院</a>                                                   	| 9787302197744  	|    纸质书籍    	|<br>|  189 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787302197768.jpg">北京天坛</a>                                                     	| 9787302197768  	|    纸质书籍    	|<br>|  190 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121285066.jpg">设计，在人人设计的时代：社会创新设计导论</a>                     	| 9787121285066  	|    纸质书籍    	|<br>|  191 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121189531.jpg">超越想象：Windows   8应用设计与开发（全彩）</a>                  	| 9787121189531  	|    纸质书籍    	|<br>|  192 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787550266308.jpg">本书书名无法描述本书内容：一场逗你玩的哲学探险</a>               	| 9787550266308  	|    纸质书籍    	|<br>|  193 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787514610307.jpg">很杂很杂的杂学知识：拿得起放不下的学问书</a>                     	| 9787514610307  	|    纸质书籍    	|<br>|  194 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121209499.jpg">线上幽灵：世界头号黑客米特尼克自传</a>                           	| 9787121209499  	|    纸质书籍    	|<br>|  195 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121287121.jpg">CG绘画艺术设计:驾驭灵感的奇幻之旅</a>                            	| 9787121287121  	|    纸质书籍    	|<br>|  196 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787512204270.jpg">薄荷日记</a>                                                     	| 9787512204270  	|    纸质书籍    	|<br>|  197 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787503185953.jpg">死磕日记：国安漫画第一季</a>                                     	| 9787503185953  	|    纸质书籍    	|<br>|  198 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787503190650.jpg">死磕日记：国安漫画第二季</a>                                     	| 9787503190650  	|    纸质书籍    	|<br>|  199 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787555104612.jpg">永不言弃</a>                                                     	| 9787555104612  	|    纸质书籍    	|<br>|  200 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787555102137.jpg">那些再与你无关的幸福</a>                                         	| 9787555102137  	|    纸质书籍    	|<br>|  201 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787535271082.jpg">做了这本书</a>                                                   	| 9787535271082  	|    纸质书籍    	|<br>|  202 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121090264.jpg">开心记账本</a>                                                   	| 9787121090264  	|    纸质书籍    	|<br>|  203 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787508643939.jpg">小顾聊绘画</a>                                                   	| 9787508643939  	|    纸质书籍    	|<br>|  204 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787508648064.jpg">小顾聊绘画2</a>                                                  	| 9787508648064  	|    纸质书籍    	|<br>|  205 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787201085982.jpg">海子诗选</a>                                                     	| 9787201085982  	|    纸质书籍    	|<br>|  206 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787544268868.jpg">川端康成：睡美人</a>                                             	| 9787544268868  	|    纸质书籍    	|<br>|  207 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787515318561.jpg">大拙至美：梁思成最美的文字建筑</a>                               	| 9787515318561  	|    纸质书籍    	|<br>|  208 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787550257528.jpg">街角的老北京：阿龙带你亲历老北京的吃喝玩乐</a>                   	| 9787550257528  	|    纸质书籍    	|<br>|  209 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787302412762.jpg">癌症·真相   医生也在读</a>                                       	| 9787302412762  	|    纸质书籍    	|<br>|  210 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787100104685.jpg">看不见的森林：林中自然笔记</a>                                   	| 9787100104685  	|    纸质书籍    	|<br>|  211 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787569902198.jpg">这才是最好的数学书（套装上下册）</a>                             	| 9787569902198  	|    纸质书籍    	|<br>|  212 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787517003038.jpg">Q版手绘基础入门</a>                                              	| 9787517003038  	|    纸质书籍    	|<br>|  213 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787549540358.jpg">乡愁北京：寻回昨日的世界</a>                                     	| 9787549540358  	|    纸质书籍    	|<br>|  214 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540471644.jpg">聪明人用方格笔记本</a>                                           	| 9787540471644  	|    纸质书籍    	|<br>|  215 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787539984476.jpg">你一年的8760小时</a>                                             	| 9787539984476  	|    纸质书籍    	|<br>|  216 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787508646947.jpg">日和手帖001：我们终究都是一个人</a>                              	| 9787508646947  	|    纸质书籍    	|<br>|  217 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787508648828.jpg">日和手帖   002生活整理术</a>                                     	| 9787508648828  	|    纸质书籍    	|<br>|  218 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787508650135.jpg">日和手帖   003打包你的人生</a>                                   	| 9787508650135  	|    纸质书籍    	|<br>|  219 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787508651866.jpg">日和手帖   004跟自己说声晚安</a>                                 	| 9787508651866  	|    纸质书籍    	|<br>|  220 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787508653129.jpg">日和手帖   005日用即道</a>                                       	| 9787508653129  	|    纸质书籍    	|<br>|  221 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787501976904.jpg">轻松茶艺全书</a>                                                 	| 9787501976904  	|    纸质书籍    	|<br>|  222 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121290886.jpg">极简设计：苹果崛起之道</a>                                       	| 9787121290886  	|    纸质书籍    	|<br>|  223 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121274268.jpg">醉美古风：CG插画自学秘笈</a>                                     	| 9787121274268  	|    纸质书籍    	|<br>|  224 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121299520.jpg">OpenCV编程案例详解</a>                                           	| 9787121299520  	|    纸质书籍    	|<br>|  225 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787547039236.jpg">最冷最冷的冷门知识</a>                                           	| 9787547039236  	|    纸质书籍    	|<br>|  226 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787550248083.jpg">那些古怪又让人忧心的问题what   if</a>                            	| 9787550248083  	|    纸质书籍    	|<br>|  227 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787503248580.jpg">遇见时光的慢旅行</a>                                             	| 9787503248580  	|    纸质书籍    	|<br>|  228 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787543894419.jpg">这个历史挺靠谱1：袁腾飞讲中国史上(升级修订版)   </a>             	| 9787543894419  	|  亚马逊电子书  	|<br>|  229 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787511004321.jpg">就这900句玩转口语</a>                                            	| 9787511004321  	|  亚马逊电子书  	|<br>|  230 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787510107498.jpg">怀孕怎么吃：孕期营养与食谱全书</a>                               	| 9787510107498  	|  亚马逊电子书  	|<br>|  231 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787550213524.jpg">一个人的朝圣</a>                                                 	| 9787550213524  	|  亚马逊电子书  	|<br>|  232 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787550211407.jpg">唐朝穿越指南：长安及各地人民生活手册</a>                         	| 9787550211407  	|  亚马逊电子书  	|<br>|  233 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540449438.jpg">悟空传(完美纪念版)   </a>                                        	| 9787540449438  	|  亚马逊电子书  	|<br>|  234 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787533939489.jpg">想得美</a>                                                       	| 9787533939489  	|  亚马逊电子书  	|<br>|  235 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787562465133.jpg">跟我去台北</a>                                                   	| 9787562465133  	|  亚马逊电子书  	|<br>|  236 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787535447371.jpg">罗辑思维2   </a>                                                 	| 9787535447371  	|  亚马逊电子书  	|<br>|  237 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787539963761.jpg">做饭</a>                                                         	| 9787539963761  	|  亚马逊电子书  	|<br>|  238 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787550264618.jpg">古董局中局</a>                                                   	| 9787550264618  	|  亚马逊电子书  	|<br>|  239 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787564069902.jpg">一指流沙，我们都握不住的那段年华</a>                             	| 9787564069902  	|  亚马逊电子书  	|<br>|  240 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540456887.jpg">你好，旧时光</a>                                                 	| 9787540456887  	|  亚马逊电子书  	|<br>|  241 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787304058937.jpg">这样读书就够了</a>                                               	| 9787304058937  	|  亚马逊电子书  	|<br>|  242 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787201083209.jpg">万物生长</a>                                                     	| 9787201083209  	|  亚马逊电子书  	|<br>|  243 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787533935498.jpg">我所理解的生活</a>                                               	| 9787533935498  	|  亚马逊电子书  	|<br>|  244 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/244.jpg">明朝那些事儿(套装全7册)   </a>                                             	|      244       	|  亚马逊电子书  	|<br>|  245 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540463540.jpg">1980年代的爱情</a>                                               	| 9787540463540  	|  亚马逊电子书  	|<br>|  246 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/246.jpg">硬派健身   减肥篇：知乎斌卡自选集</a>                                      	|      246       	|  亚马逊电子书  	|<br>|  247 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787229012755.jpg">我们台湾这些年</a>                                               	| 9787229012755  	|  亚马逊电子书  	|<br>|  248 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/248.jpg">拖延症再见：知乎动机在杭州自选集</a>                                       	|      248       	|  亚马逊电子书  	|<br>|  249 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540453060.jpg">暗恋</a>                                                         	| 9787540453060  	|  亚马逊电子书  	|<br>|  250 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787510829826.jpg">跟任何人都聊得来：最受世界500强企业欢迎的沟通课</a>              	| 9787510829826  	|  亚马逊电子书  	|<br>|  251 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540453541.jpg">大漠谣</a>                                                       	| 9787540453541  	|  亚马逊电子书  	|<br>|  252 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787550230415.jpg">失乐园</a>                                                       	| 9787550230415  	|  亚马逊电子书  	|<br>|  253 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787549501076.jpg">你一定爱读的极简欧洲史</a>                                       	| 9787549501076  	|  亚马逊电子书  	|<br>|  254 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787544270878.jpg">解忧杂货店</a>                                                   	| 9787544270878  	|  亚马逊电子书  	|<br>|  255 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787550264595.jpg">古董局中局2：清明上河图之谜</a>                                  	| 9787550264595  	|  亚马逊电子书  	|<br>|  256 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/256.jpg">知乎周刊   跳槽有术</a>                                                    	|      256       	|  亚马逊电子书  	|<br>|  257 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/257.jpg">知乎周刊 新技能   get</a>                                                  	|      257       	|  亚马逊电子书  	|<br>|  258 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9789900001416.jpg">战争就是这么回事儿：袁腾飞讲战争史套装（一战+二战上+二战下）</a> 	| 9789900001416  	|  亚马逊电子书  	|<br>|  259 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787508637396.jpg">品牌洗脑：世界著名品牌只做不说的营销秘密</a>                     	| 9787508637396  	|  亚马逊电子书  	|<br>|  260 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787510441899.jpg">不如去飞</a>                                                     	| 9787510441899  	|  亚马逊电子书  	|<br>|  261 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787550203570.jpg">金陵十三钗：长篇小说</a>                                         	| 9787550203570  	|  亚马逊电子书  	|<br>|  262 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/262.jpg">深度学习的艺术：知乎采铜自选集</a>                                         	|      262       	|  亚马逊电子书  	|<br>|  263 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787544267618.jpg">嫌疑人X的献身</a>                                                	| 9787544267618  	|  亚马逊电子书  	|<br>|  264 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787511334978.jpg">我讲个笑话，你可别哭啊</a>                                       	| 9787511334978  	|  亚马逊电子书  	|<br>|  265 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540472252.jpg">三生三世十里桃花</a>                                             	| 9787540472252  	|  亚马逊电子书  	|<br>|  266 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540764678.jpg">无声的证词   (法医秦明系列)</a>                                  	| 9787540764678  	|  亚马逊电子书  	|<br>|  267 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787539958934.jpg">给你一个团队，你能怎么管？</a>                                   	| 9787539958934  	|  亚马逊电子书  	|<br>|  268 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787544143615.jpg">何以笙箫默</a>                                                   	| 9787544143615  	|  亚马逊电子书  	|<br>|  269 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540457594.jpg">尸语者：公安厅从未公开的法医禁忌档案</a>                         	| 9787540457594  	|  亚马逊电子书  	|<br>|  270 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787561356920.jpg">小姨多鹤</a>                                                     	| 9787561356920  	|  亚马逊电子书  	|<br>|  271 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/271.jpg">冯唐文集(北京三部曲+欢喜)</a>                                              	|      271       	|  亚马逊电子书  	|<br>|  272 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/272.jpg">死亡通知单系列（套装5本）</a>                                              	|      272       	|  亚马逊电子书  	|<br>|  273 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787533927585.jpg">边城</a>                                                         	| 9787533927585  	|  亚马逊电子书  	|<br>|  274 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787507424751.jpg">我是个算命先生</a>                                               	| 9787507424751  	|  亚马逊电子书  	|<br>|  275 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787550235861.jpg">古董局中局3：掠宝清单</a>                                        	| 9787550235861  	|  亚马逊电子书  	|<br>|  276 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787549541607.jpg">一个独立教师的语文之旅</a>                                       	| 9787549541607  	|  亚马逊电子书  	|<br>|  277 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787510114243.jpg">准备怀孕三个月完美方案</a>                                       	| 9787510114243  	|  亚马逊电子书  	|<br>|  278 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/278.jpg">美国诞生（1770—1800）[双语版]   </a>                                       	|      278       	|  亚马逊电子书  	|<br>|  279 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787213052545.jpg">大数据时代：生活，工作与思维的大变革</a>                         	| 9787213052545  	|  亚马逊电子书  	|<br>|  280 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/280.jpg">YES！产品经理(套装上下册)</a>                                              	|      280       	|  亚马逊电子书  	|<br>|  281 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787514328394.jpg">海豹突击队体能训练手册</a>                                       	| 9787514328394  	|  亚马逊电子书  	|<br>|  282 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540453138.jpg">世界上的另一个你</a>                                             	| 9787540453138  	|  亚马逊电子书  	|<br>|  283 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787535474438.jpg">文化苦旅</a>                                                     	| 9787535474438  	|  亚马逊电子书  	|<br>|  284 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787508643120.jpg">一网打尽：贝佐斯与亚马逊时代</a>                                 	| 9787508643120  	|  亚马逊电子书  	|<br>|  285 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787800806094.jpg">小王子(中英法60周年彩色纪念版)   </a>                            	| 9787800806094  	|  亚马逊电子书  	|<br>|  286 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787539932811.jpg">微微一笑很倾城</a>                                               	| 9787539932811  	|  亚马逊电子书  	|<br>|  287 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787533936518.jpg">爱你就像爱生命</a>                                               	| 9787533936518  	|  亚马逊电子书  	|<br>|  288 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787513312912.jpg">底牌</a>                                                         	| 9787513312912  	|  亚马逊电子书  	|<br>|  289 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787544710992.jpg">查泰莱夫人的情人(双语全译典藏本)   </a>                          	| 9787544710992  	|  亚马逊电子书  	|<br>|  290 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/290.jpg">冯唐：小通鉴（冯唐为你讲一堂《资治通鉴》的管理课）</a>                     	|      290       	|  亚马逊电子书  	|<br>|  291 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/291.jpg">夏日便当·修订版</a>                                                        	|      291       	|  亚马逊电子书  	|<br>|  292 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/292.jpg">风口上的猪——一本书看懂互联网金融</a>                                       	|      292       	|  亚马逊电子书  	|<br>|  293 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787807696490.jpg">佛祖都说了些什么?   </a>                                         	| 9787807696490  	|  亚马逊电子书  	|<br>|  294 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787501995356.jpg">幸福，私厨定制</a>                                               	| 9787501995356  	|  亚马逊电子书  	|<br>|  295 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787508648200.jpg">我们夜里在美术馆谈恋爱</a>                                       	| 9787508648200  	|  亚马逊电子书  	|<br>|  296 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787544267663.jpg">爱上跑步的13周</a>                                               	| 9787544267663  	|  亚马逊电子书  	|<br>|  297 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787508643847.jpg">台湾单车环岛笔记</a>                                             	| 9787508643847  	|  亚马逊电子书  	|<br>|  298 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/298.jpg">三体全集</a>                                                               	|      298       	|  亚马逊电子书  	|<br>|  299 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540458027.jpg">从你的全世界路过</a>                                             	| 9787540458027  	|  亚马逊电子书  	|<br>|  300 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787539975870.jpg">一人食：一个人也要好好吃饭</a>                                   	| 9787539975870  	|  亚马逊电子书  	|<br>|  301 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787508643403.jpg">创业时，我们在知乎聊什么?</a>                                    	| 9787508643403  	|  亚马逊电子书  	|<br>|  302 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/302.jpg">知乎周刊・无基础健身</a>                                                   	|      302       	|  亚马逊电子书  	|<br>|  303 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540235932.jpg">大草原上的小木屋</a>                                             	| 9787540235932  	|  亚马逊电子书  	|<br>|  304 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787539971810.jpg">岛上书店</a>                                                     	| 9787539971810  	|  亚马逊电子书  	|<br>|  305 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787508648682.jpg">金钱有术</a>                                                     	| 9787508648682  	|  亚马逊电子书  	|<br>|  306 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787533939601.jpg">小于一</a>                                                       	| 9787533939601  	|  亚马逊电子书  	|<br>|  307 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/307.jpg">知日・手账最高+知日·杂货   套装2册</a>                                     	|      307       	|  亚马逊电子书  	|<br>|  308 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787539978529.jpg">神们自己</a>                                                     	| 9787539978529  	|  亚马逊电子书  	|<br>|  309 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787544741552.jpg">2052：未来四十年的中国与世界</a>                                 	| 9787544741552  	|  亚马逊电子书  	|<br>|  310 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787533942014.jpg">和喜欢的一切在一起</a>                                           	| 9787533942014  	|  亚马逊电子书  	|<br>|  311 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540466206.jpg">鱼羊野史.第1卷</a>                                               	| 9787540466206  	|  亚马逊电子书  	|<br>|  312 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787508645131.jpg">参与感:小米口碑营销内部手册</a>                                  	| 9787508645131  	|  亚马逊电子书  	|<br>|  313 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787308133326.jpg">一本书读懂财报</a>                                               	| 9787308133326  	|  亚马逊电子书  	|<br>|  314 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787539982830.jpg">无声告白</a>                                                     	| 9787539982830  	|  亚马逊电子书  	|<br>|  315 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/315.jpg">武侠经典古龙作品大合集（套装61册）</a>                                     	|      315       	|  亚马逊电子书  	|<br>|  316 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787508647142.jpg">来到地球第一天</a>                                               	| 9787508647142  	|  亚马逊电子书  	|<br>|  317 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540235512.jpg">谢谢你曾来过我的世界</a>                                         	| 9787540235512  	|  亚马逊电子书  	|<br>|  318 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/318.jpg">中国的人口与城市：知乎 chenqin   自选集</a>                                	|      318       	|  亚马逊电子书  	|<br>|  319 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787535958662.jpg">轻断食:正在横扫全球的瘦身革命</a>                                	| 9787535958662  	|  亚马逊电子书  	|<br>|  320 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787568208109.jpg">滚蛋吧!肿瘤君</a>                                                	| 9787568208109  	|  亚马逊电子书  	|<br>|  321 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/321.jpg">码农：Docker云图</a>                                                       	|      321       	|  亚马逊电子书  	|<br>|  322 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787564138905.jpg">数据库设计与关系理论</a>                                         	| 9787564138905  	|  亚马逊电子书  	|<br>|  323 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111461548.jpg">SQL与关系数据库理论——如何编写健壮的SQL代码（原书第2版）</a>      	| 9787111461548  	|  亚马逊电子书  	|<br>|  324 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787805888767.jpg">李可乐抗拆记</a>                                                 	| 9787805888767  	|  亚马逊电子书  	|<br>|  325 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787550236073.jpg">1368个单词就够了</a>                                             	| 9787550236073  	|  亚马逊电子书  	|<br>|  326 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111268048.jpg">敏捷开发的艺术</a>                                               	| 9787111268048  	|  亚马逊电子书  	|<br>|  327 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787539957173.jpg">永恒的终结</a>                                                   	| 9787539957173  	|  亚马逊电子书  	|<br>|  328 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787508645483.jpg">泛若不系之舟</a>                                                 	| 9787508645483  	|  亚马逊电子书  	|<br>|  329 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787802517165.jpg">你好,旧时光：陪你到青春最后</a>                                  	| 9787802517165  	|  亚马逊电子书  	|<br>|  330 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540465995.jpg">暗恋·橘生淮南</a>                                                	| 9787540465995  	|  亚马逊电子书  	|<br>|  331 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787506373753.jpg">陆犯焉识</a>                                                     	| 9787506373753  	|  亚马逊电子书  	|<br>|  332 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787543084070.jpg">不要让未来的你,讨厌现在的自己</a>                                	| 9787543084070  	|  亚马逊电子书  	|<br>|  333 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540467081.jpg">我讲个故事，你可别当真啊</a>                                     	| 9787540467081  	|  亚马逊电子书  	|<br>|  334 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787535462053.jpg">陪安东尼度过漫长岁月-红橙黄套装3本</a>                           	| 9787535462053  	|  亚马逊电子书  	|<br>|  335 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787530215043.jpg">了不起的盖茨比</a>                                               	| 9787530215043  	|  亚马逊电子书  	|<br>|  336 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787550264601.jpg">古董局中局4：大结局</a>                                          	| 9787550264601  	|  亚马逊电子书  	|<br>|  337 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787505735361.jpg">你只是看起来很努力</a>                                           	| 9787505735361  	|  亚马逊电子书  	|<br>|  338 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/338.jpg">失控：机器、社会与经济的新生物学</a>                                       	|      338       	|  亚马逊电子书  	|<br>|  339 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787544362320.jpg">余罪：我的刑侦笔记</a>                                           	| 9787544362320  	|  亚马逊电子书  	|<br>|  340 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787213067792.jpg">最好的告别：关于衰老与死亡，你必须知道的常识</a>                 	| 9787213067792  	|  亚马逊电子书  	|<br>|  341 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787505735446.jpg">这么慢，那么美</a>                                               	| 9787505735446  	|  亚马逊电子书  	|<br>|  342 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787533942687.jpg">韩寒MOOK7:我们从未陌生过</a>                                     	| 9787533942687  	|  亚马逊电子书  	|<br>|  343 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787539966205.jpg">灵魂有香气的女子</a>                                             	| 9787539966205  	|  亚马逊电子书  	|<br>|  344 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787505733268.jpg">莫急,你要的岁月都会给你</a>                                      	| 9787505733268  	|  亚马逊电子书  	|<br>|  345 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787539963792.jpg">以自己喜欢的方式过一生</a>                                       	| 9787539963792  	|  亚马逊电子书  	|<br>|  346 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787508643267.jpg">一切都是最好的安排</a>                                           	| 9787508643267  	|  亚马逊电子书  	|<br>|  347 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787307075429.jpg">天才在左疯子在右</a>                                             	| 9787307075429  	|  亚马逊电子书  	|<br>|  348 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787538542837.jpg">有些事现在不做,一辈子都不会做了</a>                              	| 9787538542837  	|  亚马逊电子书  	|<br>|  349 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787549511525.jpg">优雅</a>                                                         	| 9787549511525  	|  亚马逊电子书  	|<br>|  350 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787538548006.jpg">有些事现在不做,一辈子都不会做了2:简单生活</a>                    	| 9787538548006  	|  亚马逊电子书  	|<br>|  351 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787807690313.jpg">去,另一种生活:北欧、西欧壮游记</a>                               	| 9787807690313  	|  亚马逊电子书  	|<br>|  352 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/352.jpg">打工旅行:一年实现一个梦</a>                                                	|      352       	|  亚马逊电子书  	|<br>|  353 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787538571165.jpg">一个自己的房间</a>                                               	| 9787538571165  	|  亚马逊电子书  	|<br>|  354 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787538564297.jpg">有些事现在不做,一辈子都不会做了5:两个人的生活</a>                	| 9787538564297  	|  亚马逊电子书  	|<br>|  355 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787553473857.jpg">自卑与超越：你要清楚自己应该怎样过好这一生</a>                   	| 9787553473857  	|  亚马逊电子书  	|<br>|  356 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/356.jpg">码农·从Python开始（总第7期）</a>                                           	|      356       	|  亚马逊电子书  	|<br>|  357 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/357.jpg">2015：知乎日报年度精选</a>                                                 	|      357       	|  亚马逊电子书  	|<br>|  358 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787807408291.jpg">大漠苍狼.全集</a>                                                	| 9787807408291  	|  亚马逊电子书  	|<br>|  359 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115261274.jpg">SQL反模式</a>                                                    	| 9787115261274  	|  亚马逊电子书  	|<br>|  360 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121242151.jpg">万万没想到:用理工科思维理解世界</a>                              	| 9787121242151  	|  亚马逊电子书  	|<br>|  361 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787511357618.jpg">借山而居</a>                                                     	| 9787511357618  	|  亚马逊电子书  	|<br>|  362 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787535710659.jpg">时间简史</a>                                                     	| 9787535710659  	|  亚马逊电子书  	|<br>|  363 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787543894440.jpg">这个历史挺靠谱:袁腾飞讲历史(套装共3册)   </a>                    	| 9787543894440  	|  亚马逊电子书  	|<br>|  364 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787122184221.jpg">秘密</a>                                                         	| 9787122184221  	|  亚马逊电子书  	|<br>|  365 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540471842.jpg">虚无的十字架</a>                                                 	| 9787540471842  	|  亚马逊电子书  	|<br>|  366 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787201088945.jpg">皮囊</a>                                                         	| 9787201088945  	|  亚马逊电子书  	|<br>|  367 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787513903509.jpg">耶路撒冷三千年</a>                                               	| 9787513903509  	|  亚马逊电子书  	|<br>|  368 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787546360690.jpg">兔子什么都知道:叫一声我的名字好吗?</a>                           	| 9787546360690  	|  亚马逊电子书  	|<br>|  369 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787550242234.jpg">哲学家们都干了些什么?（2015年全新修订版）</a>                    	| 9787550242234  	|  亚马逊电子书  	|<br>|  370 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121198014.jpg">大师镜头（第二卷）</a>                                           	| 9787121198014  	|    纸质书籍         |<br>|  371 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111464747.jpg">Redis设计与实现</a>                                              	| 9787111464747  	|  亚马逊电子书  	|<br>|  372 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540468361.jpg">鱼羊野史.第2卷</a>                                               	| 9787540468361  	|  亚马逊电子书  	|<br>|  373 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787544363655.jpg">余罪：我的刑侦笔记2</a>                                          	| 9787544363655  	|  亚马逊电子书  	|<br>|  374 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115388407.jpg">Redis入门指南</a>                                                	| 9787115388407  	|  亚马逊电子书  	|<br>|  375 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/375.jpg">古龙作品文集（大陆正版合法授权)   (精装72册) </a>                          	|      375       	|  亚马逊电子书  	|<br>|  376 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787801739308.jpg">季羡林：读书与做人</a>                                           	| 9787801739308  	|  亚马逊电子书  	|<br>|  377 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540452001.jpg">生活的艺术</a>                                                   	| 9787540452001  	|  亚马逊电子书  	|<br>|  378 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787218088860.jpg">空谈</a>                                                         	| 9787218088860  	|  亚马逊电子书  	|<br>|  379 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540475987.jpg">为什么精英都是清单控</a>                                         	| 9787540475987  	|  亚马逊电子书  	|<br>|  380 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787539992716.jpg">极简生活</a>                                                     	| 9787539992716  	|  亚马逊电子书  	|<br>|  381 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787539989891.jpg">巨人的陨落</a>                                                   	| 9787539989891  	|  亚马逊电子书  	|<br>|  382 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787535790811.jpg">大脑使用指南：其实你活在大脑创造的虚拟世界里</a>                 	| 9787535790811  	|  亚马逊电子书  	|<br>|  383 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540478162.jpg">猎豹</a>                                                         	| 9787540478162  	|  亚马逊电子书  	|<br>|  384 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787208130500.jpg">斯通纳</a>                                                       	| 9787208130500  	|  亚马逊电子书  	|<br>|  385 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787540474836.jpg">雪人</a>                                                         	| 9787540474836  	|  亚马逊电子书  	|<br>|  386 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115296382.jpg">深入NoSQL</a>                                                    	| 9787115296382  	| mobi格式电子书 	|<br>|  387 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/387.jpg">Jekyll   小书</a>                                                          	|      387       	| mobi格式电子书 	|<br>|  388 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115291776.jpg">精益开发实战：用看板管理大型项目</a>                             	| 9787115291776  	| mobi格式电子书 	|<br>|  399 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115335494.jpg">深入浅出MySQL 数据库开发   优化与管理维护 第2版</a>              	| 9787115335494  	|    纸质书籍    	|<br>|  400 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111547792.jpg">MySQL管理之道：性能调优、高可用与监控（第2版）</a>               	| 9787111547792  	|    纸质书籍    	|<br>|  401 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111529835.jpg">跟老男孩学Linux运维：Web集群实战</a>                             	| 9787111529835  	|    纸质书籍    	|<br>|  402 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111544388.jpg">Linux集群和自动化运维</a>                                        	| 9787111544388  	|    纸质书籍    	|<br>|  403 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121283802.jpg">App后台开发运维和架构实践</a>                                    	| 9787121283802  	|    纸质书籍    	|<br>|  404 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121224454.jpg">Pentaho   Kettle解决方案：使用PDI构建开源ETL解决方案</a>         	| 9787121224454  	|    纸质书籍    	|<br>|  405 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121198854.jpg">高性能MySQL（第3版）</a>                                         	| 9787121198854  	|    纸质书籍    	|<br>|  406 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787550244658.jpg">无言的宇宙：隐藏在24个数学公式背后的故事</a>                     	| 9787550244658  	|    纸质书籍    	|<br>|  407 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111553588.jpg">Ceph分布式存储实战</a>                                           	| 9787111553588  	|    纸质书籍    	|<br>|  408 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787111556077.jpg">跟老男孩学Linux运维：Shell编程实战</a>                           	| 9787111556077  	|    纸质书籍    	|<br>|  409 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787550284463.jpg">鞋狗:   耐克创始人菲尔·奈特亲笔自传（精装）</a>                  	| 9787550284463  	|    纸质书籍    	|<br>|  410 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787530470954.jpg">平面设计完全手册</a>                                             	| 9787530470954  	|    纸质书籍    	|<br>|  411 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121087400.jpg">MySQL性能调优与架构设计</a>                                      	| 9787121087400  	|  亚马逊电子书  	|<br>|  412 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787115446565.jpg">Docker经典实例</a>                                               	| 9787115446565  	|    纸质书籍    	|<br>|  413 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121266775.jpg">高性能JavaScript</a>                                             	| 9787121266775  	|    纸质书籍    	|<br>|  414 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121181184.jpg">编码：隐匿在计算机软硬件背后的语言</a>                           	| 9787121181184  	|    纸质书籍    	|<br>|  415 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787302294771.jpg">古都北京</a>                                                     	| 9787302294771  	|    纸质书籍    	|<br>|  416 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787302294764.jpg">古都西安</a>                                                     	| 9787302294764  	|    纸质书籍    	|<br>|  417 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787302294832.jpg">古都南京</a>                                                     	| 9787302294832  	|    纸质书籍    	|<br>|  418 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787302294788.jpg">古都洛阳</a>                                                     	| 9787302294788  	|    纸质书籍    	|<br>|  419 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787302294849.jpg">古都开封与杭州</a>                                               	| 9787302294849  	|    纸质书籍    	|<br>|  420 	| <a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/9787121309595.jpg">Tensorflow：实战Google深度学习框架</a>                           	| 9787121309595  	|    纸质书籍    	|</p>
<p>以上表格使用 <a href="http://www.tablesgenerator.com/markdown_tables">Markdown Tables Generator</a> 生成。</p>
]]></content>
      <categories>
        <category>other</category>
      </categories>
      <tags>
        <tag>book</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS6 系统初始化配置</title>
    <url>/2017/03/15/centos6-init/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/centos6-init.png" alt="CentOS6 系统初始化配置"></p>
<p>Linux 服务器初始化配置。</p>
<blockquote>
<p>以下配置适用于：CentOS 6</p>
</blockquote>
<span id="more"></span>

<h1 id="安装必备程序"><a href="#安装必备程序" class="headerlink" title="安装必备程序"></a>安装必备程序</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d</span><br><span class="line">rename .repo .bak *.repo</span><br><span class="line">wget http://mirrors.163.com/.help/CentOS6-Base-163.repo</span><br><span class="line">sed -i <span class="string">&#x27;s@^exclude@#exclude@&#x27;</span> /etc/yum.conf</span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br><span class="line">yum -y install deltarpm gcc gcc-c++ make cmake autoconf libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel ncurses ncurses-devel libaio readline-devel curl curl-devel e2fsprogs e2fsprogs-devel krb5-devel libidn libidn-devel openssl openssl-devel libxslt-devel libevent-devel libtool libtool-ltdl bison gd-devel vim-enhanced pcre-devel zip unzip ntpdate sysstat patch bc expect rsync git lsof lrzsz</span><br></pre></td></tr></table></figure>

<h1 id="修改时区同步时间"><a href="#修改时区同步时间" class="headerlink" title="修改时区同步时间"></a>修改时区同步时间</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /etc/localtime</span><br><span class="line"><span class="built_in">ln</span> -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;*/20 * * * * `which ntpdate` pool.ntp.org; hwclock -w &gt; /dev/null 2&gt;&amp;1&quot;</span> &gt;&gt; /var/spool/cron/root;<span class="built_in">chmod</span> 600 /var/spool/cron/root;</span><br><span class="line">service crond restart</span><br></pre></td></tr></table></figure>

<h1 id="修改-console"><a href="#修改-console" class="headerlink" title="修改 console"></a>修改 console</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s@^start@#start@&#x27;</span> /etc/init/control-alt-delete.conf</span><br><span class="line">sed -i <span class="string">&#x27;s@^ACTIVE_CONSOLES.*@ACTIVE_CONSOLES=/dev/tty[1-2]@&#x27;</span> /etc/sysconfig/init</span><br></pre></td></tr></table></figure>

<h1 id="修改-sysctl-文件"><a href="#修改-sysctl-文件" class="headerlink" title="修改 sysctl 文件"></a>修改 sysctl 文件</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/sysctl.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">fs.file-max=65535</span></span><br><span class="line"><span class="string">net.ipv4.tcp_fin_timeout = 30</span></span><br><span class="line"><span class="string">net.ipv4.tcp_tw_reuse = 1</span></span><br><span class="line"><span class="string">net.ipv4.tcp_tw_recycle = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_local_port_range = 1024 65000</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_syn_backlog = 65536</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_tw_buckets = 20000</span></span><br><span class="line"><span class="string">net.ipv4.route.gc_timeout = 100</span></span><br><span class="line"><span class="string">net.ipv4.tcp_syn_retries = 1</span></span><br><span class="line"><span class="string">net.ipv4.tcp_synack_retries = 1</span></span><br><span class="line"><span class="string">net.core.somaxconn = 65535</span></span><br><span class="line"><span class="string">net.core.netdev_max_backlog = 262144</span></span><br><span class="line"><span class="string">net.ipv4.tcp_timestamps = 0</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_orphans = 262144</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>

<h1 id="添加系统启动资源"><a href="#添加系统启动资源" class="headerlink" title="添加系统启动资源"></a>添加系统启动资源</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ulimit -SH 65535&quot;</span> &gt;&gt; /etc/rc.local</span><br></pre></td></tr></table></figure>

<h1 id="修改-vim-配置"><a href="#修改-vim-配置" class="headerlink" title="修改 vim 配置"></a>修改 vim 配置</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">&quot;s@alias mv=\(.*\)@alias mv=\1\nalias vi=vim@&quot;</span> ~/.bashrc &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;syntax on&#x27;</span> &gt;&gt; /etc/vimrc</span><br></pre></td></tr></table></figure>

<h1 id="修改系统资源限制"><a href="#修改系统资源限制" class="headerlink" title="修改系统资源限制"></a>修改系统资源限制</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;/^# End of file/,$d&#x27;</span> /etc/security/limits.conf</span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/security/limits.conf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string"># End of file</span></span><br><span class="line"><span class="string">* soft nproc 65535</span></span><br><span class="line"><span class="string">* hard nproc 65535</span></span><br><span class="line"><span class="string">* soft nofile 65535</span></span><br><span class="line"><span class="string">* hard nofile 65535</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h1 id="修改-history-记录数"><a href="#修改-history-记录数" class="headerlink" title="修改 history 记录数"></a>修改 history 记录数</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/^HISTSIZE=.*$/HISTSIZE=100/&#x27;</span> /etc/profile</span><br></pre></td></tr></table></figure>

<h1 id="修改用户环境信息"><a href="#修改用户环境信息" class="headerlink" title="修改用户环境信息"></a>修改用户环境信息</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export PROMPT_COMMAND=&#x27;&#123; msg=\$(history 1 | &#123; read x y; echo \$y; &#125;);user=\$(whoami); echo \$(date \&quot;+%Y-%m-%d %H:%M:%S\&quot;):\$user:\`pwd\`/:\$msg ---- \$(who am i); &#125; &gt;&gt; /tmp/\`hostname\`.\`whoami\`.history-timestamp&#x27;&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;PS1=&quot;\[\e[37;40m\][\[\e[32;40m\]\u\[\e[37;40m\]@\h \[\e[35;40m\]\W\[\e[0m\]]\\$ &quot;&#x27;</span> &gt;&gt; ~/.bashrc</span><br></pre></td></tr></table></figure>

<h1 id="关闭-selinux"><a href="#关闭-selinux" class="headerlink" title="关闭 selinux"></a>关闭 selinux</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">setenforce 0</span><br><span class="line">sed -i <span class="string">&#x27;s/^SELINUX=.*$/SELINUX=disabled/&#x27;</span> /etc/selinux/config</span><br></pre></td></tr></table></figure>

<h1 id="针对-mysql-服务优化"><a href="#针对-mysql-服务优化" class="headerlink" title="针对 mysql 服务优化"></a>针对 mysql 服务优化</h1><blockquote>
<p>慎用，有可能造成 MySQL OOM。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;vm.swappiness = 0&quot;</span> &gt;&gt;/etc/sysctl.conf</span><br></pre></td></tr></table></figure>

<p>编辑 &#x2F;etc&#x2F;grub.conf 文件，在 kernel 行最后添加：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">elevator=deadline numa=off</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>centos6</tag>
      </tags>
  </entry>
  <entry>
    <title>安装配置 FastDFS 文件系统</title>
    <url>/2017/03/15/fastdfs-install-and-settings-for-test-environment/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/fastdfs-install-and-settings-for-test-environment.png" alt="安装配置 FastDFS 文件系统"></p>
<p>在两台虚拟机上安装 FastDFS 文件系统，用来学习与测试。</p>
<blockquote>
<p>服务器信息：test01(192.168.115.131)、test02(192.168.155.132)</p>
<p>OS 版本：CentOS release 6.7 (Final)</p>
<p>FastDFS 版本：5.08</p>
</blockquote>
<span id="more"></span>

<h1 id="上传安装介质（both）"><a href="#上传安装介质（both）" class="headerlink" title="上传安装介质（both）"></a>上传安装介质（both）</h1><h2 id="创建相关目录"><a href="#创建相关目录" class="headerlink" title="创建相关目录"></a>创建相关目录</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /root/fastdfs</span><br><span class="line"><span class="built_in">mkdir</span> -p /home/fastdfs_data/client /home/fastdfs_data/module /home/fastdfs_data/storage /home/fastdfs_data/tracker</span><br></pre></td></tr></table></figure>

<h2 id="上传安装文件到-x2F-root-x2F-fastdfs-目录"><a href="#上传安装文件到-x2F-root-x2F-fastdfs-目录" class="headerlink" title="上传安装文件到 &#x2F;root&#x2F;fastdfs 目录"></a>上传安装文件到 &#x2F;root&#x2F;fastdfs 目录</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fastdfs-nginx-module_v1.16.tar.gz</span><br><span class="line">FastDFS_v5.08.tar.gz</span><br><span class="line">libfastcommon-master.zip</span><br><span class="line">nginx-1.10.1.tar.gz</span><br></pre></td></tr></table></figure>

<h1 id="编译安装-libfastcommon（both）"><a href="#编译安装-libfastcommon（both）" class="headerlink" title="编译安装 libfastcommon（both）"></a>编译安装 libfastcommon（both）</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install -y gcc perl libevent</span><br><span class="line"><span class="built_in">cd</span> /root/fastdfs</span><br><span class="line">unzip libfastcommon-master.zip</span><br><span class="line"><span class="built_in">cd</span> libfastcommon-master</span><br><span class="line">./make.sh</span><br><span class="line">./make.sh install</span><br><span class="line"><span class="built_in">ln</span> -s /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.so</span><br><span class="line"><span class="built_in">ln</span> -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so</span><br><span class="line"><span class="built_in">ln</span> -s /usr/lib64/libfdfsclient.so /usr/local/lib/libfdfsclient.so</span><br><span class="line"><span class="built_in">ln</span> -s /usr/lib64/libfdfsclient.so /usr/lib/libfdfsclient.so</span><br></pre></td></tr></table></figure>

<h1 id="编译安装-FastDFS（both）"><a href="#编译安装-FastDFS（both）" class="headerlink" title="编译安装 FastDFS（both）"></a>编译安装 FastDFS（both）</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/fastdfs</span><br><span class="line">tar -zxvf FastDFS_v5.08.tar.gz</span><br><span class="line"><span class="built_in">cd</span> FastDFS</span><br><span class="line">./make.sh</span><br><span class="line">./make.sh install</span><br></pre></td></tr></table></figure>

<h1 id="配置-FastDFS（both）"><a href="#配置-FastDFS（both）" class="headerlink" title="配置 FastDFS（both）"></a>配置 FastDFS（both）</h1><h2 id="配置-tracker"><a href="#配置-tracker" class="headerlink" title="配置 tracker"></a>配置 tracker</h2><p>拷贝配置文件：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> /etc/fdfs/tracker.conf.sample /etc/fdfs/tracker.conf</span><br></pre></td></tr></table></figure>

<p>修改 <code>/etc/fdfs/tracker.conf</code> 参数：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">base_path=/home/fastdfs_data/tracker</span><br></pre></td></tr></table></figure>

<p>启动 tracker 进程：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf restart</span><br></pre></td></tr></table></figure>

<h2 id="配置-storage"><a href="#配置-storage" class="headerlink" title="配置 storage"></a>配置 storage</h2><p>拷贝配置文件：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> /etc/fdfs/storage.conf.sample /etc/fdfs/storage.conf</span><br></pre></td></tr></table></figure>

<p>修改 <code>/etc/fdfs/storage.conf</code> 参数：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">base_path=/home/fastdfs_data/storage</span><br><span class="line">store_path0=/home/fastdfs_data</span><br><span class="line">tracker_server=192.168.115.131:22122</span><br><span class="line">tracker_server=192.168.115.132:22122</span><br></pre></td></tr></table></figure>

<p>启动 storage：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/usr/bin/fdfs_storaged /etc/fdfs/storage.conf restart</span><br></pre></td></tr></table></figure>

<h2 id="配置-client"><a href="#配置-client" class="headerlink" title="配置 client"></a>配置 client</h2><p>拷贝配置文件：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> /etc/fdfs/client.conf.sample /etc/fdfs/client.conf</span><br></pre></td></tr></table></figure>

<p>修改 <code>/etc/fdfs/client.conf</code> 参数：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">base_path=/home/fastdfs_data/client</span><br><span class="line">tracker_server=192.168.115.131:22122</span><br><span class="line">tracker_server=192.168.115.132:22122</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fdfs_test /etc/fdfs/client.conf upload Lighthouse.jpg</span><br></pre></td></tr></table></figure>

<p>以下输出表示配置正确：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">    This is FastDFS client <span class="built_in">test</span> program v5.08</span><br><span class="line"></span><br><span class="line">Copyright (C) 2008, Happy Fish / YuQing</span><br><span class="line"></span><br><span class="line">FastDFS may be copied only under the terms of the GNU General</span><br><span class="line">Public License V3, <span class="built_in">which</span> may be found <span class="keyword">in</span> the FastDFS <span class="built_in">source</span> kit.</span><br><span class="line">Please visit the FastDFS Home Page http://www.csource.org/</span><br><span class="line"><span class="keyword">for</span> more detail.</span><br><span class="line"></span><br><span class="line">[2016-09-14 15:05:58] DEBUG - base_path=/home/fastdfs_data/client, connect_timeout=30, network_timeout=60, tracker_server_count=2, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server <span class="built_in">id</span> count: 0</span><br><span class="line"></span><br><span class="line">tracker_query_storage_store_list_without_group:</span><br><span class="line">    server 1. group_name=, ip_addr=192.168.115.131, port=23000</span><br><span class="line">    server 2. group_name=, ip_addr=192.168.115.132, port=23000</span><br><span class="line"></span><br><span class="line">group_name=group1, ip_addr=192.168.115.132, port=23000</span><br><span class="line">storage_upload_by_filename</span><br><span class="line">group_name=group1, remote_filename=M00/00/00/wKhzhFfY9taAOvjKAAiQfKHDaaQ960.jpg</span><br><span class="line"><span class="built_in">source</span> ip address: 192.168.115.132</span><br><span class="line">file timestamp=2016-09-14 15:05:58</span><br><span class="line">file size=561276</span><br><span class="line">file crc32=2713938340</span><br><span class="line">example file url: http://192.168.115.131/group1/M00/00/00/wKhzhFfY9taAOvjKAAiQfKHDaaQ960.jpg</span><br><span class="line">storage_upload_slave_by_filename</span><br><span class="line">group_name=group1, remote_filename=M00/00/00/wKhzhFfY9taAOvjKAAiQfKHDaaQ960_big.jpg</span><br><span class="line"><span class="built_in">source</span> ip address: 192.168.115.132</span><br><span class="line">file timestamp=2016-09-14 15:05:58</span><br><span class="line">file size=561276</span><br><span class="line">file crc32=2713938340</span><br><span class="line">example file url: http://192.168.115.131/group1/M00/00/00/wKhzhFfY9taAOvjKAAiQfKHDaaQ960_big.jpg</span><br></pre></td></tr></table></figure>

<h1 id="编译安装配置-nginx（test01）"><a href="#编译安装配置-nginx（test01）" class="headerlink" title="编译安装配置 nginx（test01）"></a>编译安装配置 nginx（test01）</h1><h2 id="配置-fastdfs-nginx-module"><a href="#配置-fastdfs-nginx-module" class="headerlink" title="配置 fastdfs-nginx-module"></a>配置 fastdfs-nginx-module</h2><p>解压修改配置文件：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/fastdfs</span><br><span class="line">tar -zxvf fastdfs-nginx-module_v1.16.tar.gz</span><br></pre></td></tr></table></figure>

<p>修改 <code>fastdfs-nginx-module/src/config</code> 参数：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">CORE_INCS=<span class="string">&quot;<span class="variable">$CORE_INCS</span> /usr/include/fastdfs /usr/include/fastcommon/&quot;</span></span><br></pre></td></tr></table></figure>

<p>拷贝配置文件：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> /root/fastdfs/FastDFS/conf/http.conf /etc/fdfs/</span><br><span class="line"><span class="built_in">cp</span> /root/fastdfs/FastDFS/conf/mime.types /etc/fdfs/</span><br><span class="line"><span class="built_in">cp</span> /root/fastdfs/fastdfs-nginx-module/src/mod_fastdfs.conf /etc/fdfs</span><br></pre></td></tr></table></figure>

<p> 修改 <code>/etc/fdfs/mod_fastdfs.conf</code> 参数：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">base_path=/home/fastdfs_data/module</span><br><span class="line">tracker_server=192.168.115.131:22122</span><br><span class="line">tracker_server=192.168.115.132:22122</span><br><span class="line">url_have_group_name = <span class="literal">true</span></span><br><span class="line">store_path0=/home/fastdfs_data</span><br></pre></td></tr></table></figure>

<h2 id="编译安装-nginx"><a href="#编译安装-nginx" class="headerlink" title="编译安装 nginx"></a>编译安装 nginx</h2><p>yum 安装依赖包：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install -y gcc gcc-c++ pcre pcre-devel zlib zlib-devel openssl openssl-devel</span><br></pre></td></tr></table></figure>

<p>创建日志目录：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /usr/local/nginx /var/log/nginx /var/temp/nginx /var/lock/nginx</span><br></pre></td></tr></table></figure>

<p>编译 nginx：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/fastdfs</span><br><span class="line">tar -zxvf nginx-1.10.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> nginx-1.10.1</span><br><span class="line">./configure \</span><br><span class="line">--prefix=/usr/local/nginx \</span><br><span class="line">--pid-path=/var/local/nginx/nginx.pid \</span><br><span class="line">--lock-path=/var/lock/nginx/nginx.lock \</span><br><span class="line">--error-log-path=/var/log/nginx/error.log \</span><br><span class="line">--http-log-path=/var/log/nginx/access.log \</span><br><span class="line">--with-http_gzip_static_module \</span><br><span class="line">--http-client-body-temp-path=/var/temp/nginx/client \</span><br><span class="line">--http-proxy-temp-path=/var/temp/nginx/proxy \</span><br><span class="line">--http-fastcgi-temp-path=/var/temp/nginx/fastcgi \</span><br><span class="line">--http-uwsgi-temp-path=/var/temp/nginx/uwsgi \</span><br><span class="line">--http-scgi-temp-path=/var/temp/nginx/scgi \</span><br><span class="line">--add-module=/root/fastdfs/fastdfs-nginx-module/src</span><br></pre></td></tr></table></figure>

<p>安装 nginx：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>修改 <code>/usr/local/nginx/conf/nginx.conf</code> 参数：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">user  root;</span><br><span class="line">        location /group1/M00 &#123;</span><br><span class="line">           ngx_fastdfs_module;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>

<p>启动 nginx：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx</span><br></pre></td></tr></table></figure>

<p>浏览器访问测试：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.115.131/group1/M00/00/00/wKhzhFfY9taAOvjKAAiQfKHDaaQ960_big.jpg</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>linux</category>
        <category>file system</category>
      </categories>
      <tags>
        <tag>fastdfs</tag>
      </tags>
  </entry>
  <entry>
    <title>Gitlab 发送邮件配置</title>
    <url>/2018/12/21/gitlab-config-mail/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/gitlab-config-mail.png" alt="Gitlab 发送邮件配置"></p>
<p>生产环境 GitLab 发送邮件失败，检查发现是阿里云邮箱强制使用加密端口导致，修改相应配置后问题解决。</p>
<blockquote>
<p>GitLab 版本：9.5.10</p>
</blockquote>
<span id="more"></span>

<h1 id="Gitlab-发送邮件配置"><a href="#Gitlab-发送邮件配置" class="headerlink" title="Gitlab 发送邮件配置"></a>Gitlab 发送邮件配置</h1><p>修改配置文件 <code>/etc/gitlab/gitlab.rb</code>:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 原配置：</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_enable&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_address&#x27;</span>] = <span class="string">&quot;smtp.test.cn&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_user_name&#x27;</span>] = <span class="string">&quot;gitlab@test.cn&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_password&#x27;</span>] = <span class="string">&quot;XXXXXXXXXXXXX&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_domain&#x27;</span>] = <span class="string">&quot;test.cn&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_authentication&#x27;</span>] = <span class="string">&quot;login&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;gitlab_email_from&#x27;</span>] = <span class="string">&quot;gitlab@test.cn&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_enable_starttls_auto&#x27;</span>] = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改端口：</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_port&#x27;</span>] = 465</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加如下配置：</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_tls&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_openssl_verify_mode&#x27;</span>] = <span class="string">&quot;none&quot;</span></span><br></pre></td></tr></table></figure>

<p>重新配置 gitlab：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure>

<p>验证：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gitlab-rails console</span><br><span class="line">Notify.test_email(<span class="string">&#x27;imtimwang@google.com&#x27;</span>, <span class="string">&#x27;Message Subject&#x27;</span>, <span class="string">&#x27;Message Body&#x27;</span>).deliver_now</span><br></pre></td></tr></table></figure>

<p>邮件发送成功，问题解决。</p>
]]></content>
      <categories>
        <category>revision control</category>
        <category>gitlab</category>
      </categories>
      <tags>
        <tag>gitlab</tag>
      </tags>
  </entry>
  <entry>
    <title>GitLab 版本升级测试</title>
    <url>/2017/03/17/gitlab-upgrade-test/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/gitlab-upgrade-test.png" alt="GitLab 版本升级测试"></p>
<p>生产环境的 GitLab 版本比较老，计划升级到最新版本，以下为测试步骤。</p>
<blockquote>
<p>操作系统版本：CentOS 6.7 x86_64</p>
<p>GitLab 版本：7.14.1 升级到 8.17.3</p>
</blockquote>
<span id="more"></span>

<h1 id="安装-GitLab-7-14-1"><a href="#安装-GitLab-7-14-1" class="headerlink" title="安装 GitLab 7.14.1"></a>安装 GitLab 7.14.1</h1><p>关闭 selinux 和 iptables 。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">setenforce 0</span><br><span class="line">sed -i <span class="string">&#x27;s/^SELINUX=.*$/SELINUX=disabled/&#x27;</span> /etc/selinux/config</span><br><span class="line">chkconfig iptables off</span><br></pre></td></tr></table></figure>

<p>添加 163 YUM 源 。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rename .repo .bak /etc/yum.repos.d/*.repo</span><br><span class="line">wget http://mirrors.163.com/.help/CentOS6-Base-163.repo</span><br><span class="line">sed -i <span class="string">&#x27;s@^exclude@#exclude@&#x27;</span> /etc/yum.conf</span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>

<p>安装 GitLab 所需依赖。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install curl openssh-server openssh-clients postfix cronie</span><br><span class="line">service postfix start</span><br><span class="line">chkconfig postfix on</span><br></pre></td></tr></table></figure>

<p>安装 GitLab 7.14.1。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -ivh gitlab-ce-7.14.1-ce.0.el6.x86_64.rpm</span><br></pre></td></tr></table></figure>

<h1 id="导入-GitLab-数据"><a href="#导入-GitLab-数据" class="headerlink" title="导入 GitLab 数据"></a>导入 GitLab 数据</h1><p>拷贝生产环境的 GitLab 备份到 <code>/var/opt/gitlab/backups/</code> 目录。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1489612446_gitlab_backup.tar</span><br></pre></td></tr></table></figure>

<p>还原 GitLab 数据。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gitlab-ctl stop unicorn</span><br><span class="line">gitlab-ctl stop sidekiq</span><br><span class="line">gitlab-rake gitlab:backup:restore BACKUP=1489612446</span><br></pre></td></tr></table></figure>

<h1 id="升级-GitLab-版本"><a href="#升级-GitLab-版本" class="headerlink" title="升级 GitLab 版本"></a>升级 GitLab 版本</h1><p>因为 GitLab 官网下载速度慢，所以添加清华大学 <a href="https://mirror.tuna.tsinghua.edu.cn/help/gitlab-ce">GitLab 的 YUM 源</a>  进行安装。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> gitlab-ce.repo</span><br><span class="line">[gitlab-ce]</span><br><span class="line">name=gitlab-ce</span><br><span class="line">baseurl=http://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el6</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://packages.gitlab.com/gpg.key</span><br></pre></td></tr></table></figure>

<p>yum 更新缓存。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure>

<p>发现下载速度不够快，尝试更换 DNS 解决。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/resolv.conf</span><br><span class="line">nameserver 114.114.114.114</span><br></pre></td></tr></table></figure>

<p>升级 GitLab 版本到 8.17.3 。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum update gitlab-ce.x86_64</span><br></pre></td></tr></table></figure>

<p>升级完成后，登录新版的 GitLab 进行测试，没有问题。</p>
]]></content>
      <categories>
        <category>revision control</category>
        <category>gitlab</category>
      </categories>
      <tags>
        <tag>gitlab</tag>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>安装配置 GlusterFS 文件系统</title>
    <url>/2017/03/15/glusterfs-install-and-settings-for-test-environment/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/glusterfs-install-and-settings-for-test-environment.png" alt="安装配置 GlusterFS 文件系统"></p>
<p>在两台虚拟机上安装配置 GlusterFS 文件系统，用于学习与测试。</p>
<blockquote>
<p>服务器信息：test01(192.168.115.131)、test02(192.168.155.132)</p>
<p>OS版本：CentOS release 6.7 (Final)</p>
<p>GlusterFS 版本：3.8.4</p>
</blockquote>
<span id="more"></span>

<h1 id="环境准备（both）"><a href="#环境准备（both）" class="headerlink" title="环境准备（both）"></a>环境准备（both）</h1><p>修改 <code>/etc/hosts</code> 文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">192.168.115.131 test01</span><br><span class="line">192.168.115.132 test02</span><br></pre></td></tr></table></figure>

<p>安装依赖包</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install xfsprogs</span><br></pre></td></tr></table></figure>

<p>格式化挂在分区</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkfs.xfs -i size=512 /dev/sdb1</span><br><span class="line"><span class="built_in">mkdir</span> -p /data/brick1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;/dev/sdb1 /data/brick1 xfs defaults 1 2&#x27;</span> &gt;&gt; /etc/fstab</span><br><span class="line">mount -a &amp;&amp; mount</span><br></pre></td></tr></table></figure>

<h1 id="安装-glusterfs（both）"><a href="#安装-glusterfs（both）" class="headerlink" title="安装 glusterfs（both）"></a>安装 glusterfs（both）</h1><p>安装软件包</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install -y centos-release-gluster</span><br><span class="line">yum install glusterfs-server</span><br><span class="line">service glusterd start</span><br></pre></td></tr></table></figure>

<p>查看版本信息</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gluster --version</span><br><span class="line">glusterfs 3.8.4 built on Sep  9 2016 17:31:23</span><br><span class="line">Repository revision: git://git.gluster.com/glusterfs.git</span><br><span class="line">Copyright (c) 2006-2011 Gluster Inc. &lt;http://www.gluster.com&gt;</span><br><span class="line">GlusterFS comes with ABSOLUTELY NO WARRANTY.</span><br><span class="line">You may redistribute copies of GlusterFS under the terms of the GNU     General Public License.</span><br><span class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</span><br></pre></td></tr></table></figure>

<h1 id="配置-Replicated-Glusterfs-Volume"><a href="#配置-Replicated-Glusterfs-Volume" class="headerlink" title="配置 Replicated Glusterfs Volume"></a>配置 Replicated Glusterfs Volume</h1><p>配置可信任的池</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gluster peer probe test02  ----test01执行</span><br><span class="line">gluster peer probe test01  ----test02执行</span><br></pre></td></tr></table></figure>

<p>创建 GlusterFS volume</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /data/brick1/gv0</span><br><span class="line">gluster volume create gv0 replica 2 test01:/data/brick1/gv0 test02:/data/brick1/gv0</span><br><span class="line">gluster volume start gv0</span><br></pre></td></tr></table></figure>

<p>查看信息</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gluster volume info</span><br><span class="line">Volume Name: gv0</span><br><span class="line">Type: Replicate</span><br><span class="line">Volume ID: a0e5d4d6-15f4-40d1-8cdc-b2c2a4f074ea</span><br><span class="line">Status: Started</span><br><span class="line">Snapshot Count: 0</span><br><span class="line">Number of Bricks: 1 x 2 = 2</span><br><span class="line">Transport-<span class="built_in">type</span>: tcp</span><br><span class="line">Bricks:</span><br><span class="line">Brick1: test01:/data/brick1/gv0</span><br><span class="line">Brick2: test02:/data/brick1/gv0</span><br><span class="line">Options Reconfigured:</span><br><span class="line">transport.address-family: inet</span><br><span class="line">performance.readdir-ahead: on</span><br><span class="line">nfs.disable: on</span><br></pre></td></tr></table></figure>

<h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><p>客户端安装卷，测试文件写入，为了简便操作，直接在server端进行测试：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mount -t glusterfs test01:/gv0 /mnt</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">seq</span> -w 1 100`; <span class="keyword">do</span> <span class="built_in">cp</span> -rp /var/log/messages /mnt/copy-test-<span class="variable">$i</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>如果安装 client 端进行测试，安装所需依赖包命令如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum -y install glusterfs glusterfs-fuse</span><br></pre></td></tr></table></figure>

<h1 id="GlusterFS-架构"><a href="#GlusterFS-架构" class="headerlink" title="GlusterFS 架构"></a>GlusterFS 架构</h1><p><a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/Distributed-Glusterfs-Volume.png">Distributed Glusterfs Volume：</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gluster volume create test-volume server1:/exp1 server2:/exp2 server3:/exp3 server4:/exp4</span><br></pre></td></tr></table></figure>

<p><a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/Replicated-Glusterfs-Volume.png">Replicated Glusterfs Volume：</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gluster volume create test-volume replica 2 transport tcp server1:/exp1 server2:/exp2</span><br></pre></td></tr></table></figure>

<p><a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/Distributed-Replicated-Glusterfs-Volume.png">Distributed Replicated Glusterfs Volume：</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gluster volume create test-volume replica 2 transport tcp server1:/exp1 server2:/exp2 server3:/exp3 server4:/exp4</span><br></pre></td></tr></table></figure>

<p><a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/Striped-Glusterfs-Volume.png">Striped Glusterfs Volume：</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gluster volume create test-volume stripe 2 transport tcp server1:/exp1 server2:/exp2</span><br></pre></td></tr></table></figure>

<p><a href="https://iamtimwang.oss-cn-beijing.aliyuncs.com/Distributed-Striped-Glusterfs-Volume.png">Distributed Striped Glusterfs Volume：</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gluster volume create test-volume stripe 4 transport tcp server1:/exp1 server2:/exp2 server3:/exp3 server4:/exp4 server5:/exp5 server6:/exp6 server7:/exp7 server8:/exp8</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>linux</category>
        <category>file system</category>
      </categories>
      <tags>
        <tag>glusterfs</tag>
      </tags>
  </entry>
  <entry>
    <title>goproxy 代理服务器安装与配置</title>
    <url>/2019/09/23/goproxy-install/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/goproxy-install.png" alt="goproxy 代理服务器安装与配置"></p>
<p>最近国家严厉封禁 Shadowsocks，为了能够继续玩耍，只能暂时停用 ss 翻墙。在网上找到 <a href="https://github.com/snail007/goproxy">goproxy</a> 这个项目，代理功能全面并且配置简单，自然要品鉴一番。</p>
<blockquote>
<p>准备一台可以访问<strong>外网</strong>的 VPS<br>VPS 外网 IP：111.111.111.111<br>VPS 端口：44444<br>OS：CentOS 7.6 x86_64<br>goproxy 版本：8.3</p>
</blockquote>
<span id="more"></span>

<h1 id="安装-goproxy"><a href="#安装-goproxy" class="headerlink" title="安装 goproxy"></a>安装 goproxy</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> goproxy &amp;&amp; <span class="built_in">cd</span> goproxy</span><br><span class="line">wget https://github.com/snail007/goproxy/releases/download/v8.3/proxy-linux-amd64.tar.gz</span><br><span class="line">tar -zxvf proxy-linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>

<h1 id="配置-goproxy"><a href="#配置-goproxy" class="headerlink" title="配置 goproxy"></a>配置 goproxy</h1><p>根据自身的网络环境，需要配置 HTTP 二级代理(加密)。</p>
<h2 id="VPS-配置一级代理"><a href="#VPS-配置一级代理" class="headerlink" title="VPS 配置一级代理"></a>VPS 配置一级代理</h2><p>创建证书和 key 用于加密传输：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./proxy keygen -C proxy</span><br></pre></td></tr></table></figure>

<p>启动一级代理服务：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./proxy http -t tls -p <span class="string">&quot;:44444&quot;</span> -g <span class="string">&quot;111.111.111.111&quot;</span>  -C proxy.crt -K proxy.key --forever --<span class="built_in">log</span> proxy.log --daemon</span><br></pre></td></tr></table></figure>

<h2 id="客户端配置二级代理"><a href="#客户端配置二级代理" class="headerlink" title="客户端配置二级代理"></a>客户端配置二级代理</h2><p>我的客户端是 Windows 10 系统，所以需要下载解压 Windows 版本 <a href="https://github.com/snail007/goproxy/releases/download/v8.3/proxy-windows-amd64.tar.gz">goproxy</a> 程序。解压完成后，把 VPS 上生成的证书和 Key 放到 .cert 目录。</p>
<p>启动二级代理服务：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">proxy.exe http -t tcp -p <span class="string">&quot;:8080&quot;</span> -T tls -P <span class="string">&quot;111.111.111.111:44444&quot;</span> -C .cert/proxy.crt -K .cert/proxy.key</span><br></pre></td></tr></table></figure>

<h2 id="浏览器配置代理"><a href="#浏览器配置代理" class="headerlink" title="浏览器配置代理"></a>浏览器配置代理</h2><p>以 Chrome 设置步骤：点击浏览器【设置】–【高级】–【打开代理设置】–【连接】–【局域网设置】–勾选【为 LAN 使用代理服务器】项；地址栏填入：127.0.0.1；端口栏填入：8080；</p>
<p>配置完成后，即可悠哉的欣赏废青们的表演了。真乃翻墙利器！！！</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="https://snail007.github.io/goproxy/manual/zh/">goproxy 中文手册</a></li>
</ul>
]]></content>
      <categories>
        <category>other</category>
      </categories>
      <tags>
        <tag>goproxy</tag>
      </tags>
  </entry>
  <entry>
    <title>安装配置 Tomcat 7</title>
    <url>/2018/07/17/install-and-settings-for-tomcat/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/install-and-settings-for-tomcat.png" alt="安装配置 Tomcat 7"></p>
<p>在 CentOS6 上安装配置 tomcat 7。</p>
<blockquote>
<p>CentOS 版本：6.7 x86_64<br>Tomcat 版本：7.0.81<br>JDK 版本：1.8.0_144  </p>
</blockquote>
<span id="more"></span>

<h1 id="安装-JDK"><a href="#安装-JDK" class="headerlink" title="安装 JDK"></a>安装 JDK</h1><ol>
<li>上传 JDK 安装包：<code>jdk-8u144-linux-x64.rpm</code></li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -ivh jdk-8u144-linux-x64.rpm</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>查看 JDK 版本</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">java -version</span><br><span class="line">java version <span class="string">&quot;1.8.0_144&quot;</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_144-b01)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.144-b01, mixed mode)</span><br></pre></td></tr></table></figure>

<h1 id="安装-Tomcat"><a href="#安装-Tomcat" class="headerlink" title="安装 Tomcat"></a>安装 Tomcat</h1><p>上传解压 Tomcat 程序：<code>apache-tomcat-7.0.81.tar.gz</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar xvf apache-tomcat-7.0.81.tar.gz</span><br><span class="line"><span class="built_in">mv</span> apache-tomcat-7.0.81 /usr/local/tomcat</span><br></pre></td></tr></table></figure>

<h1 id="配置-Tomcat"><a href="#配置-Tomcat" class="headerlink" title="配置 Tomcat"></a>配置 Tomcat</h1><ol>
<li>修改 <code>server.xml</code> 文件</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;Connector port=<span class="string">&quot;8080&quot;</span></span><br><span class="line">    protocol=<span class="string">&quot;org.apache.coyote.http11.Http11NioProtocol&quot;</span></span><br><span class="line">    URIEncoding=<span class="string">&quot;UTF-8&quot;</span></span><br><span class="line">    useBodyEncodingForURI=<span class="string">&quot;true&quot;</span></span><br><span class="line">    enableLookups=<span class="string">&quot;false&quot;</span></span><br><span class="line">    connectionTimeout=<span class="string">&quot;20000&quot;</span></span><br><span class="line">    redirectPort=<span class="string">&quot;8443&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>设置内存</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /usr/local/tomcat/bin/setenv.sh &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">JAVA_OPTS=&quot;-Xms1024m -Xmx1024m -Xss256K&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/tomcat/bin/setenv.sh</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>隐藏 tomcat 版本号</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/tomcat/lib</span><br><span class="line"><span class="built_in">mkdir</span> <span class="built_in">test</span></span><br><span class="line"><span class="built_in">cd</span> <span class="built_in">test</span></span><br><span class="line">jar xf ../catalina.jar</span><br><span class="line">vi org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">server.info=</span><br><span class="line">server.number=</span><br><span class="line">server.built=</span><br><span class="line">jar cf ../catalina.jar ./*</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">rm</span> -rf <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>配置 tomcat 日志切割</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/logrotate.d/tomcat</span><br><span class="line">/usr/local/tomcat/logs/catalina.out &#123;</span><br><span class="line">daily</span><br><span class="line">rotate 5</span><br><span class="line">missingok</span><br><span class="line">dateext</span><br><span class="line">compress</span><br><span class="line">notifempty</span><br><span class="line">copytruncate</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>清空 tomcat 应用</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/tomcat/webapps</span><br><span class="line"><span class="built_in">rm</span> -rf docs examples host-manager manager ROOT</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>创建 tomcat 启动脚本</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/init.d/tomcat</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># chkconfig: - 95 15</span></span><br><span class="line"><span class="comment"># description: Tomcat start/stop/status script</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Location of JAVA_HOME (bin files)</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr</span><br><span class="line"></span><br><span class="line"><span class="comment">#Add Java binary files to PATH</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#CATALINA_HOME is the location of the configuration files of this instance of Tomcat</span></span><br><span class="line">CATALINA_HOME=/usr/local/tomcat</span><br><span class="line"></span><br><span class="line"><span class="comment">#TOMCAT_USER is the default user of tomcat</span></span><br><span class="line">TOMCAT_USER=root</span><br><span class="line"></span><br><span class="line"><span class="comment">#TOMCAT_USAGE is the message if this script is called without any options</span></span><br><span class="line">TOMCAT_USAGE=<span class="string">&quot;Usage: <span class="variable">$0</span> &#123;\e[00;32mstart\e[00m|\e[00;31mstop\e[00m|\e[00;32mstatus\e[00m|\e[00;31mrestart\e[00m&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#SHUTDOWN_WAIT is wait time in seconds for java proccess to stop</span></span><br><span class="line">SHUTDOWN_WAIT=20</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">tomcat_pid</span></span>() &#123;</span><br><span class="line">        <span class="built_in">echo</span> `ps -ef | grep <span class="variable">$CATALINA_HOME</span>/ | grep -v grep | <span class="built_in">tr</span> -s <span class="string">&quot; &quot;</span>|<span class="built_in">cut</span> -d<span class="string">&quot; &quot;</span> -f2`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">start</span></span>() &#123;</span><br><span class="line">pid=$(tomcat_pid)</span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$pid</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\e[00;31mTomcat is already running (pid: <span class="variable">$pid</span>)\e[00m&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\e[00;32mStarting tomcat\e[00m&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [ `user_exists <span class="variable">$TOMCAT_USER</span>` = <span class="string">&quot;1&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    su <span class="variable">$TOMCAT_USER</span> -c <span class="variable">$CATALINA_HOME</span>/bin/startup.sh</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="variable">$CATALINA_HOME</span>/bin/startup.sh</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    status</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">return</span> 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">status</span></span>()&#123;</span><br><span class="line">pid=$(tomcat_pid)</span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$pid</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\e[00;32mTomcat is running with pid: <span class="variable">$pid</span>\e[00m&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\e[00;31mTomcat is not running\e[00m&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">stop</span></span>() &#123;</span><br><span class="line">pid=$(tomcat_pid)</span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$pid</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\e[00;31mStoping Tomcat\e[00m&quot;</span></span><br><span class="line">        <span class="variable">$CATALINA_HOME</span>/bin/shutdown.sh</span><br><span class="line"></span><br><span class="line">    <span class="built_in">let</span> kwait=<span class="variable">$SHUTDOWN_WAIT</span></span><br><span class="line">    count=0;</span><br><span class="line">    until [ `ps -p <span class="variable">$pid</span> | grep -c <span class="variable">$pid</span>` = <span class="string">&#x27;0&#x27;</span> ] || [ <span class="variable">$count</span> -gt <span class="variable">$kwait</span> ]</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n -e <span class="string">&quot;\e[00;31mwaiting for processes to exit\e[00m\n&quot;</span>;</span><br><span class="line">    <span class="built_in">sleep</span> 1</span><br><span class="line">    <span class="built_in">let</span> count=<span class="variable">$count</span>+1;</span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$count</span> -gt <span class="variable">$kwait</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> -n -e <span class="string">&quot;\n\e[00;31mkilling processes which didn&#x27;t stop after <span class="variable">$SHUTDOWN_WAIT</span> seconds\e[00m&quot;</span></span><br><span class="line">    <span class="built_in">kill</span> -9 <span class="variable">$pid</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\e[00;31mTomcat is not running\e[00m&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">return</span> 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">user_exists</span></span>()&#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">id</span> -u <span class="variable">$1</span> &gt;/dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">        start)</span><br><span class="line">        start</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">        stop)</span><br><span class="line">        stop</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">        restart)</span><br><span class="line">        stop</span><br><span class="line">        start</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">        status)</span><br><span class="line">    status</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">        *)</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="variable">$TOMCAT_USAGE</span></span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>设置 tomcat 服务自启动</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service tomcat start</span><br><span class="line">chkconfig --add tomcat</span><br><span class="line">chkconfig tomcat on</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>linux</category>
        <category>tomcat</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>GitLab 安装、迁移和升级</title>
    <url>/2017/03/15/gitlab-install-migration-upgrade/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/gitlab-install-migration-upgrade.png" alt="GitLab 安装、迁移和升级"></p>
<p>记录GitLab 安装、迁移和升级命令。</p>
<blockquote>
<p>安装介质可以从 <a href="https://packages.gitlab.com/gitlab/gitlab-ce">gitlab 官网</a> 选择对应的操作系统版本进行下载</p>
<p>操作系统版本：CentOS 6.5_64</p>
<p>GitLab 版本：7.14.1</p>
</blockquote>
<span id="more"></span>

<h1 id="GitLab-安装"><a href="#GitLab-安装" class="headerlink" title="GitLab 安装"></a>GitLab 安装</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install curl openssh-server postfix cronie</span><br><span class="line">service postfix start</span><br><span class="line">chkconfig postfix on</span><br><span class="line">chkconfig iptables off</span><br><span class="line">service iptables stop</span><br><span class="line">rpm -ivh gitlab-ce-7.14.1-ce.0.el6.x86_64.rpm</span><br></pre></td></tr></table></figure>

<h1 id="GitLab-迁移"><a href="#GitLab-迁移" class="headerlink" title="GitLab 迁移"></a>GitLab 迁移</h1><blockquote>
<p>注意：gitlab 版本要保持一致</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> 1454176910_gitlab_backup.tar /var/opt/gitlab/backups</span><br><span class="line">gitlab-ctl stop unicorn</span><br><span class="line">gitlab-ctl stop sidekiq</span><br><span class="line">gitlab-rake gitlab:backup:restore BACKUP=1454176910</span><br><span class="line">gitlab-ctl start</span><br></pre></td></tr></table></figure>

<h1 id="GitLab-升级"><a href="#GitLab-升级" class="headerlink" title="GitLab 升级"></a>GitLab 升级</h1><blockquote>
<p>注意：gitlab 服务器升级版本会自动备份</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -Uvh gitlab-ce-8.3.1-ce.1.el6.x86_64.rpm</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>revision control</category>
        <category>gitlab</category>
      </categories>
      <tags>
        <tag>gitlab</tag>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>二进制安装 MySQL 5.7.18</title>
    <url>/2017/04/26/install-mysql-5.7.18-for-generic-binaries/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/install-mysql-5.7.18-for-generic-binaries.png" alt="二进制安装 MySQL 5.7.18"></p>
<p>使用二进制文件安装 MySQL 5.7.18。</p>
<blockquote>
<p>CentOS 版本：6.7 x86_64</p>
<p>MySQL 版本：5.7.18</p>
</blockquote>
<span id="more"></span>

<h1 id="安装-MySQL"><a href="#安装-MySQL" class="headerlink" title="安装 MySQL"></a>安装 MySQL</h1><p>安装所需依赖包</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d</span><br><span class="line">rename .repo .bak *.repo</span><br><span class="line">wget http://mirrors.163.com/.help/CentOS6-Base-163.repo</span><br><span class="line">sed -i <span class="string">&#x27;s@^exclude@#exclude@&#x27;</span> /etc/yum.conf</span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br><span class="line">yum -y install libaio autoconf</span><br></pre></td></tr></table></figure>

<p>解压 MySQL</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line">wget http://mirrors.sohu.com/mysql/MySQL-5.7/mysql-5.7.18-linux-glibc2.5-x86_64.tar.gz</span><br><span class="line">tar xvf mysql-5.7.18-linux-glibc2.5-x86_64.tar.gz</span><br><span class="line"><span class="built_in">mv</span> mysql-5.7.18-linux-glibc2.5-x86_64 /usr/local/mysql</span><br></pre></td></tr></table></figure>

<h1 id="安装-jemalloc-4-5-0"><a href="#安装-jemalloc-4-5-0" class="headerlink" title="安装 jemalloc 4.5.0"></a>安装 jemalloc 4.5.0</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line">wget https://github.com/jemalloc/jemalloc/archive/4.5.0.tar.gz</span><br><span class="line">tar xvf 4.5.0.tar.gz</span><br><span class="line"><span class="built_in">cd</span> jemalloc-4.5.0</span><br><span class="line">./autogen.sh</span><br><span class="line">make &amp;&amp; make install_bin install_include install_lib</span><br><span class="line"><span class="built_in">ln</span> -s /usr/local/lib/libjemalloc.so.2 /usr/lib64/libjemalloc.so.1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;/usr/local/lib&#x27;</span> &gt; /etc/ld.so.conf.d/local.conf</span><br><span class="line">ldconfig</span><br></pre></td></tr></table></figure>

<h1 id="配置初始化-MySQL"><a href="#配置初始化-MySQL" class="headerlink" title="配置初始化 MySQL"></a>配置初始化 MySQL</h1><p>添加 MySQL 环境变量</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export PATH=/usr/local/mysql/bin:<span class="variable">$PATH</span>&quot;</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>

<p>添加 MySQL 用户</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">groupadd mysql</span><br><span class="line">useradd -r -g mysql -s /bin/false mysql</span><br></pre></td></tr></table></figure>

<p>添加目录权限</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R mysql:mysql /usr/local/mysql</span><br><span class="line"><span class="built_in">mkdir</span> -p /home/mysql/data /home/mysql/bin-log /home/mysql/relay-log /home/mysql/log</span><br><span class="line"><span class="built_in">chown</span> -R mysql:mysql /home/mysql</span><br></pre></td></tr></table></figure>

<p>配置 MySQL 服务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line">sed -i <span class="string">&quot;s@^basedir=.*@basedir=/usr/local/mysql@&quot;</span> /etc/init.d/mysqld</span><br><span class="line">sed -i <span class="string">&quot;s@^datadir=.*@datadir=/home/mysql/data@&quot;</span> /etc/init.d/mysqld</span><br><span class="line"><span class="built_in">chmod</span> +x /etc/init.d/mysqld</span><br><span class="line">chkconfig --add mysqld</span><br><span class="line">chkconfig mysqld on</span><br></pre></td></tr></table></figure>

<p>添加 MySQL 配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/my.cnf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[client]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">port                           = 3306</span></span><br><span class="line"><span class="string">default-character-set          = utf8</span></span><br><span class="line"><span class="string">socket                         = /home/mysql/data/mysql.sock</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysql]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">port                           = 3306</span></span><br><span class="line"><span class="string">default-character-set          = utf8</span></span><br><span class="line"><span class="string">socket                         = /home/mysql/data/mysql.sock</span></span><br><span class="line"><span class="string">prompt                         = &#x27;MySQL[\\u@\\d]&gt; &#x27;</span></span><br><span class="line"><span class="string">no-auto-rehash</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqld]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># GENERAL #</span></span><br><span class="line"><span class="string">user                           = mysql</span></span><br><span class="line"><span class="string">default-storage-engine         = InnoDB</span></span><br><span class="line"><span class="string">socket                         = /home/mysql/data/mysql.sock</span></span><br><span class="line"><span class="string">pid-file                       = /home/mysql/data/mysql.pid</span></span><br><span class="line"><span class="string">character-set-server           = utf8</span></span><br><span class="line"><span class="string">port                           = 3306</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># MyISAM #</span></span><br><span class="line"><span class="string">key-buffer-size                = 32M</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># SAFETY #</span></span><br><span class="line"><span class="string">max-allowed-packet             = 1024M</span></span><br><span class="line"><span class="string">max-connect-errors             = 1000000</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># DATA STORAGE #</span></span><br><span class="line"><span class="string">basedir                        = /usr/local/mysql</span></span><br><span class="line"><span class="string">datadir                        = /home/mysql/data</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># BINARY LOGGING #</span></span><br><span class="line"><span class="string">server_id                      = 1</span></span><br><span class="line"><span class="string">#log-bin                       = /home/mysql/bin-log</span></span><br><span class="line"><span class="string">#expire-logs-days              = 3</span></span><br><span class="line"><span class="string">sync-binlog                    = 1</span></span><br><span class="line"><span class="string">relay_log_recovery             = 1</span></span><br><span class="line"><span class="string">relay-log                      = /home/mysql/relay-log</span></span><br><span class="line"><span class="string">binlog_format                  = row</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># CACHES AND LIMITS #</span></span><br><span class="line"><span class="string">tmp-table-size                 = 32M</span></span><br><span class="line"><span class="string">max-heap-table-size            = 32M</span></span><br><span class="line"><span class="string">query-cache-type               = 0</span></span><br><span class="line"><span class="string">query-cache-size               = 0</span></span><br><span class="line"><span class="string">max-connections                = 500</span></span><br><span class="line"><span class="string">thread-cache-size              = 50</span></span><br><span class="line"><span class="string">open-files-limit               = 65535</span></span><br><span class="line"><span class="string">table-definition-cache         = 1024</span></span><br><span class="line"><span class="string">table-open-cache               = 2048</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># INNODB #</span></span><br><span class="line"><span class="string">innodb-flush-method            = O_DIRECT</span></span><br><span class="line"><span class="string">innodb-log-files-in-group      = 2</span></span><br><span class="line"><span class="string">innodb-log-file-size           = 128M</span></span><br><span class="line"><span class="string">innodb-flush-log-at-trx-commit = 1</span></span><br><span class="line"><span class="string">innodb-file-per-table          = 1</span></span><br><span class="line"><span class="string">innodb-buffer-pool-size        = 1G</span></span><br><span class="line"><span class="string">innodb_buffer_pool_instances   = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Disabling symbolic-links is recommended to prevent assorted security risks</span></span><br><span class="line"><span class="string">symbolic-links                 = 0</span></span><br><span class="line"><span class="string">sql-mode                       = &quot;STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&quot;</span></span><br><span class="line"><span class="string">skip-name-resolve</span></span><br><span class="line"><span class="string">skip-external-locking</span></span><br><span class="line"><span class="string">init-connect                   = &#x27;SET NAMES utf8&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># LOGGING #</span></span><br><span class="line"><span class="string">log-error                      = /home/mysql/log/error.log</span></span><br><span class="line"><span class="string">log-queries-not-using-indexes  = 1</span></span><br><span class="line"><span class="string">#slow-query-log                = 1</span></span><br><span class="line"><span class="string">#slow-query-log-file           = /home/mysql/log/slow.log</span></span><br><span class="line"><span class="string">#general-log                   = 1</span></span><br><span class="line"><span class="string">#general_log_file              = /home/mysql/log/general.log</span></span><br><span class="line"><span class="string">#long_query_time               = 3</span></span><br><span class="line"><span class="string">log_timestamps                 = system</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqld_safe]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">log-error                      = /home/mysql/log/error.log</span></span><br><span class="line"><span class="string">socket                         = /home/mysql/data/mysql.sock</span></span><br><span class="line"><span class="string">pid-file                       = /home/mysql/data/mysql.pid</span></span><br><span class="line"><span class="string">nice                           = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqldump]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">socket                         = /home/mysql/data/mysql.sock</span></span><br><span class="line"><span class="string">quick</span></span><br><span class="line"><span class="string">max_allowed_packet             = 1024M</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[myisamchk]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">key_buffer_size                = 20M</span></span><br><span class="line"><span class="string">sort_buffer_size               = 20M</span></span><br><span class="line"><span class="string">read_buffer                    = 2M</span></span><br><span class="line"><span class="string">write_buffer                   = 2M</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqlhotcopy]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">interactive-timeout</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqld_multi]</span></span><br><span class="line"><span class="string">mysqld                         = /usr/local/mysql/bin/mysqld_safe</span></span><br><span class="line"><span class="string">mysqladmin                     = /usr/local/mysql/bin/mysqladmin</span></span><br><span class="line"><span class="string">log                            = /home/mysql/log/mysqld_multi.log</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>初始化数据库</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysqld --initialize-insecure --user=mysql --basedir=/usr/local/mysql --datadir=/home/mysql/data</span><br></pre></td></tr></table></figure>

<p>使用 jemalloc 内存分配器</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s@executing mysqld_safe@executing mysqld_safe\nexport LD_PRELOAD=/usr/local/lib/libjemalloc.so@&#x27;</span> /usr/local/mysql/bin/mysqld_safe</span><br></pre></td></tr></table></figure>

<p>启动 MySQL</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service mysqld start</span><br></pre></td></tr></table></figure>

<p>修改 root 密码</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql -e <span class="string">&quot;grant all privileges on *.* to &#x27;root&#x27;@&#x27;127.0.0.1&#x27; identified by &#x27;password&#x27; with grant option;&quot;</span></span><br><span class="line">mysql -e <span class="string">&quot;grant all privileges on *.* to &#x27;root&#x27;@&#x27;localhost&#x27; identified by &#x27;password&#x27; with grant option;&quot;</span></span><br></pre></td></tr></table></figure>

<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="https://github.com/lj2007331/oneinstack">oneinstack</a></li>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/binary-installation.html">Installing MySQL on Unix&#x2F;Linux Using Generic Binaries</a></li>
</ul>
]]></content>
      <categories>
        <category>database</category>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>源码编译安装 MySQL 5.7.18</title>
    <url>/2017/04/25/install-mysql-5.7.18-for-source/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/install-mysql-5.7.18-for-source.png" alt="源码编译安装 MySQL 5.7.18"></p>
<p>在 CentOS6 上编译安装 MySQL 5.7.18。</p>
<blockquote>
<p>CentOS 版本：6.7 x86_64</p>
<p>MySQL 版本：5.7.18</p>
</blockquote>
<span id="more"></span>

<h1 id="安装编译-MySQL"><a href="#安装编译-MySQL" class="headerlink" title="安装编译 MySQL"></a>安装编译 MySQL</h1><p>安装编译所需依赖包</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d</span><br><span class="line">rename .repo .bak *.repo</span><br><span class="line">wget http://mirrors.163.com/.help/CentOS6-Base-163.repo</span><br><span class="line">sed -i <span class="string">&#x27;s@^exclude@#exclude@&#x27;</span> /etc/yum.conf</span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br><span class="line">yum -y install wget gcc gcc-c++ ncurses ncurses-devel openssl openssl-devel cmake make perl bison autoconf</span><br></pre></td></tr></table></figure>

<p>安装 jemalloc 4.5.0</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span></span><br><span class="line">wget https://github.com/jemalloc/jemalloc/archive/4.5.0.tar.gz</span><br><span class="line">tar xvf 4.5.0.tar.gz</span><br><span class="line"><span class="built_in">cd</span> jemalloc-4.5.0</span><br><span class="line">./autogen.sh</span><br><span class="line">make &amp;&amp; make install_bin install_include install_lib</span><br><span class="line"><span class="built_in">ln</span> -s /usr/local/lib/libjemalloc.so.2 /usr/lib64/libjemalloc.so.1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;/usr/local/lib&#x27;</span> &gt; /etc/ld.so.conf.d/local.conf</span><br><span class="line">ldconfig</span><br></pre></td></tr></table></figure>

<p>解压 MySQL</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span></span><br><span class="line">wget http://mirrors.sohu.com/mysql/MySQL-5.7/mysql-boost-5.7.18.tar.gz</span><br><span class="line">tar xvf mysql-boost-5.7.18.tar.gz</span><br><span class="line"><span class="built_in">cd</span> mysql-5.7.18</span><br></pre></td></tr></table></figure>

<p>添加 MySQL 用户</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">groupadd mysql</span><br><span class="line">useradd -r -g mysql -s /bin/false mysql</span><br></pre></td></tr></table></figure>

<p>编译安装 MySQL</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake -DCMAKE_INSTALL_PREFIX=/usr/local/mysql \</span><br><span class="line">-DMYSQL_DATADIR=/home/mysql/data \</span><br><span class="line">-DWITH_BOOST=/root/mysql-5.7.18/boost/boost_1_59_0 \</span><br><span class="line">-DSYSCONFDIR=/etc \</span><br><span class="line">-DWITH_INNOBASE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_PARTITION_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_FEDERATED_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_MYISAM_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_SSL=system \</span><br><span class="line">-DENABLED_LOCAL_INFILE=1 \</span><br><span class="line">-DMYSQL_UNIX_ADDR=/home/mysql/data/mysql.sock \</span><br><span class="line">-DMYSQL_TCP_PORT=3306 \</span><br><span class="line">-DDEFAULT_CHARSET=utf8 \</span><br><span class="line">-DDEFAULT_COLLATION=utf8_general_ci \</span><br><span class="line">-DCMAKE_EXE_LINKER_FLAGS=<span class="string">&#x27;-ljemalloc&#x27;</span></span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h1 id="配置初始化-MySQL"><a href="#配置初始化-MySQL" class="headerlink" title="配置初始化 MySQL"></a>配置初始化 MySQL</h1><p>添加 MySQL 环境变量</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export PATH=/usr/local/mysql/bin:<span class="variable">$PATH</span>&quot;</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>

<p>添加目录权限</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R mysql:mysql /usr/local/mysql</span><br><span class="line"><span class="built_in">mkdir</span> -p /home/mysql/data /home/mysql/bin-log /home/mysql/relay-log /home/mysql/log</span><br><span class="line"><span class="built_in">chown</span> -R mysql:mysql /home/mysql</span><br></pre></td></tr></table></figure>

<p>初始化数据库</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysqld --initialize --user=mysql --basedir=/usr/local/mysql --datadir=/home/mysql/data</span><br></pre></td></tr></table></figure>

<p>配置 MySQL 服务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line">sed -i <span class="string">&quot;s@^basedir=.*@basedir=/usr/local/mysql@&quot;</span> /etc/init.d/mysqld</span><br><span class="line">sed -i <span class="string">&quot;s@^datadir=.*@datadir=/home/mysql/data@&quot;</span> /etc/init.d/mysqld</span><br><span class="line"><span class="built_in">chmod</span> +x /etc/init.d/mysqld</span><br><span class="line">chkconfig --add mysqld</span><br><span class="line">chkconfig mysqld on</span><br></pre></td></tr></table></figure>

<p>添加 MySQL 配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/my.cnf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[client]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">port                           = 3306</span></span><br><span class="line"><span class="string">default-character-set          = utf8</span></span><br><span class="line"><span class="string">socket                         = /home/mysql/data/mysql.sock</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysql]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">port                           = 3306</span></span><br><span class="line"><span class="string">default-character-set          = utf8</span></span><br><span class="line"><span class="string">socket                         = /home/mysql/data/mysql.sock</span></span><br><span class="line"><span class="string">prompt                         = &#x27;MySQL[\\u@\\d]&gt; &#x27;</span></span><br><span class="line"><span class="string">no-auto-rehash</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqld]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># GENERAL #</span></span><br><span class="line"><span class="string">user                           = mysql</span></span><br><span class="line"><span class="string">default-storage-engine         = InnoDB</span></span><br><span class="line"><span class="string">socket                         = /home/mysql/data/mysql.sock</span></span><br><span class="line"><span class="string">pid-file                       = /home/mysql/data/mysql.pid</span></span><br><span class="line"><span class="string">character-set-server           = utf8</span></span><br><span class="line"><span class="string">port                           = 3306</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># MyISAM #</span></span><br><span class="line"><span class="string">key-buffer-size                = 32M</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># SAFETY #</span></span><br><span class="line"><span class="string">max-allowed-packet             = 1024M</span></span><br><span class="line"><span class="string">max-connect-errors             = 1000000</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># DATA STORAGE #</span></span><br><span class="line"><span class="string">basedir                        = /usr/local/mysql</span></span><br><span class="line"><span class="string">datadir                        = /home/mysql/data</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># BINARY LOGGING #</span></span><br><span class="line"><span class="string">server_id                      = 1</span></span><br><span class="line"><span class="string">#log-bin                       = /home/mysql/bin-log</span></span><br><span class="line"><span class="string">#expire-logs-days              = 3</span></span><br><span class="line"><span class="string">sync-binlog                    = 1</span></span><br><span class="line"><span class="string">relay_log_recovery             = 1</span></span><br><span class="line"><span class="string">relay-log                      = /home/mysql/relay-log</span></span><br><span class="line"><span class="string">binlog_format                  = row</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># CACHES AND LIMITS #</span></span><br><span class="line"><span class="string">tmp-table-size                 = 32M</span></span><br><span class="line"><span class="string">max-heap-table-size            = 32M</span></span><br><span class="line"><span class="string">query-cache-type               = 0</span></span><br><span class="line"><span class="string">query-cache-size               = 0</span></span><br><span class="line"><span class="string">max-connections                = 500</span></span><br><span class="line"><span class="string">thread-cache-size              = 50</span></span><br><span class="line"><span class="string">open-files-limit               = 65535</span></span><br><span class="line"><span class="string">table-definition-cache         = 1024</span></span><br><span class="line"><span class="string">table-open-cache               = 2048</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># INNODB #</span></span><br><span class="line"><span class="string">innodb-flush-method            = O_DIRECT</span></span><br><span class="line"><span class="string">innodb-log-files-in-group      = 2</span></span><br><span class="line"><span class="string">innodb-log-file-size           = 128M</span></span><br><span class="line"><span class="string">innodb-flush-log-at-trx-commit = 1</span></span><br><span class="line"><span class="string">innodb-file-per-table          = 1</span></span><br><span class="line"><span class="string">innodb-buffer-pool-size        = 1G</span></span><br><span class="line"><span class="string">innodb_buffer_pool_instances   = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Disabling symbolic-links is recommended to prevent assorted security risks</span></span><br><span class="line"><span class="string">symbolic-links                 = 0</span></span><br><span class="line"><span class="string">sql-mode                       = &quot;STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&quot;</span></span><br><span class="line"><span class="string">skip-name-resolve</span></span><br><span class="line"><span class="string">skip-external-locking</span></span><br><span class="line"><span class="string">init-connect                   = &#x27;SET NAMES utf8&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># LOGGING #</span></span><br><span class="line"><span class="string">log-error                      = /home/mysql/log/error.log</span></span><br><span class="line"><span class="string">log-queries-not-using-indexes  = 1</span></span><br><span class="line"><span class="string">#slow-query-log                = 1</span></span><br><span class="line"><span class="string">#slow-query-log-file           = /home/mysql/log/slow.log</span></span><br><span class="line"><span class="string">#general-log                   = 1</span></span><br><span class="line"><span class="string">#general_log_file              = /home/mysql/log/general.log</span></span><br><span class="line"><span class="string">#long_query_time               = 3</span></span><br><span class="line"><span class="string">log_timestamps                 = system</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqld_safe]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">log-error                      = /home/mysql/log/error.log</span></span><br><span class="line"><span class="string">socket                         = /home/mysql/data/mysql.sock</span></span><br><span class="line"><span class="string">pid-file                       = /home/mysql/data/mysql.pid</span></span><br><span class="line"><span class="string">nice                           = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqldump]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">socket                         = /home/mysql/data/mysql.sock</span></span><br><span class="line"><span class="string">quick</span></span><br><span class="line"><span class="string">max_allowed_packet             = 1024M</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[myisamchk]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">key_buffer_size                = 20M</span></span><br><span class="line"><span class="string">sort_buffer_size               = 20M</span></span><br><span class="line"><span class="string">read_buffer                    = 2M</span></span><br><span class="line"><span class="string">write_buffer                   = 2M</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqlhotcopy]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">interactive-timeout</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqld_multi]</span></span><br><span class="line"><span class="string">mysqld                         = /usr/local/mysql/bin/mysqld_safe</span></span><br><span class="line"><span class="string">mysqladmin                     = /usr/local/mysql/bin/mysqladmin</span></span><br><span class="line"><span class="string">log                            = /home/mysql/log/mysqld_multi.log</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>创建日志文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">touch</span> /home/mysql/log/error.log</span><br><span class="line"><span class="built_in">chown</span> mysql:mysql /home/mysql/log/error.log</span><br></pre></td></tr></table></figure>

<p>启动 MySQL</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service mysqld start</span><br></pre></td></tr></table></figure>

<p>修改 root 密码</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line">alter user <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;password&#x27;</span>;</span><br><span class="line">grant all privileges on *.* to <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;127.0.0.1&#x27;</span> identified by <span class="string">&#x27;password&#x27;</span> with grant option;</span><br></pre></td></tr></table></figure>

<p>运行安全设置脚本</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql_secure_installation --no-defaults</span><br></pre></td></tr></table></figure>

<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="https://github.com/lj2007331/oneinstack">oneinstack</a></li>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/source-configuration-options.html">MySQL Source-Configuration Options</a></li>
</ul>
]]></content>
      <categories>
        <category>database</category>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7 安装 Shadowsocks 服务端</title>
    <url>/2018/12/05/install-ss-server/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/install-ss-server.png" alt="CentOS7 安装 Shadowsocks 服务端"></p>
<p>趁着阿里云做活动，开了一个轻量化应用服务器实例，在新加坡区域，测试一下可不可以搭梯子翻墙。</p>
<blockquote>
<p>CentOS 版本：7.3.1611</p>
<p>Shadowsocks 版本：2.8.2</p>
</blockquote>
<span id="more"></span>

<h1 id="安装配置-Shadowsocks-服务端"><a href="#安装配置-Shadowsocks-服务端" class="headerlink" title="安装配置 Shadowsocks 服务端"></a>安装配置 Shadowsocks 服务端</h1><p>卸载安骑士 Agent：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget http://update.aegis.aliyun.com/download/uninstall.sh</span><br><span class="line"><span class="built_in">chmod</span> +x uninstall.sh</span><br><span class="line">./uninstall.sh</span><br></pre></td></tr></table></figure>

<p>卸载云监控 Java 版本插件：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/usr/local/cloudmonitor/wrapper/bin/cloudmonitor.sh stop</span><br><span class="line">/usr/local/cloudmonitor/wrapper/bin/cloudmonitor.sh remove</span><br><span class="line"><span class="built_in">rm</span> -rf /usr/local/cloudmonitor</span><br></pre></td></tr></table></figure>

<p>安装 Shadowsocks 服务端：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install python-setuptools &amp;&amp; easy_install pip</span><br><span class="line">pip install --upgrade pip</span><br><span class="line">pip install shadowsocks</span><br></pre></td></tr></table></figure>

<p>无配置文件启动 ssserver：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssserver -s ::0 -p 443 -k 设置密码 -m aes-256-cfb --user nobody --workers 2 -d start</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>other</category>
      </categories>
      <tags>
        <tag>shadowsocks</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 5.7 使用 jemalloc 管理内存</title>
    <url>/2017/03/28/jemalloc-install/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/jemalloc-install.png" alt="MySQL 5.7 使用 jemalloc 管理内存"></p>
<p>数据库使用 jemalloc 管理内存。</p>
<blockquote>
<p>CentOS 版本：6.7 x86_64</p>
<p>MySQL 版本：5.7.12</p>
<p>jemalloc 版本：4.5.0</p>
</blockquote>
<span id="more"></span>

<h1 id="安装-jemalloc"><a href="#安装-jemalloc" class="headerlink" title="安装 jemalloc"></a>安装 jemalloc</h1><p>下载 jemalloc 程序：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://github.com/jemalloc/jemalloc/archive/4.5.0.tar.gz</span><br></pre></td></tr></table></figure>

<p>解压、编译程序：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar xvf 4.5.0.tar.gz</span><br><span class="line"><span class="built_in">cd</span> jemalloc-4.5.0</span><br><span class="line">./autogen.sh</span><br><span class="line">make &amp;&amp; make install_bin install_include install_lib</span><br><span class="line"><span class="built_in">ln</span> -s /usr/local/lib/libjemalloc.so.2 /usr/lib64/libjemalloc.so.1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;/usr/local/lib&#x27;</span> &gt; /etc/ld.so.conf.d/local.conf</span><br><span class="line">ldconfig</span><br></pre></td></tr></table></figure>

<h1 id="MySQL-加载-jemalloc"><a href="#MySQL-加载-jemalloc" class="headerlink" title="MySQL 加载 jemalloc"></a>MySQL 加载 jemalloc</h1><p>修改 MySQL 配置文件，在 <code>[mysqld_safe]</code> 里添加如下内容：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">malloc-lib=/usr/local/lib/libjemalloc.so</span><br></pre></td></tr></table></figure>

<p>重启 MySQL：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service mysqld restart</span><br></pre></td></tr></table></figure>

<p>查看 jemalloc 是否生效：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lsof -n |grep jemalloc</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>database</category>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>jemalloc</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7 安装 Shadowsocks 客户端</title>
    <url>/2018/09/12/install-ss-client/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/install-ss-client.png" alt="CentOS7 安装 Shadowsocks 客户端"></p>
<p>服务器无法访问 GG 资源，在 CentOS7 环境安装配置 Shadowsocks 客户端、Privoxy 程序，用于方便快捷的编译 Go 程序、安装 K8S 等。</p>
<blockquote>
<p>CentOS 版本：7.5 x86_64</p>
<p>Shadowsocks 版本：2.8.2</p>
<p>Privoxy 版本：3.0.26</p>
</blockquote>
<span id="more"></span>

<h1 id="安装配置-Shadowsocks"><a href="#安装配置-Shadowsocks" class="headerlink" title="安装配置 Shadowsocks"></a>安装配置 Shadowsocks</h1><p>安装 YUM 源</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install -y epel-release curl</span><br><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure>

<p>安装 pip</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install -y python-pip</span><br></pre></td></tr></table></figure>

<p>创建 pip 源</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /root/.pip</span><br><span class="line"><span class="built_in">cat</span> &gt; /root/.pip/pip.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[global]</span></span><br><span class="line"><span class="string">trusted-host =  pypi.douban.com</span></span><br><span class="line"><span class="string">index-url = http://pypi.douban.com/simple</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>升级 pip</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install --upgrade pip</span><br></pre></td></tr></table></figure>

<p>安装 shadowsocks</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install shadowsocks</span><br></pre></td></tr></table></figure>

<p>创建 shadowsocks 配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /etc/shadowsocks</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/shadowsocks/shadowsocks.json &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    &quot;server&quot;:&quot;SS 服务端 IP&quot;,</span></span><br><span class="line"><span class="string">    &quot;server_port&quot;:&quot;SS 服务端端口&quot;,</span></span><br><span class="line"><span class="string">    &quot;local_address&quot;: &quot;127.0.0.1&quot;,</span></span><br><span class="line"><span class="string">    &quot;local_port&quot;:1080,</span></span><br><span class="line"><span class="string">    &quot;password&quot;:&quot;SS 服务端密码&quot;,</span></span><br><span class="line"><span class="string">    &quot;timeout&quot;:300,</span></span><br><span class="line"><span class="string">    &quot;method&quot;:&quot;aes-256-cfb&quot;,</span></span><br><span class="line"><span class="string">    &quot;fast_open&quot;: false,</span></span><br><span class="line"><span class="string">    &quot;workers&quot;: 1</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>创建 shadowsocks 服务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/systemd/system/shadowsocks.service &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Shadowsocks</span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">TimeoutStartSec=0</span></span><br><span class="line"><span class="string">ExecStart=/usr/bin/sslocal -c /etc/shadowsocks/shadowsocks.json</span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>启动 shadowsocks 服务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> shadowsocks.service</span><br><span class="line">systemctl start shadowsocks.service</span><br><span class="line">systemctl status shadowsocks</span><br></pre></td></tr></table></figure>

<p>检查 shadowsocks 客户端配置，正常会返回 shadowsocks 服务端 IP</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl --socks5 127.0.0.1:1080 http://httpbin.org/ip</span><br></pre></td></tr></table></figure>

<h1 id="安装配置-privoxy"><a href="#安装配置-privoxy" class="headerlink" title="安装配置 privoxy"></a>安装配置 privoxy</h1><p>YUM 安装 privoxy</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install privoxy</span><br></pre></td></tr></table></figure>

<p>修改 privoxy 配置文件 <code>/etc/privoxy/config</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">listen-address 127.0.0.1:8118</span><br><span class="line">forward-socks5t / 127.0.0.1:1080 .</span><br></pre></td></tr></table></figure>

<p>启动 privoxy 服务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> privoxy</span><br><span class="line">systemctl start privoxy</span><br><span class="line">systemctl status privoxy</span><br></pre></td></tr></table></figure>

<p>设置代理环境变量</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;export http_proxy=http://127.0.0.1:8118&quot;</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;export https_proxy=http://127.0.0.1:8118&quot;</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>

<p>测试访问 GG</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl www.google.com</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>other</category>
      </categories>
      <tags>
        <tag>shadowsocks</tag>
      </tags>
  </entry>
  <entry>
    <title>HAProxy + Keepalived 配置负载均衡</title>
    <url>/2017/04/28/keepalived-haproxy-for-lb/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/keepalived-haproxy-for-lb.jpg" alt="HAProxy + Keepalived 配置负载均衡"></p>
<p>使用 4 台虚拟机配置 HAProxy + Keepalived 负载均衡。本测试环境直接进行 TCP 层转发，所有流量直接由后台的 WEB 服务器处理。</p>
<blockquote>
<p>CentOS 版本：6.7 x86_64</p>
<p>HA-Proxy 版本：1.5.18</p>
<p>Keepalived 版本：v1.2.13</p>
</blockquote>
<p>虚拟机信息如下：</p>
<table>
<thead>
<tr>
<th>服务器</th>
<th>IP地址</th>
<th>安装程序</th>
<th>VIP</th>
</tr>
</thead>
<tbody><tr>
<td>LB01</td>
<td>10.10.1.131</td>
<td>keepalived+haproxy</td>
<td>10.10.1.62</td>
</tr>
<tr>
<td>LB02</td>
<td>10.10.1.132</td>
<td>keepalived+haproxy</td>
<td></td>
</tr>
<tr>
<td>WEB01</td>
<td>10.10.1.145</td>
<td>apache+php</td>
<td></td>
</tr>
<tr>
<td>WEB02</td>
<td>10.10.1.130</td>
<td>apache+php</td>
<td></td>
</tr>
</tbody></table>
<span id="more"></span>

<h1 id="虚拟机环境准备"><a href="#虚拟机环境准备" class="headerlink" title="虚拟机环境准备"></a>虚拟机环境准备</h1><p><a href="https://iamtim.wang/2017/03/15/centos6-init">初始化配置 CentOS</a>（LB01、LB02、WEB01、WEB02）</p>
<p>配置 LAP 环境（WEB01、WEB02）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -Uvh https://mirror.webtatic.com/yum/el6/latest.rpm</span><br><span class="line">yum -y install httpd openssl mod_ssl php55w php55w-cli php55w-common php55w-gd php55w-imap php55w-ldap php55w-odbc php55w-pdo php55w-pear php55w-pear php55w-xml php55w-xmlrpc php55w-soap php55w-mysql</span><br></pre></td></tr></table></figure>

<p>修改 php.ini 参数（WEB01、WEB02）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">&quot;s@^post_max_size.*@post_max_size = 100M@&quot;</span> /etc/php.ini</span><br><span class="line">sed -i <span class="string">&quot;s@^upload_max_filesize.*@upload_max_filesize = 64M@&quot;</span> /etc/php.ini</span><br><span class="line">sed -i <span class="string">&quot;s@^max_file_uploads.*@max_file_uploads = 1000@&quot;</span> /etc/php.ini</span><br><span class="line">sed -i <span class="string">&quot;s@^mysqli.default_socket.*@mysqli.default_socket = /mysql/data/mysql.sock@&quot;</span> /etc/php.ini</span><br><span class="line">sed -i <span class="string">&quot;s@^mysqli.default_port.*@mysqli.default_port = <span class="variable">$&#123;mysql_port&#125;</span>@&quot;</span> /etc/php.ini</span><br><span class="line">sed -i <span class="string">&quot;s@^;error_log = php_errors.log.*@error_log = /var/log/httpd/php_errors.log@&quot;</span> /etc/php.ini</span><br><span class="line">sed -i <span class="string">&quot;s@^;date.timezone.*@date.timezone = Asia/Shanghai@&quot;</span> /etc/php.ini</span><br></pre></td></tr></table></figure>

<p>修改 httpd.conf 参数（WEB01、WEB02）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ServerName 127.0.0.1:80&quot;</span> &gt;&gt; /etc/httpd/conf/httpd.conf</span><br></pre></td></tr></table></figure>

<p>Apache 加载 HTTPS 证书，证书申请操作参考<a href="http://iamtim.wang/2017/03/15/letsencrypt-manual">《使用 Certbot 工具申请 Let’s Encrypt 证书》</a>。</p>
<h1 id="安装-HAProxy、Keepalived"><a href="#安装-HAProxy、Keepalived" class="headerlink" title="安装 HAProxy、Keepalived"></a>安装 HAProxy、Keepalived</h1><p>安装 HAProxy（LB01、LB02）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install haproxy</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.ipv4.ip_forward = 1&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.ipv4.ip_nonlocal_bind = 1&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br><span class="line">chkconfig haproxy on</span><br><span class="line">service haproxy start</span><br></pre></td></tr></table></figure>

<p>安装 Keepalived（LB01、LB02）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install keepalived</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.ipv4.ip_forward = 1&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br><span class="line">iptables -I INPUT -i eth0 -d 224.0.0.0/8 -p vrrp -j ACCEPT</span><br><span class="line">iptables -I OUTPUT -o eth0 -d 224.0.0.0/8 -p vrrp -j ACCEPT</span><br><span class="line">service iptables save</span><br><span class="line">chkconfig keepalived on</span><br><span class="line">service keepalived start</span><br></pre></td></tr></table></figure>

<h1 id="配置-HAProxy、Keepalived"><a href="#配置-HAProxy、Keepalived" class="headerlink" title="配置 HAProxy、Keepalived"></a>配置 HAProxy、Keepalived</h1><p>配置 Keepalived（LB01）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/keepalived/</span><br><span class="line"><span class="built_in">mv</span> keepalived.conf keepalived.conf.bak</span><br><span class="line"><span class="built_in">cat</span> &gt; keepalived.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">global_defs &#123;</span></span><br><span class="line"><span class="string">notification_email &#123;</span></span><br><span class="line"><span class="string">    wangchun@eitcn.cn</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">notification_email_from wangchun@eitcn.cn</span></span><br><span class="line"><span class="string">smtp_server smtp.eitcn.cn</span></span><br><span class="line"><span class="string">smtp_connect_timeout 30</span></span><br><span class="line"><span class="string">router_id lb-ecg</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">vrrp_script chk_haproxy &#123;</span></span><br><span class="line"><span class="string">    script &quot;killall -0 haproxy&quot;</span></span><br><span class="line"><span class="string">    interval 1</span></span><br><span class="line"><span class="string">    weight -2</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">vrrp_instance VI_1 &#123;</span></span><br><span class="line"><span class="string">    state MASTER</span></span><br><span class="line"><span class="string">    interface eth0</span></span><br><span class="line"><span class="string">    virtual_router_id 51</span></span><br><span class="line"><span class="string">    mcast_src_ip 10.10.1.131</span></span><br><span class="line"><span class="string">    priority 100</span></span><br><span class="line"><span class="string">    advert_int 1</span></span><br><span class="line"><span class="string">    authentication &#123;</span></span><br><span class="line"><span class="string">    auth_type PASS</span></span><br><span class="line"><span class="string">    auth_pass 876543</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    virtual_ipaddress &#123;</span></span><br><span class="line"><span class="string">        10.10.1.62/24</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    track_interface &#123;</span></span><br><span class="line"><span class="string">        eth0</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    track_script &#123;</span></span><br><span class="line"><span class="string">        chk_haproxy</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>配置 Keepalived（LB02）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/keepalived/</span><br><span class="line"><span class="built_in">mv</span> keepalived.conf keepalived.conf.bak</span><br><span class="line"><span class="built_in">cat</span> &gt; keepalived.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">global_defs &#123;</span></span><br><span class="line"><span class="string">notification_email &#123;</span></span><br><span class="line"><span class="string">    wangchun@eitcn.cn</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">notification_email_from wangchun@eitcn.cn</span></span><br><span class="line"><span class="string">smtp_server smtp.eitcn.cn</span></span><br><span class="line"><span class="string">smtp_connect_timeout 30</span></span><br><span class="line"><span class="string">router_id lb-ecg</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">vrrp_script chk_haproxy &#123;</span></span><br><span class="line"><span class="string">    script &quot;killall -0 haproxy&quot;</span></span><br><span class="line"><span class="string">    interval 1</span></span><br><span class="line"><span class="string">    weight -2</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">vrrp_instance VI_1 &#123;</span></span><br><span class="line"><span class="string">    state MASTER</span></span><br><span class="line"><span class="string">    interface eth0</span></span><br><span class="line"><span class="string">    virtual_router_id 51</span></span><br><span class="line"><span class="string">    mcast_src_ip 10.10.1.130</span></span><br><span class="line"><span class="string">    priority 99</span></span><br><span class="line"><span class="string">    advert_int 1</span></span><br><span class="line"><span class="string">    authentication &#123;</span></span><br><span class="line"><span class="string">        auth_type PASS</span></span><br><span class="line"><span class="string">        auth_pass 876543</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    virtual_ipaddress &#123;</span></span><br><span class="line"><span class="string">        10.10.1.62/24</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    track_interface &#123;</span></span><br><span class="line"><span class="string">        eth0</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    track_script &#123;</span></span><br><span class="line"><span class="string">        chk_haproxy</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>Keepalived 重新载入配置（LB01、LB02）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service keepalived restart</span><br></pre></td></tr></table></figure>

<p>配置 HAProxy（LB01、LB02）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/haproxy</span><br><span class="line"><span class="built_in">mv</span> haproxy.cfg haproxy.cfg.bak</span><br><span class="line"><span class="built_in">cat</span> &gt; haproxy.cfg &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">global</span></span><br><span class="line"><span class="string">    log 127.0.0.1   local0</span></span><br><span class="line"><span class="string">    log 127.0.0.1   local1 debug</span></span><br><span class="line"><span class="string">    log 127.0.0.1   local2</span></span><br><span class="line"><span class="string">    maxconn   45000 # Total Max Connections.</span></span><br><span class="line"><span class="string">    daemon</span></span><br><span class="line"><span class="string">    nbproc      1 # Number of processing cores.</span></span><br><span class="line"><span class="string">defaults</span></span><br><span class="line"><span class="string">    timeout server 86400000</span></span><br><span class="line"><span class="string">    timeout connect 86400000</span></span><br><span class="line"><span class="string">    timeout client 86400000</span></span><br><span class="line"><span class="string">    timeout queue   1000s</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">listen  http_web *:80</span></span><br><span class="line"><span class="string">    mode tcp</span></span><br><span class="line"><span class="string">    balance source</span></span><br><span class="line"><span class="string">    server ecg01 10.10.1.145:80 weight 1 maxconn 512 check</span></span><br><span class="line"><span class="string">    server ecg02 10.10.1.130:80 weight 1 maxconn 512 check</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">listen  https_web *:443</span></span><br><span class="line"><span class="string">    mode tcp</span></span><br><span class="line"><span class="string">    balance source</span></span><br><span class="line"><span class="string">    server ecg01 10.10.1.145:443 weight 1 maxconn 512 check</span></span><br><span class="line"><span class="string">    server ecg02 10.10.1.130:443 weight 1 maxconn 512 check</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">listen stats *:91</span></span><br><span class="line"><span class="string">    mode http</span></span><br><span class="line"><span class="string">    log global</span></span><br><span class="line"><span class="string">    maxconn 10</span></span><br><span class="line"><span class="string">    stats enable</span></span><br><span class="line"><span class="string">    stats hide-version</span></span><br><span class="line"><span class="string">    stats refresh 30s</span></span><br><span class="line"><span class="string">    stats show-node</span></span><br><span class="line"><span class="string">    stats auth admin:password</span></span><br><span class="line"><span class="string">    stats uri /haproxy?stats</span></span><br></pre></td></tr></table></figure>

<p>HAProxy 重新载入配置（LB01、LB02）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service haproxy restart</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>linux</category>
        <category>load balancing</category>
      </categories>
      <tags>
        <tag>haproxy</tag>
        <tag>keepalived</tag>
      </tags>
  </entry>
  <entry>
    <title>使用 Certbot 工具申请 Let&#39;s Encrypt 证书</title>
    <url>/2017/03/15/letsencrypt-manual/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/letsencrypt-manual.png" alt="使用 Certbot 工具申请 Let&#39;s Encrypt 证书"></p>
<p>使用 Certbot 工具申请 Let’s Encrypt 免费证书。</p>
<blockquote>
<p>操作系统版本：CentOS 6.7_64</p>
<p>Apache 版本：2.2.15</p>
</blockquote>
<span id="more"></span>

<h1 id="Certbot-安装"><a href="#Certbot-安装" class="headerlink" title="Certbot 安装"></a>Certbot 安装</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://dl.eff.org/certbot-auto</span><br><span class="line">chmod a+x certbot-auto</span><br></pre></td></tr></table></figure>

<h1 id="Certbot使用"><a href="#Certbot使用" class="headerlink" title="Certbot使用"></a>Certbot使用</h1><p>更换下载 IP</p>
<p>访问<a href="http://tool.chinaz.com/dns">站长工具</a>，查询域名：pypi.python.org，找到最短响应的ip地址，写入hosts文件，例如：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">151.101.24.223  pypi.python.org</span><br></pre></td></tr></table></figure>

<p>更换 pip 源为豆瓣的 pip</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir /root/.pip</span><br><span class="line">cat &gt; /root/.pip/pip.conf &lt;&lt; EOF</span><br><span class="line">[global]</span><br><span class="line">trusted-host =  pypi.douban.com</span><br><span class="line">index-url = http://pypi.douban.com/simple</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>使用命令行申请证书</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./certbot-auto --apache -d iamtim.wang -d www.iamtim.wang certonly</span><br></pre></td></tr></table></figure>

<p>申请成功后，证书存放在 <code>/etc/letsencrypt/live</code> 下的对应域名目录中：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls -l</span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx 1 root root 35 Dec  5 13:31 cert.pem -&gt; ../../archive/iamtim.wang/cert1.pem</span><br><span class="line">lrwxrwxrwx 1 root root 36 Dec  5 13:31 chain.pem -&gt; ../../archive/iamtim.wang/chain1.pem</span><br><span class="line">lrwxrwxrwx 1 root root 40 Dec  5 13:31 fullchain.pem -&gt; ../../archive/iamtim.wang/fullchain1.pem</span><br><span class="line">lrwxrwxrwx 1 root root 38 Dec  5 13:31 privkey.pem -&gt; ../../archive/iamtim.wang/privkey1.pem</span><br><span class="line">pwd</span><br><span class="line">/etc/letsencrypt/live/iamtim.wang</span><br></pre></td></tr></table></figure>

<p>证书续期命令添加到计划任务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">0 1 * * * /root/certbot-auto renew --quiet</span><br></pre></td></tr></table></figure>

<h1 id="Apache-配置"><a href="#Apache-配置" class="headerlink" title="Apache 配置"></a>Apache 配置</h1><p>配置 Apache 的 <code>ssl.conf</code> 文件</p>
<p>可以参考 <a href="https://mozilla.github.io/server-side-tls/ssl-config-generator">Mozilla SSL Configuration Generator</a> 给出的配置。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&lt;VirtualHost *:443&gt;</span><br><span class="line">  ...</span><br><span class="line">  SSLEngine on</span><br><span class="line">  ServerAlias iamtim.wang</span><br><span class="line">  ServerAlias www.iamtim.wang</span><br><span class="line">  SSLCertificateChainFile /etc/letsencrypt/live/iamtim.wang/chain.pem</span><br><span class="line">  SSLCertificateFile /etc/letsencrypt/live/iamtim.wang/cert.pem</span><br><span class="line">  SSLCertificateKeyFile /etc/letsencrypt/live/iamtim.wang/privkey.pem</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">HSTS (mod_headers is required) (15768000 seconds = 6 months)</span></span><br><span class="line">  Header always set Strict-Transport-Security &quot;max-age=15768000&quot;</span><br><span class="line">  SSLProtocol             all -SSLv2 -SSLv3</span><br><span class="line">  SSLCipherSuite          ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS</span><br><span class="line">  SSLHonorCipherOrder     on</span><br><span class="line">  ...</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>

<p>重启 Apache 后，访问如下页面测试证书安全性</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">https://www.ssllabs.com/ssltest/analyze.html?d=iamtim.wang</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>https</category>
      </categories>
      <tags>
        <tag>https</tag>
        <tag>letsencrypt</tag>
        <tag>certbot</tag>
      </tags>
  </entry>
  <entry>
    <title>创建本地软件仓库</title>
    <url>/2018/12/05/local-repos/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/local-repos.png" alt="创建本地软件仓库"></p>
<p>为了适应项目方没有网络环境的情况，创建本地仓库用于安装依赖包。</p>
<blockquote>
<p>操作系统版本：CentOS 6.10_x64 Basic Server</p>
</blockquote>
<span id="more"></span>

<h1 id="创建本地软件仓库"><a href="#创建本地软件仓库" class="headerlink" title="创建本地软件仓库"></a>创建本地软件仓库</h1><p>清空默认 YUM 源</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /etc/yum.repos.d/backup</span><br><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d</span><br><span class="line"><span class="built_in">mv</span> *.repo ./backup</span><br></pre></td></tr></table></figure>

<p>安装所需 YUM 源</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget http://mirrors.163.com/.help/CentOS6-Base-163.repo</span><br><span class="line">rpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</span><br><span class="line">rpm -Uvh https://mirror.webtatic.com/yum/el6/latest.rpm</span><br><span class="line">rpm -Uvh http://www.percona.com/downloads/percona-release/redhat/0.1-6/percona-release-0.1-6.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>创建 YUM 源缓存</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>

<p>仅下载依赖包（不安装）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /root/repos</span><br><span class="line">yum -y install httpd mod_ssl openssl openssl-devels createrepo php56w php56w-cli php56w-common php56w-gd php56w-imap php56w-ldap php56w-odbc php56w-pdo php56w-pear php56w-xml php56w-xmlrpc php56w-soap php56w-mysql php56w-mbstring php56w-mcrypt deltarpm python-deltarpm gcc gcc-c++ make cmake autoconf libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel ncurses ncurses-devel libaio readline-devel curl curl-devel e2fsprogs e2fsprogs-devel krb5-devel libidn libidn-devel libxslt-devel libicu-devel libevent-devel libtool libtool-ltdl bison gd-devel vim-enhanced pcre-devel zip unzip ntpdate sysstat patch bc expect htop lsof lrzsz telnet libmcrypt libmcrypt-devel perl-DBI perl-DBD-MySQL percona-xtrabackup-24 haproxy nginx rsync keepalived --downloadonly --downloaddir=/root/repos</span><br></pre></td></tr></table></figure>

<p>创建软件仓库</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum -y install createrepo</span><br><span class="line">createrepo --database /root/repos</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>centos6</tag>
      </tags>
  </entry>
  <entry>
    <title>安装 MegaCLI</title>
    <url>/2017/05/16/megacli-install/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/megacli-install.png" alt="安装 MegaCLI"></p>
<p>安装 MegaCLI 命令，用于查看 DELL 服务器 RAID 状态。</p>
<blockquote>
<p>CentOS 版本：6.7 x86_64</p>
<p>MegaCLI 版本：8.07.14</p>
</blockquote>
<span id="more"></span>

<h1 id="安装-MegaCLI"><a href="#安装-MegaCLI" class="headerlink" title="安装 MegaCLI"></a>安装 MegaCLI</h1><p>查看 RAID 卡信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">lspci | grep -i raid</span><br><span class="line">dmesg | grep LSI</span><br></pre></td></tr></table></figure>

<p>安装 MegaCLI</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install sg3_utils unzip wget</span><br><span class="line">wget http://www.avagotech.com/docs-and-downloads/raid-controllers/raid-controllers-common-files/8-07-14_MegaCLI.zip</span><br><span class="line">unzip raid-controllers-common-files/8-07-14_MegaCLI.zip</span><br><span class="line">rpm -ivh Linux/MegaCli-8.07.14-1.noarch.rpm</span><br></pre></td></tr></table></figure>

<h1 id="MegaCLI-命令"><a href="#MegaCLI-命令" class="headerlink" title="MegaCLI 命令"></a>MegaCLI 命令</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /opt/MegaRAID/MegaCli</span><br><span class="line">./MegaCli64 -V      # 查看版本</span><br><span class="line">./MegaCli64 -LdPdInfo -a0 | grep -E &quot;Virtual Drive:|Slot Number:&quot; | xargs | sed -r &#x27;s/(Slot Number:)(\s[0-9]+)/\2,/g&#x27; | sed &#x27;s/(Target Id: .)/Physical Drives ids:/g&#x27; | sed &#x27;s/Virtual Drive:/\nVirtual Drive:/g&#x27;       # 查看虚拟设备</span><br><span class="line">./MegaCli64 -ShowSummary -aAll      # 查看汇总信息</span><br><span class="line">./MegaCli64 -PDList -aALL       # 查看硬盘信息</span><br></pre></td></tr></table></figure>

<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="https://raid.wiki.kernel.org/index.php/Hardware_Raid_Setup_using_MegaCli#Download_and_Install_MegaCli_and_other_supportive_tools">Hardware Raid Setup using MegaCli</a></li>
<li><a href="http://www.dell.com/support/article/cn/zh/cndhs1/SLN292232/%E9%80%9A%E8%BF%87megacli%E6%8F%90%E5%8F%96raid%E6%8E%A7%E5%88%B6%E5%99%A8%E6%97%A5%E5%BF%97-windows---linux-?lang=ZH">通过MegaCLI提取RAID控制器日志(Windows + Linux)</a></li>
</ul>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>dell</tag>
        <tag>megacli</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 数据恢复</title>
    <url>/2017/05/27/mysql-data-recovery/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/mysql-data-recovery.png" alt="MySQL 数据恢复"></p>
<p>生产环境在执行 update 更新时，忘记使用 where 条件，造成数据丢失，需要找回误更新数据。</p>
<blockquote>
<p>CentOS 版本：6.7 x86_64<br>MySQL 版本：5.5.49<br>Xtrabackup 版本：2.3.8</p>
</blockquote>
<span id="more"></span>

<h1 id="MySQL-恢复数据"><a href="#MySQL-恢复数据" class="headerlink" title="MySQL 恢复数据"></a>MySQL 恢复数据</h1><p>因为 MySQL 的 binlog 格式设置为 mixed，所以无法通过 binlog 进行回滚操作；决定使用最新的全量备份找出丢失数据，再更新到生产环境；因为这两个表完全由业务人员操作，并且数据量少更新频率很低，差异数据能够通过人工方式确认。涉及到的表：<code>v_at_portal.api_institutions</code>、<code>v_at_portal.api_health_networks</code>。</p>
<h2 id="还原备份数据"><a href="#还原备份数据" class="headerlink" title="还原备份数据"></a>还原备份数据</h2><p>拷贝数据库全量备份 <code>/root</code> 目录。</p>
<p>进行全量恢复准备：</p>
<pre><code>innobackupex --use-memory=1G --apply-log /root/2017_05_24/2017_05_24_full
</code></pre>
<p>确认数据库已关闭，<code>datadir</code> 目录为空，进行全量恢：</p>
<pre><code>innobackupex --defaults-file=/etc/my.cnf --use-memory=1G --copy-back /root/2017_05_24/2017_05_24_full
</code></pre>
<p>启动数据库：</p>
<pre><code>chown -R mysql:mysql /home/mysql/data
service mysqld start
</code></pre>
<h2 id="生成恢复脚本"><a href="#生成恢复脚本" class="headerlink" title="生成恢复脚本"></a>生成恢复脚本</h2><p>找出丢失的数据，生成 update 语句脚本，在生产环境执行 update 操作：</p>
<pre><code>SELECT CONCAT(&quot;UPDATE api_institutions SET api_ins_name = &#39;&quot;,api_ins_name,&quot;&#39;, api_ins_address = &#39;&quot;,api_ins_address,&quot;&#39; WHERE api_ins_id = &quot;,api_ins_id,&#39;;&#39;) FROM v_at_portal.api_institutions;
SELECT CONCAT(&quot;UPDATE api_health_networks SET hea_net_name = &#39;&quot;,hea_net_name,&quot;&#39; WHERE hea_net_id = &quot;,hea_net_id,&#39;;&#39;) FROM v_at_portal.api_health_networks;
</code></pre>
<p>PS：数据就不进行脱敏了吧，因为公司都黄啦~~~</p>
]]></content>
      <categories>
        <category>database</category>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>xtrabackup</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL OOM 处理</title>
    <url>/2018/09/22/mysql-oom/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/mysql-oom.png" alt="MySQL OOM 处理"></p>
<p>测试数据库发生 OOM 问题，记录日志及解决办法。</p>
<blockquote>
<p>CentOS 版本：6.7 x86_64<br>MySQL 版本：5.7.12<br>kernel 版本：2.6.32-573</p>
</blockquote>
<span id="more"></span>

<h1 id="MySQL-OOM-处理"><a href="#MySQL-OOM-处理" class="headerlink" title="MySQL OOM 处理"></a>MySQL OOM 处理</h1><p>系统日志输出：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Sep 21 16:12:28 localhost kernel: mysqld invoked oom-killer: gfp_mask=0x280da, order=0, oom_adj=0, oom_score_adj=0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: mysqld cpuset=/ mems_allowed=0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: Pid: 20824, <span class="built_in">comm</span>: mysqld Not tainted 2.6.32-573.el6.x86_64 <span class="comment">#1</span></span><br><span class="line">Sep 21 16:12:28 localhost kernel: Call Trace:</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [&lt;ffffffff810d6dd1&gt;] ? cpuset_print_task_mems_allowed+0x91/0xb0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [&lt;ffffffff8112a5d0&gt;] ? dump_header+0x90/0x1b0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [&lt;ffffffff81232a7c&gt;] ? security_real_capable_noaudit+0x3c/0x70</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [&lt;ffffffff8112aa52&gt;] ? oom_kill_process+0x82/0x2a0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [&lt;ffffffff8112a991&gt;] ? select_bad_process+0xe1/0x120</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [&lt;ffffffff8112ae90&gt;] ? out_of_memory+0x220/0x3c0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [&lt;ffffffff8113786c&gt;] ? __alloc_pages_nodemask+0x93c/0x950</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [&lt;ffffffff8117035a&gt;] ? alloc_pages_vma+0x9a/0x150</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [&lt;ffffffff81152b1d&gt;] ? handle_pte_fault+0x73d/0xb20</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [&lt;ffffffff810537b7&gt;] ? pte_alloc_one+0x37/0x50</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [&lt;ffffffff8118be29&gt;] ? do_huge_pmd_anonymous_page+0xb9/0x3b0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [&lt;ffffffff81153199&gt;] ? handle_mm_fault+0x299/0x3d0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [&lt;ffffffff81066053&gt;] ? perf_event_task_sched_out+0x33/0x70</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [&lt;ffffffff8104f156&gt;] ? __do_page_fault+0x146/0x500</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [&lt;ffffffff8153817e&gt;] ? thread_return+0x4e/0x7d0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [&lt;ffffffff8153e78e&gt;] ? do_page_fault+0x3e/0xa0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [&lt;ffffffff8153bb35&gt;] ? page_fault+0x25/0x30</span><br><span class="line">Sep 21 16:12:28 localhost kernel: Mem-Info:</span><br><span class="line">Sep 21 16:12:28 localhost kernel: Node 0 DMA per-cpu:</span><br><span class="line">Sep 21 16:12:28 localhost kernel: CPU    0: hi:    0, btch:   1 usd:   0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: CPU    1: hi:    0, btch:   1 usd:   0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: CPU    2: hi:    0, btch:   1 usd:   0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: CPU    3: hi:    0, btch:   1 usd:   0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: Node 0 DMA32 per-cpu:</span><br><span class="line">Sep 21 16:12:28 localhost kernel: CPU    0: hi:  186, btch:  31 usd:   0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: CPU    1: hi:  186, btch:  31 usd:   0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: CPU    2: hi:  186, btch:  31 usd:   0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: CPU    3: hi:  186, btch:  31 usd:   0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: Node 0 Normal per-cpu:</span><br><span class="line">Sep 21 16:12:28 localhost kernel: CPU    0: hi:  186, btch:  31 usd:   0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: CPU    1: hi:  186, btch:  31 usd:  30</span><br><span class="line">Sep 21 16:12:28 localhost kernel: CPU    2: hi:  186, btch:  31 usd:   0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: CPU    3: hi:  186, btch:  31 usd:   0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: active_anon:1555339 inactive_anon:332686 isolated_anon:0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: active_file:21589 inactive_file:21442 isolated_file:0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: unevictable:0 dirty:39195 writeback:0 unstable:0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: free:25816 slab_reclaimable:8890 slab_unreclaimable:10707</span><br><span class="line">Sep 21 16:12:28 localhost kernel: mapped:3508 shmem:37 pagetables:11523 bounce:0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: Node 0 DMA free:15728kB min:124kB low:152kB high:184kB active_anon:0kB inactive_anon:0kB active_file:0kB inactive_file:0kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:15336kB mlocked:0kB dirty:0kB writeback:0kB mapped:0kB shmem:0kB slab_reclaimable:0kB slab_unreclaimable:0kB kernel_stack:0kB pagetables:0kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:0 all_unreclaimable? <span class="built_in">yes</span></span><br><span class="line">Sep 21 16:12:28 localhost kernel: lowmem_reserve[]: 0 2970 8020 8020</span><br><span class="line">Sep 21 16:12:28 localhost kernel: Node 0 DMA32 free:45136kB min:24980kB low:31224kB high:37468kB active_anon:2112200kB inactive_anon:584284kB active_file:10564kB inactive_file:10124kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:3041728kB mlocked:0kB dirty:19804kB writeback:0kB mapped:68kB shmem:4kB slab_reclaimable:5484kB slab_unreclaimable:1668kB kernel_stack:176kB pagetables:1800kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:10688 all_unreclaimable? no</span><br><span class="line">Sep 21 16:12:28 localhost kernel: lowmem_reserve[]: 0 0 5050 5050</span><br><span class="line">Sep 21 16:12:28 localhost kernel: Node 0 Normal free:42400kB min:42472kB low:53088kB high:63708kB active_anon:4109156kB inactive_anon:746460kB active_file:75792kB inactive_file:75644kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:5171200kB mlocked:0kB dirty:136976kB writeback:0kB mapped:13964kB shmem:144kB slab_reclaimable:30076kB slab_unreclaimable:41160kB kernel_stack:6240kB pagetables:44292kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:37952 all_unreclaimable? no</span><br><span class="line">Sep 21 16:12:28 localhost kernel: lowmem_reserve[]: 0 0 0 0</span><br><span class="line">Sep 21 16:12:28 localhost kernel: Node 0 DMA: 2*4kB 1*8kB 2*16kB 2*32kB 2*64kB 1*128kB 0*256kB 0*512kB 1*1024kB 1*2048kB 3*4096kB = 15728kB</span><br><span class="line">Sep 21 16:12:28 localhost kernel: Node 0 DMA32: 599*4kB 470*8kB 304*16kB 140*32kB 60*64kB 40*128kB 51*256kB 13*512kB 1*1024kB 0*2048kB 0*4096kB = 45196kB</span><br><span class="line">Sep 21 16:12:28 localhost kernel: Node 0 Normal: 1635*4kB 1018*8kB 574*16kB 304*32kB 93*64kB 20*128kB 2*256kB 0*512kB 0*1024kB 0*2048kB 0*4096kB = 42620kB</span><br><span class="line">Sep 21 16:12:28 localhost kernel: 59465 total pagecache pages</span><br><span class="line">Sep 21 16:12:28 localhost kernel: 16337 pages <span class="keyword">in</span> swap cache</span><br><span class="line">Sep 21 16:12:28 localhost kernel: Swap cache stats: add 8300762, delete 8284425, find 1851709760/1852280532</span><br><span class="line">Sep 21 16:12:28 localhost kernel: Free swap  = 9912132kB</span><br><span class="line">Sep 21 16:12:28 localhost kernel: Total swap = 10239996kB</span><br><span class="line">Sep 21 16:12:28 localhost kernel: 2097151 pages RAM</span><br><span class="line">Sep 21 16:12:28 localhost kernel: 89559 pages reserved</span><br><span class="line">Sep 21 16:12:28 localhost kernel: 84494 pages shared</span><br><span class="line">Sep 21 16:12:28 localhost kernel: 1927295 pages non-shared</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ pid ]   uid  tgid total_vm      rss cpu oom_adj oom_score_adj name</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [  636]     0   636     2663       67   0     -17         -1000 udevd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 1477]     0  1477    23289       81   1     -17         -1000 auditd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 1511]     0  1511    62991     1202   2       0             0 rsyslogd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 1602]     0  1602     4561       77   1       0             0 irqbalance</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 1620]    32  1620     4744       20   1       0             0 rpcbind</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 1642]    29  1642     5837        2   0       0             0 rpc.statd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 1657]     0  1657     1197       90   1       0             0 mdadm</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 1684]    81  1684     5391       96   2       0             0 dbus-daemon</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 1705]     0  1705    47232        2   0       0             0 cupsd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 1737]     0  1737     1020        1   0       0             0 acpid</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 1749]    68  1749     9494      175   0       0             0 hald</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 1750]     0  1750     5100        2   2       0             0 hald-runner</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 1782]     0  1782     5630        2   0       0             0 hald-addon-inpu</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 1805]    68  1805     4502        2   1       0             0 hald-addon-acpi</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 1824]     0  1824    96534      103   0       0             0 automount</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 1981]     0  1981     1566        1   1       0             0 mcelog</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 2089]     0  2089    20218       47   3       0             0 master</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 2096]    89  2096    20280      133   2       0             0 qmgr</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 2118]     0  2118    45214        2   1       0             0 abrtd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 2156]     0  2156     5276        9   1       0             0 atd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 2172]     0  2172    16082       46   2       0             0 certmonger</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 2195]     0  2195     1016        2   2       0             0 mingetty</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 2197]     0  2197     1016        2   0       0             0 mingetty</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 5013]     0  5013    92272      314   3       0             0 php</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 5030]     0  5030    91990      314   1       0             0 php</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 5140]     0  5140    92185      325   0       0             0 php</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 1427]     0  1427     2868      116   1       0             0 mysqld_safe</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [13252]     0 13252    25628      137   1       0             0 sshd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [13279]   511 13279    26549      226   0       0             0 sshd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [13284]   511 13284    14359      155   0       0             0 sftp-server</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [17029]     0 17029    25628      137   1       0             0 sshd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [17042]   511 17042    25715      156   0       0             0 sshd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [17044]   511 17044    14348      135   2       0             0 sftp-server</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [18981]     0 18981    97300      171   0       0             0 httpd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [19000]    48 19000   100856     4499   3       0             0 httpd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [19001]    48 19001   101126     5024   3       0             0 httpd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [19002]    48 19002   101128     5015   3       0             0 httpd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [19003]    48 19003   101184     5138   3       0             0 httpd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [19004]    48 19004   101262     5173   3       0             0 httpd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [19005]    48 19005   101113     5181   3       0             0 httpd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [19006]    48 19006   103955     7278   0       0             0 httpd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [19007]    48 19007   103892     5011   0       0             0 httpd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 7033]    48  7033   101150     4990   0       0             0 httpd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 9907]    48  9907   103906     5150   3       0             0 httpd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 9943]    48  9943   100195     4298   0       0             0 httpd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 9944]    48  9944   103931     4977   3       0             0 httpd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [26057]    48 26057   101127     4790   1       0             0 httpd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [26921]    48 26921   101067     4969   3       0             0 httpd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [31980]     0 31980    25629       10   1       0             0 sshd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [31982]   500 31982    25629       55   3       0             0 sshd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [31983]   500 31983    27084        2   1       0             0 bash</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [32369]   500 32369    41514        2   3       0             0 su</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [  355]     0   355    27104      146   2       0             0 bash</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [27397]    99 27397     3635      180   1       0             0 nmon</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [15221]     0 15221    25628      138   3       0             0 sshd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [15496]   511 15496    25699      145   2       0             0 sshd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [15497]   511 15497    14349      153   1       0             0 sftp-server</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 2380]     0  2380    25628      138   2       0             0 sshd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 2627]   511  2627    25663      121   2       0             0 sshd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 2629]   511  2629    14312      116   2       0             0 sftp-server</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [17337]     0 17337    29215      122   0       0             0 crond</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [17464]     0 17464    16558       44   0     -17         -1000 sshd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [14863]   497 14863  1043341   101433   3       0             0 java</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [26148]     0 26148  1184739   199553   2       0             0 java</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 3941]     0  3941     2662       92   2     -17         -1000 udevd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 3942]     0  3942     2662       92   1     -17         -1000 udevd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [  408]   498   408  2251205  1478808   0       0             0 mysqld</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [  978]     0   978    25628      697   0       0             0 sshd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 1029]   503  1029    25628      347   3       0             0 sshd</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 1038]   503  1038    27084      252   2       0             0 bash</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 1147]   503  1147    41511      362   1       0             0 su</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 1517]     0  1517    27084      266   1       0             0 bash</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 4617]     0  4617    35003      325   0       0             0 crond</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 4618]     0  4618    35003      325   1       0             0 crond</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 4619]     0  4619    35003      325   2       0             0 crond</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 4620]     0  4620    35003      325   0       0             0 crond</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 4621]     0  4621    35003      325   2       0             0 crond</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 4665]     0  4665    95366     7116   3       0             0 php</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 4666]     0  4666    20233      649   2       0             0 sendmail</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 4675]     0  4675    20224      650   2       0             0 postdrop</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 4689]     0  4689    95496     7123   3       0             0 php</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 4691]     0  4691    95431     7174   3       0             0 php</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 4692]     0  4692    95455     7122   2       0             0 php</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 4695]     0  4695    20233      651   0       0             0 sendmail</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 4696]     0  4696    20233      650   3       0             0 sendmail</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 4697]     0  4697    20233      649   2       0             0 sendmail</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 4699]     0  4699    20224      651   2       0             0 postdrop</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 4700]     0  4700    20224      651   3       0             0 postdrop</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 4701]     0  4701    20224      652   0       0             0 postdrop</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 4707]     0  4707    95507     7232   3       0             0 php</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 4709]     0  4709    20233      650   0       0             0 sendmail</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [ 4710]     0  4710    20224      651   0       0             0 postdrop</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [22878]    89 22878    20238      666   0       0             0 pickup</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [18462]    89 18462    20240      661   0       0             0 trivial-rewrite</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [18573]    89 18573    20247      673   0       0             0 bounce</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [18574]     0 18574    20312      793   0       0             0 <span class="built_in">local</span></span><br><span class="line">Sep 21 16:12:28 localhost kernel: [20055]     0 20055    20312      793   0       0             0 <span class="built_in">local</span></span><br><span class="line">Sep 21 16:12:28 localhost kernel: [20056]    89 20056    20274      714   1       0             0 cleanup</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [20058]    89 20058    20274      716   3       0             0 cleanup</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [20063]    89 20063    20247      671   3       0             0 bounce</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [20064]    89 20064    20274      714   0       0             0 cleanup</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [25666]     0 25666    20312      793   1       0             0 <span class="built_in">local</span></span><br><span class="line">Sep 21 16:12:28 localhost kernel: [27049]    89 27049    20247      672   1       0             0 bounce</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [31585]     0 31585    92315     3716   0       0             0 php</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [31586]     0 31586    58126      993   3       0             0 php</span><br><span class="line">Sep 21 16:12:28 localhost kernel: [31587]     0 31587    58126      993   0       0             0 php</span><br><span class="line">Sep 21 16:12:28 localhost kernel: Out of memory: Kill process 408 (mysqld) score 324 or sacrifice child</span><br><span class="line">Sep 21 16:12:28 localhost kernel: Killed process 408, UID 498, (mysqld) total-vm:9004820kB, anon-rss:5910380kB, file-rss:4852kB</span><br></pre></td></tr></table></figure>

<p>检查发现内核（&gt;&#x3D; 2.6.32-303）在配置 <code>vm.swappiness=0</code> 后会出现 OOM 现象，修改 <code>/etc/sysctl.conf</code> 文件即可。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vm.swappiness=1</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>database</category>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>扩容软 RAID1</title>
    <url>/2018/12/20/mdadm-expansion-raid1/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/mdadm-expansion-raid1.png" alt="扩容软 RAID1"></p>
<p>测试数据库无法访问，检查发现 MySQL 数据分区磁盘使用率达到 100%，MySQL 一直在进行 crash recovery 操作。服务器使用了 2 块 1TB 硬盘，配置成软 RAID1。</p>
<blockquote>
<p>&#x2F;dev&#x2F;md0 为数据分区  410GB  100% 占用率<br>&#x2F;dev&#x2F;md1 为备份分区  400GB  空</p>
</blockquote>
<span id="more"></span>

<h1 id="扩容软-RAID1"><a href="#扩容软-RAID1" class="headerlink" title="扩容软 RAID1"></a>扩容软 RAID1</h1><p>因为备份分区小于现有的数据分区，所以不能把备份分区直接加入到数据分区中。</p>
<p>方案 1：把数据分区的 RAID1 改为 RAID10。备份分区重新做成 RAID0 加入到数据分区中，同步完成后，再把数据分区的磁盘取出配置成 RAID0 加入到数据分区中。</p>
<p>方案 2：保留 RAID1 结构，扩展磁盘分区容量。</p>
<p>因为只有 2 块硬盘，所有改成 RAID10 磁盘性能反而会下降。所以选择第 2 个方案。</p>
<h2 id="磁盘分区扩容"><a href="#磁盘分区扩容" class="headerlink" title="磁盘分区扩容"></a>磁盘分区扩容</h2><ul>
<li>查看备份分区信息</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mdadm -D /dev/md0</span><br><span class="line">/dev/md0:</span><br><span class="line">......</span><br><span class="line">           Number   Major   Minor   RaidDevice State</span><br><span class="line">       0       8        1        0      active <span class="built_in">sync</span>   /dev/sda1</span><br><span class="line">       1       8       17        1      active <span class="built_in">sync</span>   /dev/sdb1</span><br><span class="line"></span><br><span class="line">mdadm -D /dev/md1</span><br><span class="line">/dev/md1:</span><br><span class="line">......</span><br><span class="line">    Number   Major   Minor   RaidDevice State</span><br><span class="line">       0       8        2        0      active <span class="built_in">sync</span>   /dev/sda2</span><br><span class="line">       1       8       18        1      active <span class="built_in">sync</span>   /dev/sdb2</span><br></pre></td></tr></table></figure>

<ul>
<li>删除备份分区</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">umount /dev/md1</span><br><span class="line">mdadm -S /dev/md1</span><br><span class="line">mdadm --misc --zero-superblock /dev/sda2</span><br><span class="line">mdadm --misc --zero-superblock /dev/sdb2</span><br></pre></td></tr></table></figure>

<p>修改 <code>/etc/mdadm.conf</code> 配置文件，注释 &#x2F;dev&#x2F;md1 相关配置。</p>
<p>修改 <code>/etc/fstab</code> 配置文件，注释备份分区 mount 信息。（<strong>操作中忘记这一步，造成重启服务器无法进入系统。</strong>）</p>
<ul>
<li>扩展 sdb1 磁盘分区</li>
</ul>
<p>1.从数据分区中去除 sdb1 分区：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mdadm /dev/md0 --fail /dev/sdb1 --remove /dev/sdb1</span><br><span class="line">mdadm --misc --zero-superblock /dev/sdb1</span><br></pre></td></tr></table></figure>

<p>2.重新划分 sdb 盘分区，把 &#x2F;dev&#x2F;sdb1 和 &#x2F;dev&#x2F;sdb2 分区合并为一个分区：（<strong>如果省略第 2 步，容易出现逻辑扇区和物理扇区无法对齐情况，有可能影响 IO 性能。</strong>）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fdisk /dev/sdb</span><br><span class="line"></span><br><span class="line">1. p,Enter</span><br><span class="line"><span class="comment"># 显示分区信息</span></span><br><span class="line">2. u,Enter</span><br><span class="line"><span class="comment"># 将显示输入单元更改为扇区</span></span><br><span class="line">3. d,1,Enter</span><br><span class="line"><span class="comment"># 删除第 1 个分区</span></span><br><span class="line">4. d,2,Enter</span><br><span class="line"><span class="comment"># 删除第 2 个分区</span></span><br><span class="line">5. n,p,1,Enter,Enter</span><br><span class="line"><span class="comment"># 创建第 1 个主分区</span></span><br><span class="line">6. p,Enter</span><br><span class="line"><span class="comment"># 显示分区信息</span></span><br><span class="line">7. w,Enter</span><br><span class="line"><span class="comment"># 写入分区表信息并退出</span></span><br></pre></td></tr></table></figure>

<p>3.重启系统更新 &#x2F;dev&#x2F;sdb 分区表：</p>
<p>因为没有修改 <code>/etc/fstab</code> 配置文件，在服务器重启中出现如下提示：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GIVE root password <span class="keyword">for</span> maintenance</span><br><span class="line"></span><br><span class="line">(or <span class="built_in">type</span> control-D to <span class="built_in">continue</span>):</span><br></pre></td></tr></table></figure>

<p>输入 root 用户密码后，系统是只读状态，需要重新 mount 根分区，再修改 <code>/etc/fstab</code> 配置文件，最后重启即可。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mount –o remount,rw /</span><br><span class="line">vi /etc/fstab</span><br></pre></td></tr></table></figure>

<p>4.数据分区添加 &#x2F;dev&#x2F;sdb1 磁盘，等待数据同步完成。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mdadm --manage /dev/md0 --add /dev/sdb1</span><br></pre></td></tr></table></figure>

<ul>
<li>扩展 sda1 磁盘分区</li>
</ul>
<p>1.从数据分区中去除 sda1 分区：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mdadm /dev/md0 --fail /dev/sda1 --remove /dev/sda1</span><br><span class="line">mdadm --misc --zero-superblock /dev/sda1</span><br></pre></td></tr></table></figure>

<p>2.重新划分 sda 盘分区，把 &#x2F;dev&#x2F;sda1 和 &#x2F;dev&#x2F;sda2 分区合并为一个分区。</p>
<p>3.重启系统更新 &#x2F;dev&#x2F;sda 分区表。</p>
<p>4.数据分区添加 &#x2F;dev&#x2F;sda1 磁盘，等待数据同步完成：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mdadm --manage /dev/md0 --add /dev/sda1</span><br></pre></td></tr></table></figure>

<p>至此磁盘分区扩容完成。</p>
<h2 id="文件系统扩容"><a href="#文件系统扩容" class="headerlink" title="文件系统扩容"></a>文件系统扩容</h2><p>虽然磁盘分区扩容完成，但是文件系统大小没有变化，需要再对文件系统进行扩容：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mdadm --grow --size max /dev/md0</span><br><span class="line">e2fsck -f /dev/md0</span><br><span class="line">resize2fs /dev/md0</span><br></pre></td></tr></table></figure>

<p>PS：查到 <code>mdadm --grow /dev/md0 -z max --assume-clean</code> 命令也可以扩容，但是未经测试。</p>
<h2 id="恢复-MySQL-服务"><a href="#恢复-MySQL-服务" class="headerlink" title="恢复 MySQL 服务"></a>恢复 MySQL 服务</h2><p>启动 MySQL 服务:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service mysqld start</span><br></pre></td></tr></table></figure>

<p>日志信息：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">181219 12:04:57 mysqld_safe Starting mysqld daemon with databases from /data/mysql</span><br><span class="line">181219 12:04:57 [Note] Plugin <span class="string">&#x27;FEDERATED&#x27;</span> is disabled.</span><br><span class="line">181219 12:04:57 InnoDB: The InnoDB memory heap is disabled</span><br><span class="line">181219 12:04:57 InnoDB: Mutexes and rw_locks use GCC atomic builtins</span><br><span class="line">181219 12:04:57 InnoDB: Compressed tables use zlib 1.2.3</span><br><span class="line">181219 12:04:57 InnoDB: Initializing buffer pool, size = 4.0G</span><br><span class="line">181219 12:04:57 InnoDB: Completed initialization of buffer pool</span><br><span class="line">181219 12:04:57 InnoDB: highest supported file format is Barracuda.</span><br><span class="line">InnoDB: Log scan progressed past the checkpoint lsn 848305710317</span><br><span class="line">181219 12:04:57  InnoDB: Database was not shut down normally!</span><br><span class="line">InnoDB: Starting crash recovery.</span><br><span class="line">InnoDB: Reading tablespace information from the .ibd files...</span><br><span class="line">InnoDB: Restoring possible half-written data pages from the doublewrite</span><br><span class="line">InnoDB: buffer...</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848310952960</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848316195840</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848321438720</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848326681600</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848331924480</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848337167360</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848342410240</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848347653120</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848352896000</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848358138880</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848363381760</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848368624640</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848373867520</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848379110400</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848384353280</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848389596160</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848394839040</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848400081920</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848405324800</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848410567680</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848415810560</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848421053440</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848426296320</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848431539200</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848436782080</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848442024960</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848447267840</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848452510720</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848457753600</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848462996480</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848468239360</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848473482240</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848478725120</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848483968000</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848489210880</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848494453760</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848499696640</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848504939520</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848510182400</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848515425280</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848520668160</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848525911040</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848531153920</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848536396800</span><br><span class="line">InnoDB: Doing recovery: scanned up to <span class="built_in">log</span> sequence number 848540988197</span><br><span class="line">InnoDB: 1 transaction(s) <span class="built_in">which</span> must be rolled back or cleaned up</span><br><span class="line">InnoDB: <span class="keyword">in</span> total 1 row operations to undo</span><br><span class="line">InnoDB: Trx <span class="built_in">id</span> counter is EC300</span><br><span class="line">181219 12:05:01  InnoDB: Starting an apply batch of <span class="built_in">log</span> records to the database...</span><br><span class="line">InnoDB: Progress <span class="keyword">in</span> percents: 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99</span><br><span class="line">InnoDB: Apply batch completed</span><br><span class="line">InnoDB: Starting <span class="keyword">in</span> background the rollback of uncommitted transactions</span><br><span class="line">181219 12:05:05  InnoDB: Rolling back trx with <span class="built_in">id</span> EC1B4, 1 rows to undo</span><br><span class="line">181219 12:05:05  InnoDB: Waiting <span class="keyword">for</span> the background threads to start</span><br><span class="line"></span><br><span class="line">InnoDB: Rolling back of trx <span class="built_in">id</span> EC1B4 completed</span><br><span class="line">181219 12:05:06  InnoDB: Rollback of non-prepared transactions completed</span><br><span class="line">181219 12:05:06 InnoDB: 5.5.40 started; <span class="built_in">log</span> sequence number 848540988197</span><br><span class="line">181219 12:05:06 [Note] Server hostname (bind-address): <span class="string">&#x27;0.0.0.0&#x27;</span>; port: 3306</span><br><span class="line">181219 12:05:06 [Note]   - <span class="string">&#x27;0.0.0.0&#x27;</span> resolves to <span class="string">&#x27;0.0.0.0&#x27;</span>;</span><br><span class="line">181219 12:05:06 [Note] Server socket created on IP: <span class="string">&#x27;0.0.0.0&#x27;</span>.</span><br><span class="line">181219 12:05:06 [Note] Event Scheduler: Loaded 0 events</span><br><span class="line">181219 12:05:06 [Note] /usr/local/mysql/bin/mysqld: ready <span class="keyword">for</span> connections.</span><br><span class="line">Version: <span class="string">&#x27;5.5.40&#x27;</span>  socket: <span class="string">&#x27;/data/mysql/mysql.sock&#x27;</span>  port: 3306  Source distribution</span><br></pre></td></tr></table></figure>

<p>至此数据库服务恢复正常。</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>raid1</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 服务器选型与优化</title>
    <url>/2018/09/19/mysql-optimization/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/mysql-optimization.png" alt="MySQL 服务器选型与优化"></p>
<p>本文面向单机单实例使用本地磁盘的 MySQL 服务器，列出需要优化的部分。<strong>内容仅供参考，一切以压力测试数据为准，切勿迷信参数配置。</strong></p>
<span id="more"></span>

<h1 id="MySQL-服务器选型与优化"><a href="#MySQL-服务器选型与优化" class="headerlink" title="MySQL 服务器选型与优化"></a>MySQL 服务器选型与优化</h1><p>使用本地磁盘的 MySQL 服务器硬件配置参考：</p>
<center>

<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/dell-mysql.png" alt="硬件配置参考："></p>
</center>

<h2 id="硬件"><a href="#硬件" class="headerlink" title="硬件"></a>硬件</h2><ul>
<li>BIOS</li>
</ul>
<p>关闭 CPU 的节能模式，调整内存频率为最佳性能。</p>
<ul>
<li>CPU</li>
</ul>
<p>选择高主频、高缓存处理器，部署单实例 MySQL 的话，核心数量不需太多。</p>
<ul>
<li>硬盘</li>
</ul>
<p>SSD：不差钱的选择 SSD 硬盘组建 RAID，IO 性能是极好的。</p>
<p>HDD：选择高转速，多硬盘组建 RAID10。根据存储不同类型文件（数据库和索引文件、事务日志文件、二进制文件、常规日志、临时文件和临时表），划分多个 RAID。</p>
<ul>
<li>RAID卡</li>
</ul>
<p>选择带电池，并且缓存大的 RAID 卡。强制开启 WriteBack 策略。</p>
<ul>
<li>内存</li>
</ul>
<p>部署单实例 MySQL 的话，64GB 内存够用。</p>
<h2 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h2><ul>
<li>文件系统</li>
</ul>
<p>跟随操作系统使用的文件系统即可。CentOS6 默认使用 EXT4 文件系统，CentOS7 默认使用 XFS 文件系统。</p>
<p>挂载分区时，使用 noatime、nodiratime、nobarrier 即可。</p>
<ul>
<li>磁盘队列调度策略</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">noop anticipatory [deadline] cfq</span><br></pre></td></tr></table></figure>

<ul>
<li>SWAP</li>
</ul>
<p>SWAP 规划分区大小与内存一致（64GB）。我们希望 MySQL 尽量不要使用 SWAP 空间，RAM 与 SWAP 交换尽量懒惰。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/proc/sys/vm/swappiness =&lt; 10</span><br><span class="line">/proc/sys/vm/vm.dirty_ratio =&lt; 5</span><br><span class="line">/proc/sys/vm/vm.dirty_background_ratio =&lt; 10</span><br></pre></td></tr></table></figure>

<ul>
<li>内存分配器</li>
</ul>
<p>使用 jemalloc 管理内存可以提高 MySQL 性能，降低系统 CPU 和 RAM 资源的利用。</p>
<ul>
<li>网络</li>
</ul>
<p>优化 TCP 参数，更多参数视运行情况设置。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">net.ipv4.ip_local_port_range = 1024 65000</span><br><span class="line">net.ipv4.tcp_fin_timeout = 30</span><br></pre></td></tr></table></figure>

<ul>
<li>NUMA 架构</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">numa = off</span><br><span class="line">numactl --interleave=all</span><br></pre></td></tr></table></figure>

<ul>
<li>资源限制</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ulimit</span> -SH 65535</span><br></pre></td></tr></table></figure>

<h2 id="MySQL-配置文件"><a href="#MySQL-配置文件" class="headerlink" title="MySQL 配置文件"></a>MySQL 配置文件</h2><p>欲知后事如何，且听下回分解。</p>
]]></content>
      <categories>
        <category>database</category>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 存储过程事务控制</title>
    <url>/2018/10/10/mysql-procedure-commit/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/mysql-procedure-commit.png" alt="MySQL 命令行提示符配置"></p>
<p>在使用存储过程批量插入数据时，没有进行事务控制，造成效率低下，特此记录。</p>
<blockquote>
<p>MySQL 版本：5.7.12</p>
</blockquote>
<span id="more"></span>

<h1 id="MySQL-存储过程事务控制"><a href="#MySQL-存储过程事务控制" class="headerlink" title="MySQL 存储过程事务控制"></a>MySQL 存储过程事务控制</h1><p>创建表：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `users` (</span><br><span class="line">   `id` <span class="type">bigint</span>(<span class="number">21</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">   `first_name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">   `last_name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">   `cre_date` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">   <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line"> ) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_unicode_ci;</span><br></pre></td></tr></table></figure>

<p>创建存储过程：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> DEFINER<span class="operator">=</span>`root`@`localhost` <span class="keyword">PROCEDURE</span> `batch_insert_data`(<span class="keyword">IN</span> num <span class="type">INT</span>(<span class="number">10</span>))</span><br><span class="line">    <span class="keyword">DETERMINISTIC</span></span><br><span class="line">    <span class="keyword">MODIFIES</span> <span class="keyword">SQL</span> DATA</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> i <span class="type">INT</span> UNSIGNED <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line">    WHILE i <span class="operator">&lt;=</span> num DO</span><br><span class="line">      <span class="keyword">SET</span> <span class="variable">@first</span>_name <span class="operator">=</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      <span class="keyword">SET</span> <span class="variable">@last</span>_name <span class="operator">=</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      <span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(MD5(RAND()),<span class="number">1</span>,<span class="number">10</span>) <span class="keyword">INTO</span> <span class="variable">@first</span>_name;</span><br><span class="line">      <span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(MD5(RAND()),<span class="number">1</span>,<span class="number">10</span>) <span class="keyword">INTO</span> <span class="variable">@last</span>_name;</span><br><span class="line">      <span class="keyword">INSERT</span> <span class="keyword">INTO</span> users <span class="keyword">VALUES</span> (<span class="keyword">NULL</span>, <span class="variable">@first</span>_name, <span class="variable">@last</span>_name, NOW());</span><br><span class="line">      <span class="keyword">SET</span> i <span class="operator">=</span> i<span class="operator">+</span><span class="number">1</span>;</span><br><span class="line">    <span class="keyword">END</span> WHILE;</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<ul>
<li>插入 50 万行数据，事务自动提交：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(root@localhost)[db]&gt; CALL `batch_insert_data`(500000);</span><br><span class="line">Query OK, 1 row affected (33.73 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li>插入 50 万行数据，事务手动提交：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(root@localhost)[db]&gt; BEGIN;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">(root@localhost)[db]&gt; CALL `batch_insert_data`(500000);</span><br><span class="line">Query OK, 1 row affected (19.51 sec)</span><br><span class="line"></span><br><span class="line">(root@localhost)[db]&gt; COMMIT;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li>也可以在存储过程中进行事务控制：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> `batch_insert_data`;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> DEFINER<span class="operator">=</span>`root`@`localhost` <span class="keyword">PROCEDURE</span> `batch_insert_data`(<span class="keyword">IN</span> num <span class="type">INT</span>(<span class="number">10</span>))</span><br><span class="line">    <span class="keyword">DETERMINISTIC</span></span><br><span class="line">    <span class="keyword">MODIFIES</span> <span class="keyword">SQL</span> DATA</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> i <span class="type">INT</span> UNSIGNED <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">START</span> TRANSACTION;</span><br><span class="line">    WHILE i <span class="operator">&lt;=</span> num DO</span><br><span class="line">      <span class="keyword">SET</span> <span class="variable">@first</span>_name <span class="operator">=</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      <span class="keyword">SET</span> <span class="variable">@last</span>_name <span class="operator">=</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      <span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(MD5(RAND()),<span class="number">1</span>,<span class="number">10</span>) <span class="keyword">INTO</span> <span class="variable">@first</span>_name;</span><br><span class="line">      <span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(MD5(RAND()),<span class="number">1</span>,<span class="number">10</span>) <span class="keyword">INTO</span> <span class="variable">@last</span>_name;</span><br><span class="line">      <span class="keyword">INSERT</span> <span class="keyword">INTO</span> users <span class="keyword">VALUES</span> (<span class="keyword">NULL</span>, <span class="variable">@first</span>_name, <span class="variable">@last</span>_name, NOW());</span><br><span class="line">      <span class="keyword">SET</span> i <span class="operator">=</span> i<span class="operator">+</span><span class="number">1</span>;</span><br><span class="line">    <span class="keyword">END</span> WHILE;</span><br><span class="line">    <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<p>插入 50 万行数据：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(root@localhost)[db]&gt; CALL `batch_insert_data`(500000);</span><br><span class="line">Query OK, 0 rows affected (19.32 sec)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>database</category>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 命令行提示符配置</title>
    <url>/2018/10/10/mysql-prompt/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/mysql-prompt.png" alt="MySQL 命令行提示符配置"></p>
<p>个性化配置 MySQL 命令行提示符不仅为了美观，而且必要的提示信息可以减小一些人为错误操作的几率。</p>
<blockquote>
<p>MySQL 版本：5.7.12</p>
</blockquote>
<span id="more"></span>

<h1 id="MySQL-命令行提示符配置"><a href="#MySQL-命令行提示符配置" class="headerlink" title="MySQL 命令行提示符配置"></a>MySQL 命令行提示符配置</h1><p>提示符配置项说明：</p>
<p>| Option 	| Description                                                        	|<br>|——–	|——————————————————————–	|<br>| \C     	| The current   connection identifier                                	|<br>| \c     	| A counter that   increments for each statement you issue           	|<br>| \D     	| The full current date                                              	|<br>| \d     	| The default database                                               	|<br>| \h     	| The server host                                                    	|<br>| \l     	| The current delimiter                                              	|<br>| \m     	| Minutes of the   current time                                      	|<br>| \n     	| A newline character                                                	|<br>| \O     	| The current month in   three-letter format (Jan, Feb, …)           	|<br>| \o     	| The current month in   numeric format                              	|<br>| \P     	| am&#x2F;pm                                                              	|<br>| \p     	| The current TCP&#x2F;IP   port or socket file                           	|<br>| \R     	| The current time, in   24-hour military time (0–23)                	|<br>| \r     	| The current time,   standard 12-hour time (1–12)                   	|<br>| \S     	| Semicolon                                                          	|<br>| \s     	| Seconds of the   current time                                      	|<br>| \t     	| A tab character                                                    	|<br>| \U     	| Your full   user_name@host_name account name                       	|<br>| \u     	| Your user name                                                     	|<br>| \v     	| The server version                                                 	|<br>| \w     	| The current day of   the week in three-letter format (Mon, Tue, …) 	|<br>| \Y     	| The current year,   four digits                                    	|<br>| \y     	| The current year, two   digits                                     	|<br>| _     	| A space                                                            	|<br>| \      	| A space (a space follows the backslash)                            	|<br>| &#39;     	| Single quote                                                       	|<br>| &quot;     	| Double quote                                                       	|<br>| \     	| A literal \ backslash character                                    	|<br>| \x     	| x, for any “x” not listed above                                    	|</p>
<p>通过修改环境变量制定提示符：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql&gt;</span><br><span class="line">mysql&gt; prompt (\U)[\d]&gt;\_</span><br><span class="line">PROMPT <span class="built_in">set</span> to <span class="string">&#x27;(\U)[\d]&gt;\_&#x27;</span></span><br><span class="line">(root@localhost)[mysql]&gt;</span><br><span class="line">(root@localhost)[mysql]&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(root@localhost)[mysql]&gt;</span><br><span class="line">(root@localhost)[mysql]&gt; prompt (\U) \D [\d]&gt;\_</span><br><span class="line">PROMPT <span class="built_in">set</span> to <span class="string">&#x27;(\U) \D [\d]&gt;\_&#x27;</span></span><br><span class="line">(root@localhost) Wed Oct 10 14:00:23 2018 [mysql]&gt;</span><br><span class="line">(root@localhost) Wed Oct 10 14:00:29 2018 [mysql]&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(root@localhost) Wed Oct 10 14:00:30 2018 [mysql]&gt;</span><br><span class="line">(root@localhost) Wed Oct 10 14:00:30 2018 [mysql]&gt; prompt</span><br><span class="line">Returning to default PROMPT of mysql&gt;</span><br><span class="line">mysql&gt;</span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<p>通过修改 MySQL 配置文件制定提示符：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[mysql]</span><br><span class="line">prompt = <span class="string">&#x27;(\U)[\d]&gt;\_&#x27;</span></span><br></pre></td></tr></table></figure>

<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/mysql-commands.html">https://dev.mysql.com/doc/refman/5.7/en/mysql-commands.html</a></li>
</ul>
]]></content>
      <categories>
        <category>database</category>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>安装配置 PMM</title>
    <url>/2018/05/23/pmm-install/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/pmm-install.jpg" alt="安装配置 PMM"></p>
<p>Percona Monitoring and Management (PMM) 是用于管理和监控 MySQL 和 MongoDB 性能的开源平台，通过 PMM 客户端收集到的 DB 监控数据用第三方软件 Grafana 展示出来。下文为测试环境安装配置 PMM。</p>
<blockquote>
<p>PMM Server 版本：1.10.0</p>
<p>操作系统版本：CentOS 6.7 x86_64</p>
</blockquote>
<span id="more"></span>

<h1 id="PMM-Server-安装"><a href="#PMM-Server-安装" class="headerlink" title="PMM Server 安装"></a>PMM Server 安装</h1><p>PMM Server 提供两种安装介质，一种是 DOCKER 镜像，一种是 OVF 镜像文件。在这里我选择使用 VirtualBox 虚拟机安装 PMM Server。下载 <a href="https://www.percona.com/downloads/pmm/">OVF 镜像文件</a> 后，使用 VirtualBox 导入镜像文件启动虚拟机；在浏览器中打开虚拟机显示的访问地址，设置用户名与密码完成配置；至此 PMM Server 安装完成。</p>
<blockquote>
<p><strong>注意：导入 OVF 镜像文件时需要重置 MAC 地址；网络连接方式选择桥接网卡；</strong></p>
<p><strong>系统用户：root 密码：percona</strong></p>
</blockquote>
<h1 id="PMM-client-安装"><a href="#PMM-client-安装" class="headerlink" title="PMM client 安装"></a>PMM client 安装</h1><p>使用 yum 方式安装客户端</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install http://www.percona.com/downloads/perconarelease/redhat/0.1-4/perconarelease-0.1-4.noarch.rpm</span><br><span class="line">yum -y install pmm-client</span><br></pre></td></tr></table></figure>

<h1 id="PMM-client-配置"><a href="#PMM-client-配置" class="headerlink" title="PMM client 配置"></a>PMM client 配置</h1><p>PMM client 连接 PMM Server，此次需要输入在浏览器中设置的用户名、密码。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@pmm_client ~]<span class="comment"># pmm-admin config --Server &#123;pmm_server_ip&#125; --Server-user &#123;username&#125; --Server-password &#123;password&#125;</span></span><br><span class="line">OK, PMM server is alive.</span><br><span class="line"></span><br><span class="line">PMM Server      | 10.1.1.1 (password-protected)</span><br><span class="line">Client Name     | pmm_client</span><br><span class="line">Client Address  | 10.1.1.2</span><br></pre></td></tr></table></figure>

<p>添加监控项，此处需要使用到 MySQL 用户信息。</p>
<blockquote>
<p>注意 PMM server 根据不同监控要求，要打开 42000、42001、42002 端口。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@pmm_client ~]<span class="comment"># pmm-admin add linux:metrics</span></span><br><span class="line">OK, now monitoring this system.</span><br><span class="line"></span><br><span class="line">[root@pmm_client ~]<span class="comment"># pmm-admin add mysql:metrics --user &#123;mysql_user&#125; --password &#123;mysql_password&#125; --create-user</span></span><br><span class="line">OK, now monitoring MySQL metrics using DSN pmm:***@unix(/var/lib/mysql/mysql.sock)</span><br></pre></td></tr></table></figure>

<p>查看监控情况</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@pmm_client ~]<span class="comment"># pmm-admin list</span></span><br><span class="line">pmm-admin 1.10.0</span><br><span class="line"></span><br><span class="line">PMM Server      | 10.1.1.1 (password-protected)</span><br><span class="line">Client Name     | pmm_client</span><br><span class="line">Client Address  | 10.1.1.2</span><br><span class="line">Service Manager | linux-upstart</span><br><span class="line"></span><br><span class="line">-------------- ----------------- ----------- -------- ------------------------------------- --------</span><br><span class="line">SERVICE TYPE   NAME              LOCAL PORT  RUNNING  DATA SOURCE                           OPTIONS</span><br><span class="line">-------------- ----------------- ----------- -------- ------------------------------------- --------</span><br><span class="line">linux:metrics  pmm_client  42000       YES      -</span><br><span class="line">mysql:metrics  pmm_client  42002       YES      pmm:***@unix(/mysql/data/mysql.sock)</span><br></pre></td></tr></table></figure>

<p>查看网络连接情况</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@pmm_client ~]<span class="comment"># pmm-admin check-network</span></span><br><span class="line">PMM Network Status</span><br><span class="line"></span><br><span class="line">Server Address | 10.1.1.1</span><br><span class="line">Client Address | 10.1.1.2</span><br><span class="line"></span><br><span class="line">* System Time</span><br><span class="line">NTP Server (0.pool.ntp.org)         | 2018-05-23 11:34:49 +0800 CST</span><br><span class="line">PMM Server                          | 2018-05-23 03:34:49 +0000 GMT</span><br><span class="line">PMM Client                          | 2018-05-23 11:34:50 +0800 CST</span><br><span class="line">PMM Server Time Drift               | OK</span><br><span class="line">PMM Client Time Drift               | OK</span><br><span class="line">PMM Client to PMM Server Time Drift | OK</span><br><span class="line"></span><br><span class="line">* Connection: Client --&gt; Server</span><br><span class="line">-------------------- -------</span><br><span class="line">SERVER SERVICE       STATUS</span><br><span class="line">-------------------- -------</span><br><span class="line">Consul API           OK</span><br><span class="line">Prometheus API       OK</span><br><span class="line">Query Analytics API  DOWN</span><br><span class="line"></span><br><span class="line">Connection duration | 411.068µs</span><br><span class="line">Request duration    | 10.429001ms</span><br><span class="line">Full round trip     | 10.840069ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">* Connection: Client &lt;-- Server</span><br><span class="line">-------------- ----------------- ------------------ ------- ---------- ---------</span><br><span class="line">SERVICE TYPE   NAME              REMOTE ENDPOINT    STATUS  HTTPS/TLS  PASSWORD</span><br><span class="line">-------------- ----------------- ------------------ ------- ---------- ---------</span><br><span class="line">linux:metrics  pmm_client  10.1.1.2:42000  OK      YES        YES</span><br><span class="line">mysql:metrics  pmm_client  10.1.1.2:42002  OK      YES        YES</span><br></pre></td></tr></table></figure>

<p>PMM 详细的监控配置，会记录在后续文章。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="https://www.percona.com/doc/percona-monitoring-and-management/index.html">Percona Monitoring and Management Documentation</a></li>
</ul>
]]></content>
      <categories>
        <category>monitor</category>
      </categories>
      <tags>
        <tag>PMM</tag>
      </tags>
  </entry>
  <entry>
    <title>在 CentOS 7 上安装 Redis 3.2.8</title>
    <url>/2017/03/24/redis-install/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/redis-install.png" alt="在 CentOS 7 上安装 Redis 3.2.8"></p>
<p>在测试环境安装配置 Redis 进行测试与学习。</p>
<blockquote>
<p>CentOS 版本：7.3 x86_64</p>
<p>Redis 版本：3.2.8</p>
</blockquote>
<span id="more"></span>

<h1 id="redis-安装"><a href="#redis-安装" class="headerlink" title="redis 安装"></a>redis 安装</h1><p>下载安装包</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget http://download.redis.io/releases/redis-3.2.8.tar.gz</span><br></pre></td></tr></table></figure>

<p>安装编译所需依赖包</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install gcc gcc-c++ jemalloc</span><br></pre></td></tr></table></figure>

<p>编译安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar zxvf redis-3.2.8.tar.gz</span><br><span class="line"><span class="built_in">cd</span> redis-3.2.8</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h1 id="redis-配置"><a href="#redis-配置" class="headerlink" title="redis 配置"></a>redis 配置</h1><p>配置系统环境</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> 511 &gt; /proc/sys/net/core/somaxconn</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&quot;</span> &gt;&gt; /etc/rc.local</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;vm.overcommit_memory = 1&quot;</span> &gt;&gt; /usr/lib/sysctl.d/00-system.conf</span><br><span class="line"><span class="built_in">chmod</span> +x /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure>

<p>创建目录</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/redis /var/redis/6666</span><br></pre></td></tr></table></figure>

<p>配置启动脚本，使用6666端口</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> utils/redis_init_script /etc/init.d/redis_6666</span><br><span class="line">sed -i <span class="string">&quot;s@^REDISPORT.*@REDISPORT = 6666@&quot;</span> /etc/init.d/redis_6666</span><br></pre></td></tr></table></figure>

<p>修改 redis 配置文件，使用6666端口</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> redis.conf /etc/redis/6666.conf</span><br><span class="line">sed -i <span class="string">&quot;s@^daemonize.*@daemonize yes@&quot;</span> /etc/init.d/redis_6666</span><br><span class="line">sed -i <span class="string">&quot;s@^port 6379.*@port 6666@&quot;</span> /etc/init.d/redis_6666</span><br><span class="line">sed -i <span class="string">&quot;s@^pidfile /var/run/redis_6379.pid@pidfile /var/run/redis_6666.pid@&quot;</span> /etc/init.d/redis_6666</span><br><span class="line">sed -i <span class="string">&quot;s@^dir ./@dir /var/redis/6666@&quot;</span> /etc/init.d/redis_6666</span><br></pre></td></tr></table></figure>

<h1 id="启动-redis-程序"><a href="#启动-redis-程序" class="headerlink" title="启动 redis 程序"></a>启动 redis 程序</h1><p>启动 redis</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/etc/init.d/redis_6666 start</span><br></pre></td></tr></table></figure>

<p>使用 redis 客户端进行交互</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">redis-cli -p 6666</span><br></pre></td></tr></table></figure>

<h1 id="添加-redis-服务"><a href="#添加-redis-服务" class="headerlink" title="添加 redis 服务"></a>添加 redis 服务</h1><p>创建 redis 服务脚本</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/systemd/system/redis_6666.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Redis on port 6666</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/etc/init.d/redis_6666 start</span><br><span class="line">ExecStop=/etc/init.d/redis_6666 stop</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>测试 redis 服务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl start redis_6666.service</span><br><span class="line">systemctl stop redis_6666.service</span><br></pre></td></tr></table></figure>

<p>设置 redis 开机自启动</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> redis_6666.service</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>database</category>
        <category>redis</category>
      </categories>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>资源汇总</title>
    <url>/2017/04/11/resource-summary/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/resource-summary.png" alt="资源汇总"></p>
<p>提取工作、学习中的相关信息，进行归档。</p>
<span id="more"></span>

<h1 id="日常使用应用"><a href="#日常使用应用" class="headerlink" title="日常使用应用"></a>日常使用应用</h1><ul>
<li>浏览器<ul>
<li><a href="https://www.google.com/chrome/browser/desktop/index.html">Googl Chrome</a> - 是我最喜欢的浏览器，没有之一。配合 Shadowsocks 简直帅的飞起。</li>
<li><a href="https://www.mozilla.org/zh-CN/firefox/new/">Mozilla Firefox</a> - 使用频率低，只是用于测试。</li>
</ul>
</li>
<li>阅读<ul>
<li><a href="https://www.amazon.cn/gp/digital/fiona/kcp-landing-page/ref=sv_kinc_2">Kindle PC 版</a> - 可以方便的在电脑上阅读，再配上 Kindle Unlimited 服务，好书不断。</li>
</ul>
</li>
<li>音乐<ul>
<li><a href="http://music.163.com/download">网易云音乐</a> - 日常听歌必备。</li>
</ul>
</li>
<li>笔记<ul>
<li><a href="https://www.yinxiang.com/download/">Evernote</a> - 我的知识收集管理工具。虽然在目录结构制定、<del>markdown支持、</del> 索引性能上有欠缺，但是瑕不掩瑜，还是我日常使用频率最高的工具。</li>
<li><a href="https://note.youdao.com/download.html">有道云笔记</a> - <del>在目录结构制定、markdown 支持上比 Evernote 要好，所以我偶尔会使用它编写MD文档。</del> 已弃用。</li>
</ul>
</li>
<li>网盘<ul>
<li><a href="https://onedrive.live.com/about/zh-cn/download/">OneDrive</a> - 因为我购买了 Office 365 家庭版，所以赠送了 1TB 空间，我用来存储工作文件，缺点就是同步速度慢。</li>
<li><a href="https://pan.baidu.com/">百度网盘</a> - 我主要存储一些电子书、教学视频、电影、工具等。</li>
</ul>
</li>
<li>邮件客户端<ul>
<li><a href="http://www.foxmail.com/">Foxmail</a> - 好多年一直用它。</li>
</ul>
</li>
<li>通讯<ul>
<li><a href="http://tim.qq.com/">TIM</a> - 是企业版 QQ，简洁干净。</li>
<li><a href="https://pc.weixin.qq.com/">微信 PC 版</a> - 主要用于跟朋友联络。</li>
</ul>
</li>
<li>游戏<ul>
<li><a href="http://store.steampowered.com/">Steam</a> - 自从注册了 Steam 天天都是买买买的节奏。</li>
</ul>
</li>
<li>其它<ul>
<li><a href="http://cidian.youdao.com/">有道词典</a> - 老牌的翻译软件。</li>
<li><a href="https://translate.google.cn/">Google 翻译</a> - 在线翻译，一直用它。</li>
<li><a href="http://www.codesector.com/teracopy">TeraCopy</a> - 一款提升 Windows 复制性能的软件。</li>
<li><a href="https://github.com/shadowsocks/shadowsocks-windows/releases">Shadowsocks</a> - <del>畅游互联网，堪称神器，你懂的，</del> 最近被墙的厉害。</li>
<li><a href="https://www.voidtools.com/downloads/">Everything</a> - 快速搜索文档。</li>
<li><a href="https://github.com/snail007/goproxy">goproxy</a> - 新发现的上网神器。</li>
<li><a href="https://wallhaven.cc/">wallhaven</a> - 发现精致图片。</li>
<li><a href="https://tinypng.com/">tinypng</a> - 在不影响视觉效果的前提下，压缩图片大小。</li>
<li><a href="https://www.aliyun.com/product/oss">对象存储 OSS</a> - 用于存储网站配图，备份个人资料等。</li>
</ul>
</li>
</ul>
<h1 id="工作使用应用"><a href="#工作使用应用" class="headerlink" title="工作使用应用"></a>工作使用应用</h1><ul>
<li>编辑器<ul>
<li><a href="https://code.visualstudio.com/">Visual Studio Code</a> - 工作使用它编写Python、Shell脚本。</li>
<li><a href="https://notepad-plus-plus.org/download">Notepad++</a> - 自从用了 Visual Studio Code， 已经较少使用它了。</li>
<li><a href="https://products.office.com/zh-cn/office-365-home">Microsoft Office 2016</a> - 打折时购买了 Office 365 家庭版服务，可以支持5个客户端安装,很超值。</li>
<li><a href="https://www.scootersoftware.com/download.php">BCompare</a> - 一款比较文件、目录差异的软件。</li>
</ul>
</li>
<li>联络<ul>
<li><a href="https://trello.com/">Trello</a> - 公司正在使用的协作服务应用。</li>
<li><a href="https://tms.dingtalk.com/markets/dingtalk/download">钉钉</a> - 工作时使用。</li>
<li><a href="https://www.teamviewer.com/en/download/windows/">TeamViewer</a> - 可以方便的远程控制家里和公司的电脑。</li>
</ul>
</li>
<li>绘图工具<ul>
<li><a href="http://www.xmindchina.net/">XMind</a> - 使用广泛的绘制思维导图软件。</li>
<li><a href="http://naotu.baidu.com/">百度脑图</a> - 在线绘制思维导图。</li>
<li><a href="http://www.ganttproject.biz/download">GanttProject</a> - 可以绘制甘特图。</li>
<li><a href="https://www.processon.com/">ProcessOn</a> - 在线绘制流程图，好用。</li>
</ul>
</li>
<li>MySQL 客户端<ul>
<li><a href="https://dev.mysql.com/downloads/workbench/">MySQL Workbench</a> - 使用它进行数据库设计。</li>
<li><a href="https://www.webyog.com/product/sqlyog">SQLyog</a> - 常用的 MySQL 客户端软件。</li>
</ul>
</li>
<li>版本管理<ul>
<li><a href="https://git-scm.com/downloads">Git</a> - 代码版本管理软件。</li>
<li><a href="https://www.sourcetreeapp.com/">SourceTree</a> - 是一个 GIT 图形界面管理工具，由 atlassian 出品，不过因为一直使用 git 命令行，这个图形界面不太会用。</li>
<li><a href="https://tortoisesvn.net/downloads.zh.html">TortoiseSVN</a> - 存放一些不经常变更的文件。</li>
</ul>
</li>
<li>Linux 客户端<ul>
<li><a href="https://www.netsarang.com/download/main.html">Xshell 5</a> - 是 Linux 下最好用的 SSH 工具。</li>
<li><a href="https://www.netsarang.com/download/main.html">Xftp 5</a> - 和 Xshell 5 配套使用的 SFTP 工具。</li>
<li><a href="https://filezilla-project.org/">FileZilla</a> - 是一个免费开源的 FTP 软件，分为客户端版本和服务器版本。</li>
<li><a href="https://winscp.net/eng/download.php">WinSCP</a> - 是 Windows 下的开源 SFTP 工具。</li>
</ul>
</li>
<li>LAMP 环境<ul>
<li><a href="http://www.wampserver.com/">WampServer</a> - 可以在 Windows 下创建 LAMP 环境。</li>
</ul>
</li>
<li>虚拟机<ul>
<li><a href="https://www.virtualbox.org/wiki/Downloads">Oracle VM VirtualBox</a> - 虚拟机软件。</li>
</ul>
</li>
<li>其它<ul>
<li><a href="https://coffitivity.com/">coffitivity</a>、<a href="http://asoftmurmur.com/">asoftmurmur</a>、<a href="https://www.noisli.com/">noisli</a> - 工作时我喜欢听这些“噪音”。</li>
<li><a href="http://www.tablesgenerator.com/markdown_tables">Markdown Tables Generator</a> - 可以把 excel 表格方便的转换成 markdown 格式。</li>
</ul>
</li>
</ul>
<h1 id="开源镜像站"><a href="#开源镜像站" class="headerlink" title="开源镜像站"></a>开源镜像站</h1><ul>
<li><a href="https://mirror.tuna.tsinghua.edu.cn/">清华大学开源软件镜像站</a></li>
<li><a href="http://mirrors.163.com/">网易开源镜像站</a></li>
<li><a href="http://mirrors.sohu.com/">Sohu 开源镜像站</a></li>
<li><a href="http://mirrors.aliyun.com/">Alibaba 开源镜像站</a></li>
</ul>
<h1 id="HTTPS-工具"><a href="#HTTPS-工具" class="headerlink" title="HTTPS 工具"></a>HTTPS 工具</h1><ul>
<li><a href="https://certbot.eff.org/">Certbot ACME client</a> - 可以申请 letsencrypt 免费证书。</li>
<li><a href="https://mozilla.github.io/server-side-tls/ssl-config-generator/">Mozilla SSL Configuration Generator</a> - 根据 Web程序、OpenSSL程序的版本生成 SSL 配置。</li>
<li><a href="https://www.ssllabs.com/ssltest/analyze.html">SSL Server Test</a> - 测试网站 SSL 证书安全性。</li>
</ul>
<h1 id="MySQL-Blog"><a href="#MySQL-Blog" class="headerlink" title="MySQL Blog"></a>MySQL Blog</h1><ul>
<li><a href="https://www.percona.com/blog/">Percona Database Performance blog</a></li>
<li><a href="http://mysqlserverteam.com/">MySQL Server Blog</a></li>
<li><a href="https://planet.mysql.com/zh/">Planet MySQL</a></li>
<li><a href="http://mysql.taobao.org/">淘宝数据库研发组</a></li>
</ul>
<h1 id="VPS-主机"><a href="#VPS-主机" class="headerlink" title="VPS 主机"></a>VPS 主机</h1><ul>
<li><a href="https://www.digitalocean.com/">digitalocean</a> - 使用了 SSD 硬盘，可以一键安装很多应用环境。</li>
<li><a href="https://www.vultr.com/">vultr</a> - 跟 digitalocean 类似，价格稍微低一些。</li>
<li><a href="https://bwh1.net/">bandwagonhost</a> - <del>我目前使用的 VPS，一键安装 SS，速度还不错。</del> 严重被墙，已弃用。</li>
<li><a href="https://console.cloud.google.com/">Google Cloud Platform</a> - Google 云平台赠送 300 美金额度，翻墙首选。</li>
<li><a href="https://cloud.tencent.com/">腾讯云</a> - 香港区可以搭梯子。</li>
</ul>
]]></content>
      <categories>
        <category>other</category>
      </categories>
  </entry>
  <entry>
    <title>xtrabackup 安装</title>
    <url>/2017/03/15/xtrabackup-manual/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/xtrabackup-manual.png" alt="xtrabackup 安装"></p>
<p>记录 xtrabackup 安装命令。</p>
<blockquote>
<p>操作系统版本：CentOS 6.5_64</p>
<p>MySQL数据库版本：5.7.12-log</p>
<p>xtrabackup版本：2.4</p>
<p>注意：xtrabackup 版本与 MySQL 版本有对应关系：</p>
<p>MySQL5.5 对应 xtrabackup 2.3、MySQL 5.7对应 xtrabackup 2.4</p>
</blockquote>
<span id="more"></span>

<h1 id="安装-xtrabackup"><a href="#安装-xtrabackup" class="headerlink" title="安装 xtrabackup"></a>安装 xtrabackup</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install perl-DBI perl-DBD-MySQL</span><br><span class="line">rpm -ivh libev-4.15-1.el6.rf.x86_64.rpm</span><br><span class="line">yum install http://www.percona.com/downloads/percona-release/redhat/0.1-3/percona-release-0.1-3.noarch.rpm</span><br><span class="line">yum list | grep percona-xtrabackup</span><br><span class="line">yum install percona-xtrabackup-24</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>database</category>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>xtrabackup</tag>
      </tags>
  </entry>
  <entry>
    <title>使用 Docker 创建 redmine 环境</title>
    <url>/2017/03/16/redmine-environment-with-docker/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/redmine-environment-with-docker.png" alt="使用 Docker 创建 redmine 环境"></p>
<p>本文使用 2 种方式创建 redmine 环境。</p>
<blockquote>
<p>操作系统版本：CentOS 7.3</p>
<p>Docker 版本：17.03.0-ce</p>
</blockquote>
<span id="more"></span>

<h1 id="使用-docker-命令创建-redmine-环境"><a href="#使用-docker-命令创建-redmine-环境" class="headerlink" title="使用 docker 命令创建 redmine 环境"></a>使用 docker 命令创建 redmine 环境</h1><p>下载所需镜像</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull mysql</span><br><span class="line">ducker pull redmine</span><br></pre></td></tr></table></figure>

<p>准备 MySQL 配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /home/docker/redmine</span><br><span class="line"><span class="built_in">cat</span> &gt; /home/docker/redmine/my.cnf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[client]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">port                           = 3306</span></span><br><span class="line"><span class="string">default-character-set          = utf8</span></span><br><span class="line"><span class="string">socket                         = /var/run/mysqld/mysqld.sock</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysql]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">port                           = 3306</span></span><br><span class="line"><span class="string">default-character-set          = utf8</span></span><br><span class="line"><span class="string">socket                         = /var/run/mysqld/mysqld.sock</span></span><br><span class="line"><span class="string">prompt                         = &#x27;MySQL[\\u@\\d]&gt; &#x27;</span></span><br><span class="line"><span class="string">no-auto-rehash</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqld]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># GENERAL #</span></span><br><span class="line"><span class="string">user                           = mysql</span></span><br><span class="line"><span class="string">default-storage-engine         = InnoDB</span></span><br><span class="line"><span class="string">socket                         = /var/run/mysqld/mysqld.sock</span></span><br><span class="line"><span class="string">pid-file                       = /var/run/mysqld/mysqld.pid</span></span><br><span class="line"><span class="string">character-set-server           = utf8</span></span><br><span class="line"><span class="string">port                           = 3306</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># MyISAM #</span></span><br><span class="line"><span class="string">key-buffer-size                = 32M</span></span><br><span class="line"><span class="string">#myisam-recover                = FORCE,BACKUP</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># SAFETY #</span></span><br><span class="line"><span class="string">max-allowed-packet             = 1024M</span></span><br><span class="line"><span class="string">max-connect-errors             = 1000000</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># DATA STORAGE #</span></span><br><span class="line"><span class="string">basedir                        = /usr</span></span><br><span class="line"><span class="string">datadir                        = /var/lib/mysql</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># BINARY LOGGING #</span></span><br><span class="line"><span class="string">server_id                      = 1</span></span><br><span class="line"><span class="string">#log-bin                       = /var/log/mysql/mysql-bin</span></span><br><span class="line"><span class="string">#expire-logs-days              = 3</span></span><br><span class="line"><span class="string">sync-binlog                    = 1</span></span><br><span class="line"><span class="string">relay_log_recovery             = 1</span></span><br><span class="line"><span class="string">relay-log                      = /var/log/mysql/relay-log</span></span><br><span class="line"><span class="string">binlog_format                  = row</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># CACHES AND LIMITS #</span></span><br><span class="line"><span class="string">tmp-table-size                 = 32M</span></span><br><span class="line"><span class="string">max-heap-table-size            = 32M</span></span><br><span class="line"><span class="string">query-cache-type               = 0</span></span><br><span class="line"><span class="string">query-cache-size               = 0</span></span><br><span class="line"><span class="string">max-connections                = 500</span></span><br><span class="line"><span class="string">thread-cache-size              = 50</span></span><br><span class="line"><span class="string">open-files-limit               = 65535</span></span><br><span class="line"><span class="string">table-definition-cache         = 1024</span></span><br><span class="line"><span class="string">table-open-cache               = 2048</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># INNODB #</span></span><br><span class="line"><span class="string">innodb-flush-method            = O_DIRECT</span></span><br><span class="line"><span class="string">innodb-log-files-in-group      = 2</span></span><br><span class="line"><span class="string">innodb-log-file-size           = 128M</span></span><br><span class="line"><span class="string">innodb-flush-log-at-trx-commit = 1</span></span><br><span class="line"><span class="string">innodb-file-per-table          = 1</span></span><br><span class="line"><span class="string">innodb-buffer-pool-size        = 1G</span></span><br><span class="line"><span class="string">innodb_buffer_pool_instances   = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Disabling symbolic-links is recommended to prevent assorted security risks</span></span><br><span class="line"><span class="string">symbolic-links=0</span></span><br><span class="line"><span class="string">#sql-mode=&quot;STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&quot;</span></span><br><span class="line"><span class="string">skip-name-resolve</span></span><br><span class="line"><span class="string">skip-external-locking</span></span><br><span class="line"><span class="string">init-connect                   = &#x27;SET NAMES utf8&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># LOGGING #</span></span><br><span class="line"><span class="string">log-error                      = /var/log/mysql/error.log</span></span><br><span class="line"><span class="string">log-queries-not-using-indexes  = 1</span></span><br><span class="line"><span class="string">#slow-query-log                = 1</span></span><br><span class="line"><span class="string">#slow-query-log-file           = /var/log/mysql/slow.log</span></span><br><span class="line"><span class="string">#general-log                   = 1</span></span><br><span class="line"><span class="string">#general_log_file              = /var/log/mysql/general.log</span></span><br><span class="line"><span class="string">#long_query_time               = 3</span></span><br><span class="line"><span class="string">log_timestamps                 = system</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqld_safe]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">log-error                      = /var/log/mysql/error.log</span></span><br><span class="line"><span class="string">socket                         = /var/run/mysqld/mysqld.sock</span></span><br><span class="line"><span class="string">pid-file                       = /var/run/mysqld/mysqld.pid</span></span><br><span class="line"><span class="string">nice                           = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqldump]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">socket                         = /var/run/mysqld/mysqld.sock</span></span><br><span class="line"><span class="string">quick</span></span><br><span class="line"><span class="string">max_allowed_packet             = 1024M</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[myisamchk]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">key_buffer_size                = 20M</span></span><br><span class="line"><span class="string">sort_buffer_size               = 20M</span></span><br><span class="line"><span class="string">read_buffer                    = 2M</span></span><br><span class="line"><span class="string">write_buffer                   = 2M</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqlhotcopy]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">interactive-timeout</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqld_multi]</span></span><br><span class="line"><span class="string">mysqld                         = /usr/bin/mysqld_safe</span></span><br><span class="line"><span class="string">mysqladmin                     = /usr/bin/mysqladmin</span></span><br><span class="line"><span class="string">log                            = /var/log/mysql/mysqld_multi.log</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>启动容器</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d --name redmine_db_1 -v /home/docker/redmine:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=example -e MYSQL_DATABASE=redmine mysql</span><br><span class="line">docker run -d --name redmine_redmine_1 --<span class="built_in">link</span> redmine_db_1:mysql -p 3000:3000 redmine</span><br></pre></td></tr></table></figure>

<p>最后登录：<a href="http://ip:3000/">http://ip:3000</a> 重置管理员密码。</p>
<h1 id="使用-docker-compose-命令创建-redmine-环境"><a href="#使用-docker-compose-命令创建-redmine-环境" class="headerlink" title="使用 docker-compose 命令创建 redmine 环境"></a>使用 docker-compose 命令创建 redmine 环境</h1><p>编写 docker-compose.yml 文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /home/docker/redmine/docker-compose.yml &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">version: &#x27;2&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">services:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  redmine:</span></span><br><span class="line"><span class="string">    image: redmine</span></span><br><span class="line"><span class="string">    ports:</span></span><br><span class="line"><span class="string">      - 3000:3000</span></span><br><span class="line"><span class="string">    environment:</span></span><br><span class="line"><span class="string">      REDMINE_DB_MYSQL: db</span></span><br><span class="line"><span class="string">      REDMINE_DB_PASSWORD: example</span></span><br><span class="line"><span class="string">    depends_on:</span></span><br><span class="line"><span class="string">      - db</span></span><br><span class="line"><span class="string">    restart: always</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  db:</span></span><br><span class="line"><span class="string">    image: mysql</span></span><br><span class="line"><span class="string">    environment:</span></span><br><span class="line"><span class="string">      MYSQL_ROOT_PASSWORD: example</span></span><br><span class="line"><span class="string">      MYSQL_DATABASE: redmine</span></span><br><span class="line"><span class="string">    volumes:</span></span><br><span class="line"><span class="string">      - /home/docker/redmine:/etc/mysql/conf.d</span></span><br><span class="line"><span class="string">    restart: always</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>启动容器</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>查看容器进程</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">09fecc7fca5b        redmine             <span class="string">&quot;/docker-entrypoin...&quot;</span>   9 seconds ago       Up 9 seconds        0.0.0.0:3000-&gt;3000/tcp   redmine_redmine_1</span><br><span class="line">4df9d06426e1        mysql               <span class="string">&quot;docker-entrypoint...&quot;</span>   10 seconds ago      Up 9 seconds        3306/tcp                 redmine_db_1</span><br></pre></td></tr></table></figure>

<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="https://dev.aliyun.com/detail.html?repoId=1260">https://dev.aliyun.com/detail.html?repoId=1260</a></li>
</ul>
]]></content>
      <categories>
        <category>linux</category>
        <category>docker</category>
      </categories>
      <tags>
        <tag>redmine</tag>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>使用 youtube-dl-interactive 下载视频</title>
    <url>/2019/09/22/youtube-dl-interactive/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/youtube-dl-interactive.png" alt="使用 youtube-dl-interactive 下载视频"></p>
<p>youtube-dl-interactive 是交互方式下载 youtube 视频的程序。 它需要 youtube-dl、node.js 支持。</p>
<span id="more"></span>

<h1 id="安装-youtube-dl-interactive"><a href="#安装-youtube-dl-interactive" class="headerlink" title="安装 youtube-dl-interactive"></a>安装 youtube-dl-interactive</h1><ul>
<li>安装 youtube-dl</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://yt-dl.org/downloads/latest/youtube-dl -O /usr/bin/youtube-dl</span><br><span class="line"><span class="built_in">chmod</span> a+rx /usr/bin/youtube-dl</span><br></pre></td></tr></table></figure>

<ul>
<li>安装 node.js</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://nodejs.org/dist/v10.16.0/node-v10.16.0-linux-x64.tar.xz</span><br><span class="line">tar -xJvf node-v10.16.0-linux-x64.tar.xz</span><br><span class="line"><span class="built_in">mv</span> node-v10.16.0-linux-x64 /usr/local/nodejs</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export PATH=/usr/local/nodejs/bin:<span class="variable">$PATH</span>&quot;</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>

<ul>
<li>安装 youtube-dl-interactive</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -g youtube-dl-interactive</span><br></pre></td></tr></table></figure>

<h1 id="使用-youtube-dl-interactive"><a href="#使用-youtube-dl-interactive" class="headerlink" title="使用 youtube-dl-interactive"></a>使用 youtube-dl-interactive</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">youtube-dl-interactive URL</span><br></pre></td></tr></table></figure>

<h1 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h1><p>查看 node 版本：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">node -v</span><br><span class="line">npm version</span><br><span class="line">npx -v</span><br></pre></td></tr></table></figure>

<p>更新 youtube-dl 版本：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">youtube-dl -U</span><br></pre></td></tr></table></figure>

<p>更新 youtube-dl-interactive 版本：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm i -g youtube-dl-interactive</span><br><span class="line">youtube-dl -U</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>other</category>
      </categories>
      <tags>
        <tag>youtube</tag>
      </tags>
  </entry>
  <entry>
    <title>使用 zabbix 监控 DELL 服务器</title>
    <url>/2017/05/15/zabbix-dell-omsa/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/zabbix-dell-omsa.jpg" alt="使用 zabbix 监控 DELL 服务器"></p>
<p>使用 zabbix 监控 DELL 服务器硬件状态，需要安装 OMSA 工具。</p>
<blockquote>
<p>CentOS 版本：6.7 x86_64</p>
<p>zabbix 版本：3.0.8</p>
<p>srvadmin 版本：8.4.0</p>
</blockquote>
<span id="more"></span>

<h1 id="安装-OMSA-工具"><a href="#安装-OMSA-工具" class="headerlink" title="安装 OMSA 工具"></a>安装 OMSA 工具</h1><p>使用 YUM 安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget -q -O - http://linux.dell.com/repo/hardware/DSU_16.12.00/bootstrap.cgi | bash</span><br><span class="line">yum install -y srvadmin-base srvadmin-storageservices</span><br><span class="line">service dataeng start</span><br><span class="line">chkconfig dataeng on</span><br><span class="line"><span class="built_in">ln</span> -s /opt/dell/srvadmin/sbin/omreport /usr/bin/omreport</span><br><span class="line"><span class="built_in">ln</span> -s /opt/dell/srvadmin/sbin/omconfig /usr/bin/omconfig</span><br></pre></td></tr></table></figure>

<p>使用 RPM 包安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://downloads.dell.com/FOLDER03909029M/1/OM-SrvAdmin-Dell-Web-LX-8.4.0-2193.RHEL6.x86_64_A00.tar.gz</span><br><span class="line">tar -zxvf OM-SrvAdmin-Dell-Web-LX-8.4.0-2193.RHEL6.x86_64_A00.tar.gz</span><br><span class="line">./setup.sh</span><br></pre></td></tr></table></figure>

<h1 id="配置-zabbix-agent"><a href="#配置-zabbix-agent" class="headerlink" title="配置 zabbix-agent"></a>配置 zabbix-agent</h1><p>添加 <code>userparameter_dell.conf</code> 文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/zabbix/zabbix_agentd.d/userparameter_dell.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">UserParameter=hardware_battery,omreport chassis batteries|awk &#x27;/^Status/&#123;if($NF==&quot;Ok&quot;) &#123;print 1&#125; else &#123;print 0&#125;&#125;&#x27;</span></span><br><span class="line"><span class="string">UserParameter=hardware_fan_health,awk -vhardware_fan_number=`omreport chassis fans|grep -c &quot;^Index&quot;` -vhardware_fan=`omreport chassis fans|awk &#x27;/^Status/&#123;if($NF==&quot;Ok&quot;) count+=1&#125;END&#123;print count&#125;&#x27;` &#x27;BEGIN&#123;if(hardware_fan_number==hardware_fan) &#123;print 1&#125; else &#123;print 0&#125;&#125;&#x27;</span></span><br><span class="line"><span class="string">UserParameter=hardware_memory_health,awk -vhardware_memory=`omreport chassis memory|awk &#x27;/^Health/&#123;print $NF&#125;&#x27;` &#x27;BEGIN&#123;if(hardware_memory==&quot;Ok&quot;) &#123;print 1&#125; else &#123;print 0&#125;&#125;&#x27;</span></span><br><span class="line"><span class="string">UserParameter=hardware_nic_health,awk -vhardware_nic_number=`omreport chassis nics |grep -c &quot;Interface Name&quot;` -vhardware_nic=`omreport chassis nics |awk &#x27;/^Connection Status/&#123;print $NF&#125;&#x27;|wc -l` &#x27;BEGIN&#123;if(hardware_nic_number==hardware_nic) &#123;print 1&#125; else &#123;print 0&#125;&#125;&#x27;</span></span><br><span class="line"><span class="string">UserParameter=hardware_cpu,omreport chassis processors|awk &#x27;/^Health/&#123;if($NF==&quot;Ok&quot;) &#123;print 1&#125; else &#123;print 0&#125;&#125;&#x27;</span></span><br><span class="line"><span class="string">UserParameter=hardware_power_health,awk -vhardware_power_number=`omreport chassis pwrsupplies|grep -c &quot;Index&quot;` -vhardware_power=`omreport chassis pwrsupplies|awk &#x27;/^Status/&#123;if($NF==&quot;Ok&quot;) count+=1&#125;END&#123;print count&#125;&#x27;` &#x27;BEGIN&#123;if(hardware_power_number==hardware_power) &#123;print 1&#125; else &#123;print 0&#125;&#125;&#x27;</span></span><br><span class="line"><span class="string">UserParameter=hardware_temp,omreport chassis temps|awk &#x27;/^Status/&#123;if($NF==&quot;Ok&quot;) &#123;print 1&#125; else &#123;print 0&#125;&#125;&#x27;|head -n 1</span></span><br><span class="line"><span class="string">UserParameter=hardware_physics_health,awk -vhardware_physics_disk_number=`omreport storage pdisk controller=0|grep -c &quot;^ID&quot;` -vhardware_physics_disk=`omreport storage pdisk controller=0|awk &#x27;/^Status/&#123;if($NF==&quot;Ok&quot;) count+=1&#125;END&#123;print count&#125;&#x27;` &#x27;BEGIN&#123;if(hardware_physics_disk_number==hardware_physics_disk) &#123;print 1&#125; else &#123;print 0&#125;&#125;&#x27;</span></span><br><span class="line"><span class="string">UserParameter=hardware_virtual_health,awk -vhardware_virtual_disk_number=`omreport storage vdisk controller=0|grep -c &quot;^ID&quot;` -vhardware_virtual_disk=`omreport storage vdisk controller=0|awk &#x27;/^Status/&#123;if($NF==&quot;Ok&quot;) count+=1&#125;END&#123;print count&#125;&#x27;` &#x27;BEGIN&#123;if(hardware_virtual_disk_number==hardware_virtual_disk) &#123;print 1&#125; else &#123;print 0&#125;&#125;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>重启 agent 服务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service zabbix-agent restart</span><br></pre></td></tr></table></figure>

<h1 id="zabbix-server-添加-zapache-模板"><a href="#zabbix-server-添加-zapache-模板" class="headerlink" title="zabbix server 添加 zapache 模板"></a>zabbix server 添加 zapache 模板</h1><p>登录 zabbix server 控制台，点击 Configuration–Templates–Import–选择文件，导入<a href="/data/zabbix_template_hardware_dell.xml">模板文件</a>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">zabbix_template_hardware_dell.xml</span><br></pre></td></tr></table></figure>

<p>最后把模板应用到要监控的主机即可。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="http://www.jianshu.com/p/ecbd5e21924b">zabbix 硬件 | dell服务器硬件监控</a></li>
<li><a href="http://www.dell.com/support/manuals/us/en/19/dell-openmanage-server-administrator-8.4/OMSA%20_CLI8.4/omreport-Viewing-System-Status-Using-The-Instrumentation-Service?guid=GUID-5813B280-97B4-4686-861F-7DBB25767ADC&lang=en-us">Dell OpenManage Server Administrator Version 8.4 Command Line Interface Guide</a></li>
</ul>
]]></content>
      <categories>
        <category>monitor</category>
      </categories>
      <tags>
        <tag>dell</tag>
        <tag>zabbix</tag>
        <tag>omsa</tag>
      </tags>
  </entry>
  <entry>
    <title>zabbix 3.0.7 安装</title>
    <url>/2017/03/15/zabbix-install/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/zabbix-install.png" alt="zabbix 3.0.7 安装"></p>
<p>在测试环境安装配置 zabbix，用来进行学习。</p>
<blockquote>
<p>zabbix 需要运行在 LAMP 上，具体配置要求可以查看 <a href="https://www.zabbix.com/documentation/3.0/manual/installation/requirements">zabbix 3.0 documentation</a></p>
<p>CentOS 版本：6.7 x86_64</p>
<p>MySQL 版本为：5.7.12</p>
<p>PHP 版本为：5.5.38</p>
<p>Apache 版本为：2.2.15</p>
</blockquote>
<span id="more"></span>

<h1 id="安装-MySQL-5-7"><a href="#安装-MySQL-5-7" class="headerlink" title="安装 MySQL 5.7"></a>安装 MySQL 5.7</h1><p>使用二进制安装包，安装步骤请参考：<a href="https://iamtim.wang/2017/04/26/install-mysql-5.7.18-for-generic-binaries">二进制安装 MySQL 5.7.18</a></p>
<h1 id="安装-PHP-5-5"><a href="#安装-PHP-5-5" class="headerlink" title="安装 PHP 5.5"></a>安装 PHP 5.5</h1><p>安装 YUM 源</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -Uvh https://mirror.webtatic.com/yum/el6/latest.rpm</span><br></pre></td></tr></table></figure>

<p>安装 PHP</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install httpd php55w php55w-mysql php55w-gd php55w-imap php55w-ldap php55w-odbc php55w-pear php55w-xml php55w-xmlrpc php55w-mcrypt php55w-mbstring php55w-devel php55w-pecl-memcached  php55w-common php55w-pdo php55w-cli php55w-pecl-memcache php55w-bcmath php55w-fpm</span><br></pre></td></tr></table></figure>

<p>修改 <code>/etc/php.ini</code> 文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysqli.default_socket = /mysql/data/mysql.sock</span><br></pre></td></tr></table></figure>

<h1 id="安装-zabbix-3-0-7"><a href="#安装-zabbix-3-0-7" class="headerlink" title="安装 zabbix 3.0.7"></a>安装 zabbix 3.0.7</h1><p>更新 curl</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d</span><br><span class="line">rename .repo .bak *.repo</span><br><span class="line">wget http://mirrors.163.com/.help/CentOS6-Base-163.repo</span><br><span class="line">sed -i <span class="string">&#x27;s@^exclude@#exclude@&#x27;</span> /etc/yum.conf</span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br><span class="line">yum install curl libcurl libcurl-devel</span><br></pre></td></tr></table></figure>

<p>安装 zabbix 源</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -ivh http://repo.zabbix.com/zabbix/3.0/rhel/6/x86_64/zabbix-release-3.0-1.el6.noarch.rpm</span><br><span class="line">yum install zabbix-server-mysql zabbix-web-mysql</span><br></pre></td></tr></table></figure>

<p>创建 zabbix 数据库</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">create database zabbix character <span class="built_in">set</span> utf8 collate utf8_bin;</span><br><span class="line">grant all privileges on zabbix.* to zabbix@localhost identified by <span class="string">&#x27;xxxx&#x27;</span>;</span><br><span class="line">zcat /usr/share/doc/zabbix-server-mysql-3.0.7/create.sql.gz | mysql -uzabbix -p</span><br></pre></td></tr></table></figure>

<p>配置 zabbix 数据库连接</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/zabbix/zabbix_server.conf</span><br><span class="line">DBHost=localhost</span><br><span class="line">DBName=zabbix</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=xxxx</span><br></pre></td></tr></table></figure>

<p>添加 zabbix 的 apache 配置</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> /usr/share/doc/zabbix-web-3.0.7/httpd22-example.conf /etc/httpd/conf.d/zabbix.conf</span><br><span class="line">sed -i <span class="string">&quot;s@# php_value date.timezone Europe/Riga@php_value date.timezone Asia/Shanghai@&quot;</span> /etc/httpd/conf.d/zabbix.conf</span><br><span class="line">service httpd restart</span><br></pre></td></tr></table></figure>

<p>访问 <a href="http://ip/zabbix">http://ip/zabbix</a> 进行初始化配置。</p>
]]></content>
      <categories>
        <category>monitor</category>
      </categories>
      <tags>
        <tag>zabbix</tag>
      </tags>
  </entry>
  <entry>
    <title>使用 zapache 模板监控 Apache</title>
    <url>/2017/04/06/zabbix-zapache/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/zabbix-zapache.jpg" alt="使用 zapache 模板监控 Apache"></p>
<p>zabbix 自带的监控 Apache 功能很弱，所以安装 <a href="https://github.com/lorf/zapache">zapache</a> 模板监控 Apache。</p>
<blockquote>
<p>CentOS 版本：6.7 x86_64</p>
<p>Apache 版本：2.2.15</p>
<p>zabbix 版本：3.0.8</p>
<p>zapache 版本：1.5</p>
</blockquote>
<span id="more"></span>

<h1 id="安装-zapache"><a href="#安装-zapache" class="headerlink" title="安装 zapache"></a>安装 zapache</h1><p>下载 zapache 程序</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/lorf/zapache.git</span><br><span class="line"><span class="built_in">cd</span> zapache</span><br></pre></td></tr></table></figure>

<p>拷贝脚本和配置</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> zapache /etc/zabbix/</span><br><span class="line"><span class="built_in">chmod</span> +x /etc/zabbix/zapache</span><br><span class="line"><span class="built_in">cp</span> userparameter_zapache.conf.sample /etc/zabbix/zabbix_agentd.d/userparameter_zapache.conf</span><br></pre></td></tr></table></figure>

<p>修改 Apache 配置文件，添加如下内容：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ExtendedStatus On</span><br><span class="line">&lt;Location /server-status&gt;</span><br><span class="line">    SetHandler server-status</span><br><span class="line">    Order deny,allow</span><br><span class="line">    Deny from all</span><br><span class="line">    Allow from localhost ::1</span><br><span class="line">&lt;/Location&gt;</span><br></pre></td></tr></table></figure>

<p>修改 <code>/etc/zabbix/zabbix_agentd.d/userparameter_zapache.conf</code> 文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">UserParameter=zapache[*],/etc/zabbix/zapache \<span class="variable">$1</span></span><br></pre></td></tr></table></figure>

<p>重启 Apache、zabbix 服务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service httpd restart</span><br><span class="line">service zabbix-agent restart</span><br></pre></td></tr></table></figure>

<h1 id="zabbix-server-添加-zapache-模板"><a href="#zabbix-server-添加-zapache-模板" class="headerlink" title="zabbix server 添加 zapache 模板"></a>zabbix server 添加 zapache 模板</h1><p>登录 zabbix server 控制台，点击 Configuration–Templates–Import–选择文件，导入<a href="/data/zapache-template.xml">模板文件</a>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">zapache-template.xml</span><br></pre></td></tr></table></figure>

<p>最后把模板应用到要监控的主机即可。</p>
]]></content>
      <categories>
        <category>monitor</category>
      </categories>
      <tags>
        <tag>zabbix</tag>
        <tag>zapache</tag>
      </tags>
  </entry>
  <entry>
    <title>使用 fpmmm 模板监控 MySQL</title>
    <url>/2017/04/01/zabbix-fpmmm/</url>
    <content><![CDATA[<p><img src="https://iamtimwang.oss-cn-beijing.aliyuncs.com/zabbix-fpmmm.png" alt="使用 fpmmm 模板监控 MySQL"></p>
<p>zabbix 自带的监控 MySQL 功能很弱，所以安装 <a href="https://www.fromdual.com/">fpmmm</a> 模板监控 MySQL。</p>
<blockquote>
<p>CentOS 版本：6.7 x86_64</p>
<p>MySQL 版本：5.7.12</p>
<p>zabbix 版本：3.0.8</p>
<p>fpmmm 版本：0.10.6</p>
</blockquote>
<span id="more"></span>

<h1 id="安装-zabbix-agent"><a href="#安装-zabbix-agent" class="headerlink" title="安装 zabbix-agent"></a>安装 zabbix-agent</h1><p>使用 YUM 方式安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -ivh http://repo.zabbix.com/zabbix/3.0/rhel/6/x86_64/zabbix-release-3.0-1.el6.noarch.rpm</span><br><span class="line">yum --enablerepo=zabbix install zabbix-agent zabbix-sender -y</span><br></pre></td></tr></table></figure>

<p>修改 <code>/etc/zabbix/zabbix_agentd.conf</code> 配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Server=zabbix-server-ip</span><br><span class="line">ServerActive=zabbix-server-ip</span><br><span class="line">Hostname=zabbix-agent-hostname</span><br></pre></td></tr></table></figure>

<p>启动 zabbix-agent</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service zabbix-agent start</span><br><span class="line">chkconfig zabbix-agent on</span><br></pre></td></tr></table></figure>

<h1 id="安装-fpmmm"><a href="#安装-fpmmm" class="headerlink" title="安装 fpmmm"></a>安装 fpmmm</h1><h2 id="安装-php-环境"><a href="#安装-php-环境" class="headerlink" title="安装 php 环境"></a>安装 php 环境</h2><p>fpmmm 需要 php 支持，YUM 安装 php 环境</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -Uvh https://mirror.webtatic.com/yum/el6/latest.rpm</span><br><span class="line">yum install php55w-mysql php55w-process php55w-cli</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/php.d/fpmmm.ini &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">variables_order = &quot;EGPCS&quot;</span></span><br><span class="line"><span class="string">date.timezone = &#x27;Asia/Shanghai&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>fpmmm 需要加载 php-memcached 模块，而 webtatic 源中没有 php-memcached 扩展，所以需要自己编译。</p>
<p>首先编译安装 libmemcached</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://launchpadlibrarian.net/165454254/libmemcached-1.0.18.tar.gz</span><br><span class="line">tar xvf libmemcached-1.0.18.tar.gz</span><br><span class="line"><span class="built_in">cd</span> libmemcached-1.0.18</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>然后编译安装 php-memcached 扩展，编译完成后，<code>memcache.so</code> 文件位置为：&#x2F;usr&#x2F;lib64&#x2F;php&#x2F;modules</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://pecl.php.net/get/memcached-2.2.0.tgz</span><br><span class="line">tar xvf memcached-2.2.0.tgz</span><br><span class="line"><span class="built_in">cd</span> memcached-2.2.0</span><br><span class="line">phpize</span><br><span class="line">./configure --disable-memcached-sasl</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>添加扩展配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/php.d/memcached.ini</span><br><span class="line">extension=memcached.so</span><br></pre></td></tr></table></figure>

<p>验证 memcached 模块已被加载</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">php -m |grep memcached</span><br><span class="line">memcached</span><br></pre></td></tr></table></figure>

<h2 id="安装-fpmmm-程序"><a href="#安装-fpmmm-程序" class="headerlink" title="安装 fpmmm 程序"></a>安装 fpmmm 程序</h2><p>从 <a href="https://www.fromdual.com/">fpmmm</a> 官网下载安装包</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar zxvf fpmmm-0.10.6.tar.gz</span><br><span class="line"><span class="built_in">mkdir</span> /etc/fpmmm</span><br><span class="line"><span class="built_in">cp</span> fpmmm-0.10.6/tpl/fpmmm.conf.template /etc/fpmmm/fpmmm.conf</span><br><span class="line"><span class="built_in">chown</span> -R zabbix: /etc/fpmmm</span><br><span class="line"><span class="built_in">mv</span> fpmmm-0.10.6 /etc/zabbix/</span><br></pre></td></tr></table></figure>

<h2 id="配置-fpmmm-程序"><a href="#配置-fpmmm-程序" class="headerlink" title="配置 fpmmm 程序"></a>配置 fpmmm 程序</h2><p>编辑 <code>/etc/fpmmm/fpmmm.conf</code> 配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Information for MySQL connections:</span></span><br><span class="line">Username      = fpmmm_agent</span><br><span class="line">Password      = secret</span><br><span class="line">MysqlHost     = 127.0.0.1</span><br><span class="line">MysqlPort     = 3306</span><br><span class="line"></span><br><span class="line"><span class="comment"># Zabbix Server IP address</span></span><br><span class="line">ZabbixServer  = zabbix-server-ip</span><br><span class="line"></span><br><span class="line"><span class="comment"># Special parameter which is used for module process (MySQL PID file!)</span></span><br><span class="line">PidFile       = /home/mysql/data/mysqld.pid</span><br><span class="line"></span><br><span class="line"><span class="comment"># Here you could enter the hostname of your machine (uname -n)</span></span><br><span class="line">[hostname]          <span class="comment"># This MUST match Hostname in Zabbix!</span></span><br><span class="line">Type          = mysqld</span><br><span class="line">Modules       = fpmmm server</span><br><span class="line"></span><br><span class="line"><span class="comment"># Here you could add a random name of your MySQL/MariaDB instance</span></span><br><span class="line">[hostname]         <span class="comment"># This MUST match Hostname in Zabbix!</span></span><br><span class="line">Type          = mysqld</span><br><span class="line">MysqlPort     = 3306</span><br><span class="line">Modules       = process mysql myisam innodb master slave security</span><br><span class="line">PidFile       = /home/mysql/data/mysqld.pid</span><br></pre></td></tr></table></figure>

<p>数据库中添加监控用户</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;fpmmm_agent&#x27;</span>@<span class="string">&#x27;127.0.0.1&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;secret&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> PROCESS <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;fpmmm_agent&#x27;</span>@<span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> REPLICATION CLIENT <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;fpmmm_agent&#x27;</span>@<span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> mysql.user <span class="keyword">TO</span> <span class="string">&#x27;fpmmm_agent&#x27;</span>@<span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> REPLICATION SLAVE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;fpmmm_agent&#x27;</span>@<span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>测试 fpmmm 查看日志</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/etc/zabbix/fpmmm-0.10.6/bin/fpmmm --config=/etc/fpmmm/fpmmm.conf</span><br><span class="line">1</span><br><span class="line"><span class="built_in">cat</span> /tmp/fpmmm/fpmmm.log</span><br><span class="line">...</span><br><span class="line">3423:2017-04-01 17:58:18.746 - INFO: FromDual Performance Monitor <span class="keyword">for</span> MySQL and MariaDB (fpmmm) (0.10.6) run started.</span><br><span class="line">3423:2017-04-01 17:58:20.262 - INFO: FromDual Performance Monitor <span class="keyword">for</span> MySQL and MariaDB (fpmmm) run finished (rc=0).</span><br></pre></td></tr></table></figure>

<p>定时执行 fpmmm agent</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;UserParameter=FromDual.MySQL.check,/etc/zabbix/fpmmm-0.10.6/bin/fpmmm --config=/etc/fpmmm/fpmmm.conf&quot;</span> &gt;&gt; /etc/zabbix/zabbix_agentd.d/userparameter_mysql.conf</span><br></pre></td></tr></table></figure>

<h1 id="zabbix-server-添加-fpmmm-模板"><a href="#zabbix-server-添加-fpmmm-模板" class="headerlink" title="zabbix server 添加 fpmmm 模板"></a>zabbix server 添加 fpmmm 模板</h1><p>登录 zabbix server 控制台，点击 Configuration–Templates–Import–选择文件，导入 fpmmm-0.10.6\tpl 目录中以下文件：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Template_FromDual.MySQL.server_30.xml</span><br><span class="line">Template_FromDual.MySQL.mysql_30.xml</span><br><span class="line">Template_FromDual.MySQL.myisam_30.xml</span><br><span class="line">Template_FromDual.MySQL.innodb_30.xml</span><br><span class="line">Template_FromDual.MySQL.master_30.xml</span><br><span class="line">Template_FromDual.MySQL.slave_30.xml</span><br><span class="line">Template_FromDual.MySQL.security_30.xml</span><br></pre></td></tr></table></figure>

<p>最后把模板应用到要监控的主机即可。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="http://www.fromdual.com/fpmmm-installation-guide">FPMMM INSTALLATION GUIDE</a></li>
</ul>
]]></content>
      <categories>
        <category>monitor</category>
      </categories>
      <tags>
        <tag>zabbix</tag>
        <tag>fpmmm</tag>
      </tags>
  </entry>
</search>
